<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Color Analyzer Pro - í—¤ì–´ë””ìì´ë„ˆ ì „ìš©</title>
    
    <!-- PWA ë©”íƒ€ë°ì´í„° -->
    <meta name="description" content="í—¤ì–´ë””ìì´ë„ˆë¥¼ ìœ„í•œ ì „ë¬¸ í¼ìŠ¤ë„ì»¬ëŸ¬ ì§„ë‹¨ ì‹œìŠ¤í…œ">
    <meta name="theme-color" content="#2C3E50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- PWA ë§¤ë‹ˆí˜ìŠ¤íŠ¸ -->
    <link rel="manifest" href="manifest.json">
    
    <!-- ì•„ì´ì½˜ë“¤ -->
    <link rel="icon" type="image/png" sizes="32x32" href="assets/images/icons/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="192x192" href="assets/images/icons/icon-192x192.png">
    <link rel="apple-touch-icon" href="assets/images/icons/icon-192x192.png">
    
    <!-- CSS íŒŒì¼ë“¤ -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/tablet.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/animations.css">
    
    <!-- í°íŠ¸ í”„ë¦¬ë¡œë“œ -->
    <link rel="preload" href="assets/fonts/NotoSansKR-Regular.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="assets/fonts/Inter-Variable.woff2" as="font" type="font/woff2" crossorigin>
</head>

<body class="loading">
    <!-- ë¡œë”© ìŠ¤í¬ë¦° -->
    <div class="loading-screen">
        <div class="loading-container">
            <div class="loading-logo">
                <h1>Personal Color Pro</h1>
                <p>í—¤ì–´ë””ìì´ë„ˆ ì „ìš© ì§„ë‹¨ ì‹œìŠ¤í…œ</p>
            </div>
            
            <div class="loading-progress-container">
                <div class="loading-progress-bar">
                    <div class="loading-progress" style="width: 0%"></div>
                </div>
                <div class="loading-message">ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì¤‘...</div>
            </div>
            
            <div class="loading-details">
                <div class="loading-step" id="step-config">â³ ì„¤ì • ë¡œë“œ ì¤‘...</div>
                <div class="loading-step" id="step-modules">â³ ëª¨ë“ˆ ë¡œë“œ ì¤‘...</div>
                <div class="loading-step" id="step-ai">â³ AI ì‹œìŠ¤í…œ ì¤€ë¹„ ì¤‘...</div>
                <div class="loading-step" id="step-ui">â³ UI ì´ˆê¸°í™” ì¤‘...</div>
            </div>
        </div>
    </div>

    <!-- ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ -->
    <div class="main-app" style="display: none;">
        <!-- í—¤ë” -->
        <header class="app-header">
            <div class="header-left">
                <h1 class="app-title">Personal Color Pro</h1>
                <div class="current-customer">ê³ ê°ì„ ì„ íƒí•´ì£¼ì„¸ìš”</div>
            </div>
            
            <div class="header-right">
                <button id="customer-management" class="header-btn">
                    <i class="icon-users"></i>
                    ê³ ê° ê´€ë¦¬
                </button>
                
                <button id="settings-btn" class="header-btn">
                    <i class="icon-settings"></i>
                    ì„¤ì •
                </button>
            </div>
        </header>

        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <main class="main-content">
            <!-- ì§„ë‹¨ ëª¨ë“œ ì„ íƒ -->
            <section class="diagnosis-mode-selection">
                <h2>ì§„ë‹¨ ëª¨ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”</h2>
                
                <div class="mode-cards">
                    <div class="mode-card" data-mode="ai_photo">
                        <div class="mode-icon">ğŸ¤–</div>
                        <h3>AI ì‚¬ì§„ ë¶„ì„</h3>
                        <p>ìŠ¤ë§ˆíŠ¸í°ìœ¼ë¡œ ê°„í¸í•˜ê²Œ<br>5-7ë¶„ ì†Œìš”</p>
                        <div class="mode-accuracy">ì •í™•ë„: 85%</div>
                        <button class="mode-select-btn">ì„ íƒ</button>
                    </div>
                    
                    <div class="mode-card" data-mode="draping">
                        <div class="mode-icon">ğŸ¨</div>
                        <h3>ì „ë¬¸ê°€ ë“œë ˆì´í•‘</h3>
                        <p>ìƒ‰ìƒ ì²œì„ í™œìš©í•œ ì •ë°€ ì§„ë‹¨<br>15-20ë¶„ ì†Œìš”</p>
                        <div class="mode-accuracy">ì •í™•ë„: 95%</div>
                        <button class="mode-select-btn">ì„ íƒ</button>
                    </div>
                    
                    <div class="mode-card" data-mode="hybrid">
                        <div class="mode-icon">âš¡</div>
                        <h3>í•˜ì´ë¸Œë¦¬ë“œ</h3>
                        <p>AI + ì „ë¬¸ê°€ ê²€ì¦<br>10-15ë¶„ ì†Œìš”</p>
                        <div class="mode-accuracy">ì •í™•ë„: 98%</div>
                        <button class="mode-select-btn recommended">ì¶”ì²œ</button>
                    </div>
                </div>
            </section>

            <!-- ì§„ë‹¨ ì˜ì—­ -->
            <section class="diagnosis-area" style="display: none;">
                <div class="diagnosis-container">
                    <!-- AI ëª¨ë“œ ì»¨í…Œì´ë„ˆ -->
                    <div id="ai-mode-container" class="diagnosis-mode-container">
                        <h3>ğŸ“· AI ì‚¬ì§„ ë¶„ì„</h3>
                        <div class="camera-container">
                            <video id="camera-preview" autoplay muted playsinline></video>
                            <canvas id="analysis-canvas"></canvas>
                            <div class="camera-overlay">
                                <div class="face-guide">ì–¼êµ´ì„ í”„ë ˆì„ì— ë§ì¶°ì£¼ì„¸ìš”</div>
                            </div>
                        </div>
                        
                        <div class="camera-controls">
                            <button id="capture-btn" class="primary-btn">ğŸ“¸ ì´¬ì˜</button>
                            <button id="upload-btn" class="secondary-btn">ğŸ“ íŒŒì¼ ì„ íƒ</button>
                            <input type="file" id="file-input" accept="image/*" style="display: none;">
                        </div>
                    </div>
                    
                    <!-- ë“œë ˆì´í•‘ ëª¨ë“œ ì»¨í…Œì´ë„ˆ -->
                    <div id="draping-mode-container" class="diagnosis-mode-container" style="display: none;">
                        <h3>ğŸ¨ ì „ë¬¸ê°€ ë“œë ˆì´í•‘</h3>
                        <div class="draping-workspace">
                            <div class="color-palette">
                                <h4>í…ŒìŠ¤íŠ¸ ìƒ‰ìƒ</h4>
                                <div class="color-swatches">
                                    <div class="color-swatch" data-color="#FF6B6B" style="background: #FF6B6B;"></div>
                                    <div class="color-swatch" data-color="#4ECDC4" style="background: #4ECDC4;"></div>
                                    <div class="color-swatch" data-color="#45B7D1" style="background: #45B7D1;"></div>
                                    <div class="color-swatch" data-color="#96CEB4" style="background: #96CEB4;"></div>
                                </div>
                            </div>
                            
                            <div class="draping-notes">
                                <h4>ê´€ì°° ë©”ëª¨</h4>
                                <textarea id="draping-notes" placeholder="ìƒ‰ìƒë³„ í”¼ë¶€ ë°˜ì‘ì„ ê¸°ë¡í•˜ì„¸ìš”..."></textarea>
                            </div>
                        </div>
                        
                        <div class="draping-controls">
                            <button id="add-comparison" class="primary-btn">ë¹„êµ ì¶”ê°€</button>
                            <button id="complete-draping" class="secondary-btn">ì§„ë‹¨ ì™„ë£Œ</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ê²°ê³¼ ì˜ì—­ -->
            <section class="diagnosis-result" style="display: none;">
                <div class="result-container">
                    <h2>ğŸ‰ ì§„ë‹¨ ê²°ê³¼</h2>
                    
                    <div class="result-summary">
                        <div class="season-badge">
                            <span class="season-name">ë´„ ì›œí†¤</span>
                            <span class="confidence">92% í™•ì‹ </span>
                        </div>
                        
                        <div class="result-details">
                            <div class="detail-item">
                                <span class="label">í”¼ë¶€ í†¤:</span>
                                <span class="value">ë”°ëœ»í•œ í†¤</span>
                            </div>
                            <div class="detail-item">
                                <span class="label">ë°ê¸°:</span>
                                <span class="value">ë°ì€ í†¤</span>
                            </div>
                            <div class="detail-item">
                                <span class="label">ì±„ë„:</span>
                                <span class="value">ì„ ëª…í•œ í†¤</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="result-actions">
                        <button id="generate-report" class="primary-btn" disabled>
                            ğŸ“Š PDF ë³´ê³ ì„œ ìƒì„±
                        </button>
                        <button id="save-result" class="secondary-btn">
                            ğŸ’¾ ê²°ê³¼ ì €ì¥
                        </button>
                        <button id="new-diagnosis" class="secondary-btn">
                            ğŸ”„ ìƒˆ ì§„ë‹¨
                        </button>
                    </div>
                </div>
            </section>
        </main>

        <!-- ì‚¬ì´ë“œë°” (ê³ ê° ê´€ë¦¬) -->
        <aside class="sidebar" style="display: none;">
            <div class="sidebar-header">
                <h3>ê³ ê° ê´€ë¦¬</h3>
                <button class="close-sidebar">âœ•</button>
            </div>
            
            <div class="sidebar-content">
                <div class="customer-search">
                    <input type="text" placeholder="ê³ ê° ê²€ìƒ‰..." id="customer-search">
                </div>
                
                <div class="customer-list">
                    <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                </div>
                
                <button id="add-customer" class="primary-btn full-width">
                    â• ìƒˆ ê³ ê° ì¶”ê°€
                </button>
            </div>
        </aside>
    </div>

    <!-- ì—ëŸ¬ í† ìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆ -->
    <div class="toast-container"></div>

    <!-- ëª¨ë‹¬ ì»¨í…Œì´ë„ˆ -->
    <div class="modal-container"></div>

    <!-- JavaScript ë¡œë“œ -->
    <script>
        // ì—ëŸ¬ ì²˜ë¦¬
        window.addEventListener('error', (e) => {
            console.error('ì „ì—­ ì—ëŸ¬:', e.error);
        });

        // ë¡œë”© ì§„í–‰ë¥  ì—…ë°ì´í„°
        function updateLoadingStep(stepId, status, message) {
            const step = document.getElementById(stepId);
            if (step) {
                const icon = status === 'complete' ? 'âœ…' : 
                            status === 'error' ? 'âŒ' : 'â³';
                step.textContent = `${icon} ${message}`;
            }
        }

        // ë¡œë”© ì™„ë£Œ ì²˜ë¦¬
        function completeLoading() {
            setTimeout(() => {
                document.querySelector('.loading-screen').style.display = 'none';
                document.querySelector('.main-app').style.display = 'block';
                document.body.classList.remove('loading');
            }, 500);
        }
    </script>

    <!-- 1. ì„¤ì • íŒŒì¼ (process ì œê±°ëœ ë²„ì „) -->
    <script src="js/config.js"></script>
    
    <!-- 2. ìœ í‹¸ë¦¬í‹°ë“¤ -->
    <script src="js/utils/validation.js"></script>
    <script src="js/utils/performance.js"></script>
    <script src="js/utils/analytics.js"></script>
    
    <!-- 3. ëª¨ë“ˆ ë¡œë” (ES6 ëª¨ë“ˆ í˜¸í™˜ì„± í•´ê²°) -->
    <script src="js/utils/moduleLoader.js"></script>
    
    <!-- 4. ëˆ„ë½ëœ íŒŒì¼ë“¤ -->
    <script>
        // ëˆ„ë½ëœ íŒŒì¼ë“¤ì„ ì¸ë¼ì¸ìœ¼ë¡œ ë¡œë“œ
        // fashionGuide, makeupBrands, colorPalettes, etc.
        
        const fashionGuide = {
            spring: { colors: ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4'] },
            summer: { colors: ['#A8E6CF', '#DCEDC8', '#C5E1A5', '#E1BEE7'] },
            autumn: { colors: ['#D4AF37', '#CD853F', '#A0522D', '#8B4513'] },
            winter: { colors: ['#000000', '#FFFFFF', '#DC143C', '#4169E1'] }
        };

        const makeupBrands = {
            hera: { name: 'í—¤ë¼', products: { foundation: ['#21', '#23', '#25'] } },
            laneige: { name: 'ë¼ë„¤ì¦ˆ', products: { foundation: ['#13', '#17', '#21'] } },
            innisfree: { name: 'ì´ë‹ˆìŠ¤í”„ë¦¬', products: { foundation: ['#13', '#17', '#21'] } }
        };

        const colorPalettes = {
            spring: { primary: ['#FF6B6B', '#4ECDC4', '#45B7D1'] },
            summer: { primary: ['#A8E6CF', '#DCEDC8', '#C5E1A5'] },
            autumn: { primary: ['#D4AF37', '#CD853F', '#A0522D'] },
            winter: { primary: ['#000000', '#FFFFFF', '#DC143C'] }
        };

        // ì „ì—­ì— ë“±ë¡
        window.fashionGuide = fashionGuide;
        window.makeupBrands = makeupBrands;
        window.colorPalettes = colorPalettes;

        // ê°„ë‹¨í•œ í´ë˜ìŠ¤ë“¤
        class SeasonClassifier {
            async initialize() { console.log('âœ… SeasonClassifier ì´ˆê¸°í™”'); }
            classify(skinTone, undertone, lightness) {
                return undertone === 'warm' ? 
                    (lightness === 'light' ? 'spring' : 'autumn') :
                    (lightness === 'light' ? 'summer' : 'winter');
            }
        }

        class ColorClassifier {
            async initialize() { console.log('âœ… ColorClassifier ì´ˆê¸°í™”'); }
            classifyColors(colors) {
                return colors.map(color => ({ color, category: 'primary', confidence: 85 }));
            }
        }

        class ComparisonTool {
            constructor() { this.comparisons = []; }
            addComparison(before, after, metadata) {
                const comparison = { id: Date.now(), before, after, metadata };
                this.comparisons.push(comparison);
                return comparison;
            }
        }

        class ExpertWorkflow {
            constructor() { this.steps = []; this.currentStep = 0; }
            initializeWorkflow() {
                this.steps = [
                    { name: 'ê³ ê° ìƒë‹´', duration: 5 },
                    { name: 'ë“œë ˆì´í•‘ í…ŒìŠ¤íŠ¸', duration: 15 }
                ];
            }
            nextStep() {
                if (this.currentStep < this.steps.length - 1) {
                    this.currentStep++;
                    return this.steps[this.currentStep];
                }
                return null;
            }
        }

        // ì „ì—­ ë“±ë¡
        window.SeasonClassifier = SeasonClassifier;
        window.ColorClassifier = ColorClassifier;
        window.ComparisonTool = ComparisonTool;
        window.ExpertWorkflow = ExpertWorkflow;

        updateLoadingStep('step-config', 'complete', 'ì„¤ì • ë¡œë“œ ì™„ë£Œ');
    </script>

    <!-- 5. ìƒ‰ìƒ ì‹œìŠ¤í…œ (ColorConverter í¬í•¨) -->
    <script src="js/color/ColorConverter.js"></script>
    <script src="js/color/DeltaE.js"></script>

    <!-- 6. ì§„ë‹¨ ëª¨ë“œ ê´€ë¦¬ -->
    <script src="js/components/DiagnosisMode.js"></script>

    <!-- 7. AR ë Œë”ëŸ¬ -->
    <script src="js/draping/ARRenderer.js"></script>

    <!-- 8. ë©”ì¸ ì•± (ìˆ˜ì •ëœ ë²„ì „) -->
    <script src="js/app.js"></script>

    <script>
        // ëª¨ë“  ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì™„ë£Œ í›„
        updateLoadingStep('step-modules', 'complete', 'ëª¨ë“ˆ ë¡œë“œ ì™„ë£Œ');
        updateLoadingStep('step-ai', 'complete', 'AI ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ');
        updateLoadingStep('step-ui', 'complete', 'UI ì´ˆê¸°í™” ì™„ë£Œ');

        // ë¡œë”© ì™„ë£Œ
        setTimeout(() => {
            completeLoading();
        }, 1000);
    </script>

    <!-- PWA ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('SW registered');
                    })
                    .catch(error => {
                        console.log('SW registration failed');
                    });
            });
        }
    </script>
</body>
</html>
