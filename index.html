// js/app.js - í¼ìŠ¤ë„ì»¬ëŸ¬ ì§„ë‹¨ ì‹œìŠ¤í…œ ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜
console.log('í¼ìŠ¤ë„ì»¬ëŸ¬ ì§„ë‹¨ ì‹œìŠ¤í…œ v2.0 ë¡œë”© ì‹œì‘');

/**
 * ë©”ì¸ í¼ìŠ¤ë„ì»¬ëŸ¬ ë¶„ì„ê¸° í´ë˜ìŠ¤
 */
class PersonalColorAnalyzer {
    constructor() {
        console.log('PersonalColorAnalyzer ì´ˆê¸°í™” ì‹œì‘');
        
        // ì•± ìƒíƒœ
        this.currentStep = 0;
        this.analysisMode = null;
        this.currentDrapingStep = 0;
        this.maxSteps = 4;
        
        // ì§„ë‹¨ ë°ì´í„°
        this.analysisData = {
            mode: null,
            results: {},
            selectedColors: {},
            finalSeason: null,
            confidence: 92
        };
        
        // ë“œë˜ì´í•‘ ìƒ‰ìƒ ê·¸ë£¹
        this.drapingSteps = [
            {
                name: 'ì˜¨ë„ê°',
                description: 'ë”°ëœ»í•œ ìƒ‰ìƒ vs ì°¨ê°€ìš´ ìƒ‰ìƒ',
                colors: [
                    { type: 'warm', name: 'ê³¨ë“  ì˜ë¡œìš°', color: '#FFD700' },
                    { type: 'warm', name: 'ì½”ë„ ì˜¤ë Œì§€', color: '#FF7F50' },
                    { type: 'warm', name: 'í”¼ì¹˜', color: '#FFCBA4' },
                    { type: 'warm', name: 'ì˜¬ë¦¬ë¸Œ', color: '#8FBC8F' },
                    { type: 'cool', name: 'ì•„ì´ì‹œ í•‘í¬', color: '#FF1493' },
                    { type: 'cool', name: 'ë¡œì–„ ë¸”ë£¨', color: '#4169E1' },
                    { type: 'cool', name: 'ì—ë©”ë„ë“œ', color: '#50C878' },
                    { type: 'cool', name: 'ë¼ë²¤ë”', color: '#E6E6FA' }
                ]
            },
            {
                name: 'ëª…ë„',
                description: 'ë°ì€ ìƒ‰ìƒ vs ê¹Šì€ ìƒ‰ìƒ',
                colors: [
                    { type: 'light', name: 'ë¼ì´íŠ¸ í•‘í¬', color: '#FFB6C1' },
                    { type: 'light', name: 'ìŠ¤ì¹´ì´ ë¸”ë£¨', color: '#87CEEB' },
                    { type: 'light', name: 'ë¯¼íŠ¸', color: '#98FF98' },
                    { type: 'light', name: 'í¬ë¦¼', color: '#FFFDD0' },
                    { type: 'deep', name: 'ë”¥ ë ˆë“œ', color: '#8B0000' },
                    { type: 'deep', name: 'ë„¤ì´ë¹„', color: '#000080' },
                    { type: 'deep', name: 'í¬ë ˆìŠ¤íŠ¸', color: '#228B22' },
                    { type: 'deep', name: 'ì´ˆì½œë¦¿', color: '#7B3F00' }
                ]
            },
            {
                name: 'ì±„ë„',
                description: 'ì„ ëª…í•œ ìƒ‰ìƒ vs ë¶€ë“œëŸ¬ìš´ ìƒ‰ìƒ',
                colors: [
                    { type: 'vivid', name: 'ë¹„ë¹„ë“œ ë ˆë“œ', color: '#FF0000' },
                    { type: 'vivid', name: 'ì¼ë ‰íŠ¸ë¦­ ë¸”ë£¨', color: '#0080FF' },
                    { type: 'vivid', name: 'ë¼ì„', color: '#00FF00' },
                    { type: 'vivid', name: 'ë¨¸ì  íƒ€', color: '#FF00FF' },
                    { type: 'soft', name: 'ë”ìŠ¤í‹° ë¡œì¦ˆ', color: '#C4A484' },
                    { type: 'soft', name: 'ì„¸ì´ì§€', color: '#9CAF88' },
                    { type: 'soft', name: 'ë¨¸ë¸Œ', color: '#B784A7' },
                    { type: 'soft', name: 'ìŠ¤ëª¨í‚¤ ë¸”ë£¨', color: '#6A9BD1' }
                ]
            }
        ];
        
        // í„°ì¹˜ ìƒíƒœ
        this.touchState = {
            startX: 0,
            startY: 0,
            isScrolling: false
        };
        
        // íƒ€ì´ë¨¸
        this.colorPreviewTimer = null;
        
        // ì´ˆê¸°í™”
        this.init();
    }
    
    /**
     * ì•± ì´ˆê¸°í™”
     */
    init() {
        console.log('ì•± ì´ˆê¸°í™” ì‹œì‘');
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => this.initializeApp());
        } else {
            this.initializeApp();
        }
    }
    
    /**
     * ì•± ì™„ì „ ì´ˆê¸°í™”
     */
    initializeApp() {
        console.log('ì•± ì™„ì „ ì´ˆê¸°í™”');
        
        try {
            this.setupEventListeners();
            this.setupSwipeGestures();
            this.registerGlobalFunctions();
            this.hideLoading();
            this.showStep(0);
            this.updateNavigation();
            
            console.log('ì•± ì´ˆê¸°í™” ì™„ë£Œ');
        } catch (error) {
            console.error('ì•± ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
            this.showError('ì‹œìŠ¤í…œì„ ì´ˆê¸°í™”í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
    }
    
    /**
     * ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
     */
    setupEventListeners() {
        console.log('ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •');
        
        // ë’¤ë¡œê°€ê¸° ì´ë²¤íŠ¸
        window.addEventListener('popstate', () => {
            this.goBack();
        });
        
        // í‚¤ë³´ë“œ ì´ë²¤íŠ¸
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                this.closeModal();
            } else if (e.key === 'ArrowLeft') {
                this.goBack();
            }
        });
    }
    
    /**
     * ìŠ¤ì™€ì´í”„ ì œìŠ¤ì²˜ ì„¤ì •
     */
    setupSwipeGestures() {
        console.log('ìŠ¤ì™€ì´í”„ ì œìŠ¤ì²˜ ì„¤ì •');
        
        const app = document.getElementById('app');
        if (!app) return;
        
        app.addEventListener('touchstart', (e) => {
            this.touchState.startX = e.touches[0].clientX;
            this.touchState.startY = e.touches[0].clientY;
            this.touchState.isScrolling = false;
        }, { passive: true });
        
        app.addEventListener('touchmove', (e) => {
            if (!this.touchState.startX || !this.touchState.startY) return;
            
            const diffX = Math.abs(e.touches[0].clientX - this.touchState.startX);
            const diffY = Math.abs(e.touches[0].clientY - this.touchState.startY);
            
            if (diffY > diffX) {
                this.touchState.isScrolling = true;
            }
        }, { passive: true });
        
        app.addEventListener('touchend', (e) => {
            if (!this.touchState.startX || this.touchState.isScrolling) return;
            
            const diffX = e.changedTouches[0].clientX - this.touchState.startX;
            
            if (Math.abs(diffX) > 50) {
                if (diffX > 0 && this.currentStep > 0) {
                    this.goBack();
                }
            }
            
            this.touchState.startX = 0;
            this.touchState.startY = 0;
        }, { passive: true });
    }
    
    /**
     * ì „ì—­ í•¨ìˆ˜ ë“±ë¡
     */
    registerGlobalFunctions() {
        window.selectMode = (mode) => this.selectAnalysisMode(mode);
        window.selectColor = (step, type, colorName, colorData) => this.selectColor(step, type, colorName, colorData);
        window.goBack = () => this.goBack();
        window.goNext = () => this.goNext();
        window.resetApp = () => this.resetApp();
        window.exportToPDF = () => this.exportToPDF();
        window.shareResults = () => this.shareResults();
        window.showExpertManual = () => this.showExpertManual();
        window.enterFullscreenDraping = (colorData) => this.enterFullscreenDraping(colorData);
    }
    
    /**
     * ë¡œë”© í™”ë©´ ìˆ¨ê¸°ê¸°
     */
    hideLoading() {
        console.log('ë¡œë”© í™”ë©´ ìˆ¨ê¹€');
        
        const loading = document.getElementById('loading');
        const app = document.getElementById('app');
        
        if (loading && app) {
            setTimeout(() => {
                loading.style.display = 'none';
                app.style.display = 'block';
            }, 500);
        }
    }
    
    /**
     * ë‹¨ê³„ í‘œì‹œ
     */
    showStep(stepNumber) {
        console.log('ë‹¨ê³„ í‘œì‹œ:', stepNumber);
        
        // ëª¨ë“  ë‹¨ê³„ ìˆ¨ê¸°ê¸°
        document.querySelectorAll('.step-content').forEach(step => {
            step.style.display = 'none';
            step.classList.remove('fade-in-up');
        });
        
        // í˜„ì¬ ë‹¨ê³„ í‘œì‹œ
        const currentStepElement = document.getElementById(`step-${stepNumber}`);
        if (currentStepElement) {
            currentStepElement.style.display = 'block';
            
            // ì• ë‹ˆë©”ì´ì…˜ ì ìš©
            setTimeout(() => {
                currentStepElement.classList.add('fade-in-up');
            }, 50);
        }
        
        this.currentStep = stepNumber;
        this.updateNavigation();
        this.updateProgressIndicator();
    }
    
    /**
     * ë„¤ë¹„ê²Œì´ì…˜ ì—…ë°ì´íŠ¸
     */
    updateNavigation() {
        const thumbBackBtn = document.getElementById('thumbBackBtn');
        const thumbHomeBtn = document.getElementById('thumbHomeBtn');
        
        // ë’¤ë¡œê°€ê¸° ë²„íŠ¼
        if (thumbBackBtn) {
            thumbBackBtn.style.display = this.currentStep > 0 ? 'flex' : 'none';
        }
        
        // í™ˆ ë²„íŠ¼ì€ í•­ìƒ í‘œì‹œ
        if (thumbHomeBtn) {
            thumbHomeBtn.style.display = 'flex';
        }
    }
    
    /**
     * ì§„í–‰ë¥  í‘œì‹œê¸° ì—…ë°ì´íŠ¸
     */
    updateProgressIndicator() {
        const indicators = document.querySelectorAll('.progress-step');
        indicators.forEach((indicator, index) => {
            if (index < this.currentStep) {
                indicator.classList.add('completed');
                indicator.classList.remove('active');
            } else if (index === this.currentStep) {
                indicator.classList.add('active');
                indicator.classList.remove('completed');
            } else {
                indicator.classList.remove('active', 'completed');
            }
        });
    }
    
    /**
     * ë¶„ì„ ëª¨ë“œ ì„ íƒ
     */
    selectAnalysisMode(mode) {
        console.log('ë¶„ì„ ëª¨ë“œ ì„ íƒ:', mode);
        
        this.analysisMode = mode;
        this.analysisData.mode = mode;
        
        if (mode === 'photo') {
            // ì‚¬ì§„ ê¸°ë°˜ ë¶„ì„
            this.showPhotoAnalysis();
        } else if (mode === 'expert') {
            // ì „ë¬¸ê°€ ë“œë˜ì´í•‘ ë¶„ì„
            this.showDrapingAnalysis();
        }
    }
    
    /**
     * ì‚¬ì§„ ë¶„ì„ í‘œì‹œ
     */
    showPhotoAnalysis() {
        console.log('ì‚¬ì§„ ë¶„ì„ ëª¨ë“œ ì‹œì‘');
        
        // ê°„ë‹¨í•œ ì‹œë®¬ë ˆì´ì…˜ìœ¼ë¡œ ê²°ê³¼ ìƒì„±
        setTimeout(() => {
            this.analysisData.finalSeason = 'Spring Light';
            this.analysisData.confidence = 85;
            this.showStep(3); // ê²°ê³¼ ë‹¨ê³„ë¡œ ì´ë™
        }, 2000);
    }
    
    /**
     * ë“œë˜ì´í•‘ ë¶„ì„ í‘œì‹œ
     */
    showDrapingAnalysis() {
        console.log('ë“œë˜ì´í•‘ ë¶„ì„ ì‹œì‘');
        this.currentDrapingStep = 0;
        this.showDrapingStep();
    }
    
    /**
     * ë“œë˜ì´í•‘ ë‹¨ê³„ í‘œì‹œ
     */
    showDrapingStep() {
        const stepData = this.drapingSteps[this.currentDrapingStep];
        
        if (!stepData) {
            this.calculateResults();
            return;
        }
        
        const content = document.getElementById('step-content');
        if (!content) return;
        
        content.innerHTML = `
            <div class="draping-step fade-in-up">
                <div class="text-center mb-8">
                    <h2 class="mega-font-sm text-gray-800 mb-4">${stepData.name} ë¶„ì„</h2>
                    <p class="large-font text-gray-600 mb-6">${stepData.description}</p>
                    <div class="text-lg text-purple-600 font-medium">
                        ${this.currentDrapingStep + 1} / ${this.drapingSteps.length} ë‹¨ê³„
                    </div>
                </div>
                
                <div class="color-grid grid grid-cols-2 gap-4 max-w-2xl mx-auto">
                    ${stepData.colors.map(color => `
                        <div class="color-card bg-white rounded-2xl shadow-lg overflow-hidden cursor-pointer transition-all duration-300 hover:scale-105 hover:shadow-xl"
                             onclick="selectColor(${this.currentDrapingStep}, '${color.type}', '${color.name}', ${JSON.stringify(color).replace(/"/g, '&quot;')})"
                             style="aspect-ratio: 1; min-height: 120px;">
                            <div class="h-3/4 relative" style="background: ${color.color};">
                                <div class="absolute inset-0 bg-black bg-opacity-20 flex items-center justify-center">
                                    <span class="text-white font-bold text-lg text-center px-2 py-1 bg-black bg-opacity-50 rounded">
                                        ${color.name}
                                    </span>
                                </div>
                                <button class="absolute top-2 right-2 bg-white bg-opacity-80 rounded-full p-2 text-gray-600 hover:bg-white transition-colors"
                                        onclick="event.stopPropagation(); enterFullscreenDraping(${JSON.stringify(color).replace(/"/g, '&quot;')})">
                                    ğŸ­
                                </button>
                            </div>
                            <div class="h-1/4 px-4 py-2 flex items-center justify-center">
                                <span class="text-sm font-medium text-gray-700">${color.type === 'warm' ? 'ë”°ëœ»í•¨' : color.type === 'cool' ? 'ì°¨ê°€ì›€' : color.type === 'light' ? 'ë°ìŒ' : color.type === 'deep' ? 'ê¹ŠìŒ' : color.type === 'vivid' ? 'ì„ ëª…í•¨' : 'ë¶€ë“œëŸ¬ì›€'}</span>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
        
        this.showStep(1);
    }
    
    /**
     * ìƒ‰ìƒ ì„ íƒ ì²˜ë¦¬
     */
    selectColor(step, type, colorName, colorData) {
        console.log(`ìƒ‰ìƒ ì„ íƒ: ë‹¨ê³„${step}, íƒ€ì…${type}, ìƒ‰ìƒ${colorName}`);
        
        // ì„ íƒëœ ìƒ‰ìƒ ì €ì¥
        this.analysisData.selectedColors[step] = {
            step,
            type,
            colorName,
            colorData
        };
        
        // ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰
        this.currentDrapingStep++;
        
        if (this.currentDrapingStep < this.drapingSteps.length) {
            setTimeout(() => {
                this.showDrapingStep();
            }, 300);
        } else {
            this.calculateResults();
        }
    }
    
    /**
     * ê²°ê³¼ ê³„ì‚°
     */
    calculateResults() {
        console.log('ê²°ê³¼ ê³„ì‚° ì¤‘...');
        
        const selections = this.analysisData.selectedColors;
        let season = 'Spring Light'; // ê¸°ë³¸ê°’
        
        // ê°„ë‹¨í•œ ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ ê³„ì ˆ íŒì •
        const warmCount = Object.values(selections).filter(s => s.type === 'warm').length;
        const coolCount = Object.values(selections).filter(s => s.type === 'cool').length;
        const lightCount = Object.values(selections).filter(s => s.type === 'light').length;
        const deepCount = Object.values(selections).filter(s => s.type === 'deep').length;
        const vividCount = Object.values(selections).filter(s => s.type === 'vivid').length;
        const softCount = Object.values(selections).filter(s => s.type === 'soft').length;
        
        // ê³„ì ˆ íŒì • ë¡œì§
        if (warmCount > coolCount) {
            if (lightCount > deepCount) {
                season = vividCount > softCount ? 'Spring True' : 'Spring Light';
            } else {
                season = 'Spring Deep';
            }
        } else {
            if (lightCount > deepCount) {
                season = vividCount > softCount ? 'Summer True' : 'Summer Light';
            } else {
                season = 'Summer Deep';
            }
        }
        
        this.analysisData.finalSeason = season;
        this.analysisData.confidence = 92;
        
        setTimeout(() => {
            this.showResults();
        }, 1000);
    }
    
    /**
     * ê²°ê³¼ í‘œì‹œ
     */
    showResults() {
        console.log('ê²°ê³¼ í‘œì‹œ');
        
        const season = this.analysisData.finalSeason;
        const confidence = this.analysisData.confidence;
        
        // ê³„ì ˆë³„ ë°ì´í„° (ê°„ë‹¨í•œ ë²„ì „)
        const seasonData = {
            'Spring Light': {
                name: 'ë´„ ë¼ì´íŠ¸',
                description: 'ë°ê³  ë”°ëœ»í•œ ìƒ‰ìƒì´ ì˜ ì–´ìš¸ë¦¬ëŠ” íƒ€ì…',
                colors: ['#FFD700', '#FF7F50', '#FFCBA4', '#98FB98', '#87CEEB', '#DDA0DD'],
                makeup: 'ì½”ë„, í”¼ì¹˜, ê³¨ë“  í†¤',
                hair: 'ë¼ì´íŠ¸ ë¸Œë¼ìš´, ê³¨ë“  ë¸Œë¼ìš´',
                fashion: 'ì•„ì´ë³´ë¦¬, ë² ì´ì§€, ì†Œí”„íŠ¸ ì»¬ëŸ¬'
            },
            'Spring True': {
                name: 'ë´„ íŠ¸ë£¨',
                description: 'ì„ ëª…í•˜ê³  ë”°ëœ»í•œ ìƒ‰ìƒì´ ì˜ ì–´ìš¸ë¦¬ëŠ” íƒ€ì…',
                colors: ['#FF0000', '#FF8C00', '#FFD700', '#00FF00', '#1E90FF', '#9370DB'],
                makeup: 'ë¸Œë¼ì´íŠ¸ ë ˆë“œ, ì½”ë„, ì˜¤ë Œì§€',
                hair: 'ê³¨ë“  ë¸Œë¼ìš´, êµ¬ë¦¬ìƒ‰',
                fashion: 'ì„ ëª…í•œ ì»¬ëŸ¬, ë”°ëœ»í•œ í†¤'
            }
        };
        
        const data = seasonData[season] || seasonData['Spring Light'];
        
        const content = document.getElementById('step-content');
        if (!content) return;
        
        content.innerHTML = `
            <div class="result-content fade-in-up">
                <div class="result-header bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-3xl shadow-2xl p-8 mb-8">
                    <div class="text-center">
                        <h2 class="text-4xl font-bold mb-4">ğŸ‰ ì§„ë‹¨ ì™„ë£Œ!</h2>
                        <div class="result-font mb-4">${data.name}</div>
                        <p class="text-xl mb-6 opacity-90">${data.description}</p>
                        <div class="flex justify-center space-x-8 mb-6">
                            <div class="text-center">
                                <div class="text-3xl font-bold">${confidence}%</div>
                                <div class="text-sm opacity-80">ì •í™•ë„</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold">${this.analysisMode === 'photo' ? 'ì‚¬ì§„ë¶„ì„' : 'ì „ë¬¸ê°€ê¸‰'}</div>
                                <div class="text-sm opacity-80">ë¶„ì„ ë°©ë²•</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="recommendations grid md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white rounded-2xl shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-3">ğŸ’„ ë©”ì´í¬ì—…</h3>
                        <p class="text-gray-600">${data.makeup}</p>
                    </div>
                    <div class="bg-white rounded-2xl shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-3">ğŸ’‡â€â™€ï¸ í—¤ì–´</h3>
                        <p class="text-gray-600">${data.hair}</p>
                    </div>
                    <div class="bg-white rounded-2xl shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-3">ğŸ‘— íŒ¨ì…˜</h3>
                        <p class="text-gray-600">${data.fashion}</p>
                    </div>
                </div>
                
                <div class="color-palette bg-white rounded-2xl shadow-lg p-6 mb-8">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6 text-center">ğŸ¨ ì¶”ì²œ ì»¬ëŸ¬ íŒ”ë ˆíŠ¸</h3>
                    <div class="grid grid-cols-6 gap-4">
                        ${data.colors.map(color => `
                            <div class="palette-color aspect-square rounded-xl shadow-lg transition-all duration-300 hover:scale-110 hover:shadow-xl"
                                 style="background: ${color};"
                                 title="${color}">
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="text-center space-y-4">
                    <div class="flex justify-center space-x-4">
                        <button onclick="shareResults()" 
                                class="bg-green-500 text-white px-6 py-3 rounded-xl hover:bg-green-600 transition-all font-bold">
                            ğŸ“± ê²°ê³¼ ê³µìœ í•˜ê¸°
                        </button>
                        <button onclick="exportToPDF()" 
                                class="bg-blue-500 text-white px-6 py-3 rounded-xl hover:bg-blue-600 transition-all font-bold">
                            ğŸ“„ PDFë¡œ ì €ì¥
                        </button>
                    </div>
                    <button onclick="resetApp()" 
                            class="bg-gray-500 text-white px-6 py-3 rounded-xl hover:bg-gray-600 transition-all font-bold">
                        ğŸ”„ ë‹¤ì‹œ ì§„ë‹¨í•˜ê¸°
                    </button>
                </div>
            </div>
        `;
        
        this.showStep(3);
    }
    
    /**
     * ë’¤ë¡œê°€ê¸°
     */
    goBack() {
        if (this.currentStep > 0) {
            this.showStep(this.currentStep - 1);
        }
    }
    
    /**
     * ì•± ë¦¬ì…‹
     */
    resetApp() {
        console.log('ì•± ë¦¬ì…‹');
        
        this.currentStep = 0;
        this.analysisMode = null;
        this.currentDrapingStep = 0;
        this.analysisData = {
            mode: null,
            results: {},
            selectedColors: {},
            finalSeason: null,
            confidence: 0
        };
        
        this.showStep(0);
    }
    
    /**
     * ì „ë¬¸ê°€ ë§¤ë‰´ì–¼ í‘œì‹œ
     */
    showExpertManual() {
        console.log('ì „ë¬¸ê°€ ë§¤ë‰´ì–¼ í‘œì‹œ');
        
        const modal = document.getElementById('expertManualModal');
        if (!modal) return;
        
        modal.innerHTML = `
            <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                <div class="bg-white rounded-3xl max-w-4xl max-h-[90vh] overflow-y-auto p-8 relative">
                    <button onclick="this.closest('.fixed').classList.add('hidden')" 
                            class="absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-2xl font-bold">
                        âœ•
                    </button>
                    
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-bold text-gray-800 mb-4">ğŸ“– ì „ë¬¸ê°€ ë§¤ë‰´ì–¼</h2>
                        <p class="text-lg text-gray-600">ê³¼í•™ì  í¼ìŠ¤ë„ì»¬ëŸ¬ ì§„ë‹¨ ë°©ë²•</p>
                    </div>
                    
                    <div class="space-y-6">
                        <div class="bg-blue-50 p-6 rounded-2xl">
                            <h3 class="text-xl font-bold text-blue-800 mb-3">ğŸ”¬ ê³¼í•™ì  ê¸°ë°˜</h3>
                            <p class="text-blue-700">Munsell ìƒ‰ì²´ê³„ì™€ Von Kries ì´ë¡ ì„ ê¸°ë°˜ìœ¼ë¡œ í•œ ì •í™•í•œ ìƒ‰ìƒ ë¶„ì„</p>
                        </div>
                        
                        <div class="bg-green-50 p-6 rounded-2xl">
                            <h3 class="text-xl font-bold text-green-800 mb-3">ğŸ“‹ 3ë‹¨ê³„ ì§„ë‹¨</h3>
                            <ul class="text-green-700 space-y-2">
                                <li><strong>1ë‹¨ê³„:</strong> ì˜¨ë„ê° (ë”°ëœ»í•¨ vs ì°¨ê°€ì›€)</li>
                                <li><strong>2ë‹¨ê³„:</strong> ëª…ë„ (ë°ìŒ vs ê¹ŠìŒ)</li>
                                <li><strong>3ë‹¨ê³„:</strong> ì±„ë„ (ì„ ëª…í•¨ vs ë¶€ë“œëŸ¬ì›€)</li>
                            </ul>
                        </div>
                        
                        <div class="bg-purple-50 p-6 rounded-2xl">
                            <h3 class="text-xl font-bold text-purple-800 mb-3">ğŸ¯ ì‚¬ìš©ë²•</h3>
                            <p class="text-purple-700">ê° ë‹¨ê³„ì—ì„œ ë” ì˜ ì–´ìš¸ë¦°ë‹¤ê³  ìƒê°í•˜ëŠ” ìƒ‰ìƒì„ ì„ íƒí•˜ì„¸ìš”. ì „ì²´í™”ë©´ ë¯¸ë¦¬ë³´ê¸°ë¡œ ì‹¤ì œ íš¨ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                        </div>
                        
                        <div class="bg-orange-50 p-6 rounded-2xl">
                            <h3 class="text-xl font-bold text-orange-800 mb-3">ğŸ“Š ì •í™•ë„</h3>
                            <p class="text-orange-700">ì „ë¬¸ê°€ê¸‰ ë“œë˜ì´í•‘: 92% ì •í™•ë„ | ì‚¬ì§„ ê¸°ë°˜ ë¶„ì„: 85% ì •í™•ë„</p>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        modal.classList.remove('hidden');
    }
    
    /**
     * ì „ì²´í™”ë©´ ë“œë˜ì´í•‘
     */
    enterFullscreenDraping(colorData) {
        console.log('ì „ì²´í™”ë©´ ë“œë˜ì´í•‘:', colorData);
        
        const modal = document.getElementById('fullscreenModal');
        if (!modal) return;
        
        modal.innerHTML = `
            <div class="fixed inset-0 z-50" style="background: ${colorData.color};">
                <div class="flex items-center justify-center h-full relative">
                    <button onclick="this.closest('.fixed').classList.add('hidden')" 
                            class="absolute top-6 right-6 bg-white bg-opacity-80 text-gray-800 hover:bg-white rounded-full p-3 text-xl font-bold transition-all">
                        âœ•
                    </button>
                    
                    <div class="text-center text-white">
                        <h2 class="text-4xl font-bold mb-4" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.5);">
                            ${colorData.name}
                        </h2>
                        <p class="text-xl opacity-90" style="text-shadow: 1px 1px 2px rgba(0,0,0,0.5);">
                            ì´ ìƒ‰ìƒì´ ì–¼êµ´ì— ì£¼ëŠ” íš¨ê³¼ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”
                        </p>
                        <div class="mt-8 text-lg opacity-80">
                            í™”ë©´ì„ í„°ì¹˜í•˜ê±°ë‚˜ âœ• ë²„íŠ¼ì„ ëˆŒëŸ¬ ë‹«ê¸°
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        modal.classList.remove('hidden');
        
        // ìë™ìœ¼ë¡œ 2ì´ˆ í›„ ë‹«ê¸°
        setTimeout(() => {
            modal.classList.add('hidden');
        }, 2000);
    }
    
    /**
     * ê²°ê³¼ ê³µìœ 
     */
    shareResults() {
        console.log('ê²°ê³¼ ê³µìœ ');
        
        const shareData = {
            title: 'í¼ìŠ¤ë„ì»¬ëŸ¬ ì§„ë‹¨ ê²°ê³¼',
            text: `ë‚´ í¼ìŠ¤ë„ì»¬ëŸ¬ëŠ” ${this.analysisData.finalSeason}ì…ë‹ˆë‹¤! (ì •í™•ë„: ${this.analysisData.confidence}%)`,
            url: window.location.href
        };
        
        if (navigator.share && navigator.canShare && navigator.canShare(shareData)) {
            navigator.share(shareData).catch(console.error);
        } else if (navigator.clipboard) {
            const shareText = `${shareData.text} ${shareData.url}`;
            navigator.clipboard.writeText(shareText).then(() => {
                alert('ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }).catch(() => {
                alert('ê³µìœ  ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            });
        }
    }
    
    /**
     * PDF ë‚´ë³´ë‚´ê¸°
     */
    exportToPDF() {
        console.log('PDF ë‚´ë³´ë‚´ê¸°');
        alert('PDF ë‚´ë³´ë‚´ê¸° ê¸°ëŠ¥ì€ ê³§ ì œê³µë  ì˜ˆì •ì…ë‹ˆë‹¤.');
    }
    
    /**
     * ëª¨ë‹¬ ë‹«ê¸°
     */
    closeModal() {
        const modals = document.querySelectorAll('.fixed');
        modals.forEach(modal => {
            if (!modal.classList.contains('hidden')) {
                modal.classList.add('hidden');
            }
        });
    }
    
    /**
     * ì˜¤ë¥˜ í‘œì‹œ
     */
    showError(message) {
        console.error('ì˜¤ë¥˜:', message);
        alert(message);
    }
    
    /**
     * í˜„ì¬ ì‹œê°„ ê°€ì ¸ì˜¤ê¸°
     */
    getCurrentDateTime() {
        return new Date().toLocaleString('ko-KR', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit'
        });
    }
}

// ì „ì—­ í•¨ìˆ˜ë“¤ (HTMLì—ì„œ ì§ì ‘ í˜¸ì¶œ)
function selectMode(mode) {
    if (window.app) {
        window.app.selectAnalysisMode(mode);
    }
}

function selectColor(step, type, colorName, colorData) {
    if (window.app) {
        window.app.selectColor(step, type, colorName, colorData);
    }
}

function goBack() {
    if (window.app) {
        window.app.goBack();
    }
}

function resetApp() {
    if (window.app) {
        window.app.resetApp();
    }
}

function exportToPDF() {
    if (window.app) {
        window.app.exportToPDF();
    }
}

function shareResults() {
    if (window.app) {
        window.app.shareResults();
    }
}

function showExpertManual() {
    if (window.app) {
        window.app.showExpertManual();
    }
}

function enterFullscreenDraping(colorData) {
    if (window.app) {
        window.app.enterFullscreenDraping(colorData);
    }
}

// ì•± ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ë° ì´ˆê¸°í™”
let app = null;

document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM ë¡œë“œ ì™„ë£Œ - ì•± ì´ˆê¸°í™” ì‹œì‘');
    
    try {
        app = new PersonalColorAnalyzer();
        window.app = app;
        console.log('ì•± ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì™„ë£Œ');
    } catch (error) {
        console.error('ì•± ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
        alert('ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì´ˆê¸°í™”í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
    }
});

// ì „ì—­ ì˜¤ë¥˜ í•¸ë“¤ëŸ¬
window.addEventListener('error', function(e) {
    console.error('ì „ì—­ JavaScript ì˜¤ë¥˜:', e.error);
});

window.addEventListener('unhandledrejection', function(e) {
    console.error('ì²˜ë¦¬ë˜ì§€ ì•Šì€ Promise ê±°ë¶€:', e.reason);
});

console.log('app.js ë¡œë”© ì™„ë£Œ');
