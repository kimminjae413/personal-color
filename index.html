<script src="https://cdnjs.cloudflare.com/ajax/libs/color-convert/2.0.1/color-convert.min.js"></script>
    
    <style>
/* ==========================================
   CSS ë¦¬ì…‹ ë° ê¸°ë³¸ ì„¤ì •
   ========================================== */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

:root {
    /* í•‘í¬/ë¡œì¦ˆ ìƒ‰ìƒ íŒ”ë ˆíŠ¸ */
    --primary-pink: #E91E63;
    --secondary-rose: #F8BBD9;
    --accent-gray: #757575;
    --light-pink: #FCE4EC;
    --dark-rose: #AD1457;
    
    /* ì¶”ê°€ ì‹œìŠ¤í…œ ìƒ‰ìƒ */
    --success: #4CAF50;
    --warning: #FF9800;
    --error: #F44336;
    --info: #2196F3;
    
    /* ê°„ê²© ë° í¬ê¸° */
    --spacing-xs: 0.25rem;
    --spacing-sm: 0.5rem;
    --spacing-md: 1rem;
    --spacing-lg: 1.5rem;
    --spacing-xl: 2rem;
    
    --radius: 8px;
    --radius-lg: 16px;
    --shadow: 0 2px 10px rgba(0,0,0,0.1);
    --shadow-lg: 0 4px 20px rgba(0,0,0,0.15);
    
    /* íƒ€ì´í¬ê·¸ë˜í”¼ */
    --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
}

body {
    font-family: var(--font-family);
    background: linear-gradient(135deg, var(--light-pink) 0%, #fff 50%, var(--secondary-rose) 100%);
    min-height: 100vh;
    color: #333;
}

/* ==========================================
   ë¡œë”© í™”ë©´
   ========================================== */
.loading-screen {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: linear-gradient(135deg, var(--primary-pink) 0%, var(--dark-rose) 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    z-index: 9999;
    flex-direction: column;
}

.loading-content {
    text-align: center;
}

.loading-logo {
    font-size: 4rem;
    margin-bottom: var(--spacing-lg);
    animation: pulse 2s infinite;
}

.loading-content h2 {
    font-size: 2rem;
    margin-bottom: var(--spacing-sm);
    font-weight: 600;
}

.loading-content p {
    opacity: 0.9;
    margin-bottom: var(--spacing-xl);
}

.loading-bar {
    width: 300px;
    height: 4px;
    background: rgba(255,255,255,0.3);
    border-radius: 2px;
    overflow: hidden;
    margin-bottom: var(--spacing-md);
}

.loading-progress {
    height: 100%;
    background: white;
    border-radius: 2px;
    transition: width 0.3s ease;
    width: 0%;
}

.loading-message {
    font-size: 0.9rem;
    opacity: 0.8;
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}

/* ==========================================
   ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜
   ========================================== */
.main-app {
    display: none;
    min-height: 100vh;
}

.main-app.loaded {
    display: block;
}

/* ==========================================
   í—¤ë”
   ========================================== */
.app-header {
    background: white<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="description" content="í—¤ì–´ë””ìì´ë„ˆìš© í¼ìŠ¤ë„ì»¬ëŸ¬ ì§„ë‹¨ íƒœë¸”ë¦¿ ì‹œìŠ¤í…œ">
    <title>Personal Color Pro - í¼ìŠ¤ë„ì»¬ëŸ¬ ì§„ë‹¨ ì‹œìŠ¤í…œ</title>
    
    <!-- ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_detection/face_detection.js"></script>
    
    <!-- CSS íŒŒì¼ -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- ë¡œë”© í™”ë©´ -->
    <div class="loading-screen" id="loading-screen">
        <div class="loading-content">
            <div class="loading-logo">ğŸ¨</div>
            <h2>Personal Color Pro</h2>
            <p>AI í¼ìŠ¤ë„ì»¬ëŸ¬ ì§„ë‹¨ ì‹œìŠ¤í…œ ë¡œë”© ì¤‘...</p>
            <div class="loading-bar">
                <div class="loading-progress" id="loading-progress"></div>
            </div>
            <div class="loading-message" id="loading-message">ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì¤‘...</div>
        </div>
    </div>

    <!-- ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ -->
    <div class="main-app" id="main-app">
        <!-- í—¤ë” -->
        <header class="app-header">
            <div class="header-top">
                <div>
                    <h1 class="app-title">Personal Color AI Pro</h1>
                    <div class="app-subtitle">í—¤ì–´ìƒµ ì „ìš© ì™„ì „í•œ í¼ìŠ¤ë„ì»¬ëŸ¬ ì§„ë‹¨ ì‹œìŠ¤í…œ</div>
                </div>
                <div class="header-status">
                    <div class="status-item">AI ì—”ì§„: <span class="status-active" id="ai-status">ì¤€ë¹„ë¨</span></div>
                    <div class="status-item">Delta E 2000: <span class="status-active" id="deltae-status">í™œì„±</span></div>
                    <div class="status-item">ë¶„ì„ ì™„ë£Œ: <span id="analysis-count">0</span>ê±´</div>
                </div>
            </div>
            
            <div class="header-controls">
                <button class="header-btn" id="photo-analysis-btn" onclick="switchMode('photo')">ğŸ“¸ AI ì‚¬ì§„ ë¶„ì„</button>
                <button class="header-btn" id="draping-mode-btn" onclick="switchMode('draping')">ğŸ­ ë“œë˜ì´í•‘ ëª¨ë“œ</button>
                <button class="header-btn" id="system-status-btn" onclick="showSystemStatus()">âš™ï¸ ì‹œìŠ¤í…œ ìƒíƒœ</button>
            </div>
        </header>

        <!-- ë©”ì¸ ì½˜í…ì¸  -->
        <main class="main-content">
            <!-- ëª¨ë“œ ì„ íƒ ì„¹ì…˜ -->
            <section class="section active" id="mode-selection">
                <h2>í¼ìŠ¤ë„ì»¬ëŸ¬ ì§„ë‹¨ ëª¨ë“œ ì„ íƒ</h2>
                <div class="mode-cards">
                    <!-- AI ì‚¬ì§„ ë¶„ì„ ëª¨ë“œ -->
                    <div class="mode-card" data-mode="photo" onclick="selectModeCard(this)">
                        <span class="mode-icon">ğŸ“¸</span>
                        <h3>AI ì‚¬ì§„ ë¶„ì„ ëª¨ë“œ</h3>
                        <p>ì‹¤ì‹œê°„ ì¹´ë©”ë¼ë¥¼ í†µí•œ AI ê¸°ë°˜ ê³¼í•™ì  í¼ìŠ¤ë„ì»¬ëŸ¬ ì§„ë‹¨</p>
                        <ul class="mode-features">
                            <li>MediaPipe ì–¼êµ´ ì¸ì‹</li>
                            <li>RGBâ†’LAB ìƒ‰ê³µê°„ ë³€í™˜</li>
                            <li>Delta E 2000 ìƒ‰ì°¨ ì¸¡ì •</li>
                            <li>4ë‹¨ê³„ ì‹¤ì‹œê°„ ë¶„ì„</li>
                            <li>ë¸Œëœë“œë³„ ì œí’ˆ ì¶”ì²œ</li>
                        </ul>
                        <button class="mode-btn" onclick="startPhotoAnalysis()">ì‹œì‘í•˜ê¸°</button>
                    </div>

                    <!-- ë“œë˜ì´í•‘ ëª¨ë“œ -->
                    <div class="mode-card" data-mode="draping" onclick="selectModeCard(this)">
                        <span class="mode-icon">ğŸ­</span>
                        <h3>ì „ë¬¸ê°€ ë“œë˜ì´í•‘ ëª¨ë“œ</h3>
                        <p>ì „ë¬¸ê°€ ë…¸í•˜ìš°ë¥¼ ë°˜ì˜í•œ ê°€ìƒ ë“œë˜ì´í•‘ ì§„ë‹¨</p>
                        <ul class="mode-features">
                            <li>ì‚¬ì§„ ì—…ë¡œë“œ & ì‹¤ì‹œê°„ ì˜¤ë²„ë ˆì´</li>
                            <li>4ê³„ì ˆ ìƒ‰ìƒ íŒ”ë ˆíŠ¸</li>
                            <li>ìœ ì´ë ˆ/ë¹›ë‚ ìœ¤/ë¸”ë£¨ë¯¸ ë…¸í•˜ìš°</li>
                            <li>ê°€ìƒ í—¤ì–´ì»¬ëŸ¬ ì ìš©</li>
                            <li>Before/After ë¹„êµ (4ê°€ì§€ ëª¨ë“œ)</li>
                        </ul>
                        <button class="mode-btn" onclick="startDraping()">ì‹œì‘í•˜ê¸°</button>
                    </div>
                </div>
            </section>

            <!-- AI ì‚¬ì§„ ë¶„ì„ ì„¹ì…˜ -->
            <section class="section" id="photo-analysis">
                <h2>AI ê¸°ë°˜ í¼ìŠ¤ë„ì»¬ëŸ¬ ì§„ë‹¨</h2>
                
                <div class="analysis-grid">
                    <!-- ì¹´ë©”ë¼ ì˜ì—­ -->
                    <div class="video-container">
                        <video id="camera-feed" class="video-feed" autoplay muted playsinline></video>
                        <canvas id="face-overlay" class="camera-overlay"></canvas>
                        <div class="face-detection-guide" id="face-guide">
                            ì–¼êµ´ì„ ê°€ì´ë“œë¼ì¸ì— ë§ì¶°ì£¼ì„¸ìš”
                        </div>
                    </div>

                    <!-- ë¶„ì„ íŒ¨ë„ -->
                    <div class="analysis-panel">
                        <!-- 1ë‹¨ê³„: ì–¼êµ´ ì¸ì‹ -->
                        <div class="analysis-step active" id="step-face-detection">
                            <div class="step-indicator">
                                <div class="step-dot active"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                            </div>
                            <h3>1ë‹¨ê³„: ì–¼êµ´ ì¸ì‹</h3>
                            <div class="progress-ring">
                                <svg>
                                    <circle class="bg" cx="60" cy="60" r="50"></circle>
                                    <circle class="progress" cx="60" cy="60" r="50" id="progress-circle-1"></circle>
                                </svg>
                                <div class="progress-text" id="progress-text-1">0%</div>
                            </div>
                            <p>MediaPipeë¥¼ ì‚¬ìš©í•˜ì—¬ ì–¼êµ´ì„ ì¸ì‹í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
                            <button class="mode-btn" onclick="startFaceDetection()">ì–¼êµ´ ì¸ì‹ ì‹œì‘</button>
                        </div>

                        <!-- 2ë‹¨ê³„: í”¼ë¶€ ìƒ‰ìƒ ë¶„ì„ -->
                        <div class="analysis-step" id="step-color-analysis">
                            <div class="step-indicator">
                                <div class="step-dot completed"></div>
                                <div class="step-dot active"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                            </div>
                            <h3>2ë‹¨ê³„: í”¼ë¶€ ìƒ‰ìƒ ë¶„ì„</h3>
                            <div class="progress-ring">
                                <svg>
                                    <circle class="bg" cx="60" cy="60" r="50"></circle>
                                    <circle class="progress" cx="60" cy="60" r="50" id="progress-circle-2"></circle>
                                </svg>
                                <div class="progress-text" id="progress-text-2">0%</div>
                            </div>
                            <p>RGB â†’ LAB ìƒ‰ê³µê°„ ë³€í™˜ ë° ìƒ‰ìƒ ì¶”ì¶œ ì¤‘...</p>
                        </div>

                        <!-- 3ë‹¨ê³„: Delta E ê³„ì‚° -->
                        <div class="analysis-step" id="step-delta-calculation">
                            <div class="step-indicator">
                                <div class="step-dot completed"></div>
                                <div class="step-dot completed"></div>
                                <div class="step-dot active"></div>
                                <div class="step-dot"></div>
                            </div>
                            <h3>3ë‹¨ê³„: Delta E 2000 ê³„ì‚°</h3>
                            <div class="progress-ring">
                                <svg>
                                    <circle class="bg" cx="60" cy="60" r="50"></circle>
                                    <circle class="progress" cx="60" cy="60" r="50" id="progress-circle-3"></circle>
                                </svg>
                                <div class="progress-text" id="progress-text-3">0%</div>
                            </div>
                            <p>ê³¼í•™ì  ìƒ‰ì°¨ ì¸¡ì •ì„ í†µí•œ ê³„ì ˆ íŒì • ì¤‘...</p>
                        </div>

                        <!-- 4ë‹¨ê³„: ê²°ê³¼ ìƒì„± -->
                        <div class="analysis-step" id="step-result-generation">
                            <div class="step-indicator">
                                <div class="step-dot completed"></div>
                                <div class="step-dot completed"></div>
                                <div class="step-dot completed"></div>
                                <div class="step-dot active"></div>
                            </div>
                            <h3>4ë‹¨ê³„: ê²°ê³¼ ìƒì„±</h3>
                            <div class="progress-ring">
                                <svg>
                                    <circle class="bg" cx="60" cy="60" r="50"></circle>
                                    <circle class="progress" cx="60" cy="60" r="50" id="progress-circle-4"></circle>
                                </svg>
                                <div class="progress-text" id="progress-text-4">0%</div>
                            </div>
                            <p>ì „ë¬¸ê°€ ë…¸í•˜ìš°ë¥¼ ë°˜ì˜í•œ ìµœì¢… ê²°ê³¼ ìƒì„± ì¤‘...</p>
                        </div>
                    </div>
                </div>

                <!-- ê²°ê³¼ í‘œì‹œ ì˜ì—­ -->
                <div class="results-container" id="analysis-results" style="display: none;">
                    <div class="result-header">
                        <div class="result-season" id="result-season">ë´„ ì›œí†¤</div>
                        <div class="result-confidence">ì •í™•ë„: <span id="confidence-score">92%</span></div>
                    </div>
                    
                    <div class="result-details">
                        <div class="result-card">
                            <h4>ìƒ‰ìƒ ë¶„ì„ ë°ì´í„°</h4>
                            <p>L: <span id="lab-l">65.2</span></p>
                            <p>A: <span id="lab-a">12.8</span></p>
                            <p>B: <span id="lab-b">15.4</span></p>
                            <p>Delta E: <span id="delta-e">8.3</span></p>
                        </div>
                        
                        <div class="result-card">
                            <h4>ì „ë¬¸ê°€ ë¶„ì„</h4>
                            <p id="expert-analysis">
                                ì•„ì´ë³´ë¦¬ í”¼ë¶€í†¤ì— ë”°ëœ»í•œ ì–¸ë”í†¤ì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤. 
                                ìœ ì´ë ˆ ë…¸í•˜ìš°ì— ë”°ë¥´ë©´ ì½”í† ë¦¬ë² ì´ì§€ ê³„ì—´ì´ ì˜ ì–´ìš¸ë¦½ë‹ˆë‹¤.
                            </p>
                        </div>
                        
                        <div class="result-card">
                            <h4>ì¶”ì²œ ì»¬ëŸ¬</h4>
                            <div class="recommended-colors" id="recommended-colors">
                                <!-- ë™ì ìœ¼ë¡œ ìƒì„± -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ë¸Œëœë“œë³„ ì œí’ˆ ì¶”ì²œ -->
                <div class="product-recommendations" id="product-recommendations" style="display: none;">
                    <h3 style="text-align: center; color: var(--primary-pink); margin-bottom: var(--spacing-lg);">
                        ë¸Œëœë“œë³„ ì œí’ˆ ì¶”ì²œ
                    </h3>
                    
                    <div class="brand-tabs">
                        <button class="brand-tab active" onclick="showBrandProducts('loreal')">ë¡œë ˆì•Œ</button>
                        <button class="brand-tab" onclick="showBrandProducts('wella')">ì›°ë¼</button>
                        <button class="brand-tab" onclick="showBrandProducts('milbon')">ë°€ë³¸</button>
                    </div>

                    <div class="product-grid" id="product-grid">
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„± -->
                    </div>
                </div>
            </section>

            <!-- ë“œë˜ì´í•‘ ëª¨ë“œ ì„¹ì…˜ -->
            <section class="section" id="draping-mode">
                <h2>ì „ë¬¸ê°€ ë“œë˜ì´í•‘ ì§„ë‹¨</h2>
                
                <div class="draping-container">
                    <!-- ì´ë¯¸ì§€ ì—…ë¡œë“œ ë° ë“œë˜ì´í•‘ ì˜ì—­ -->
                    <div>
                        <div class="image-upload-area" id="image-upload-area" onclick="document.getElementById('image-input').click()">
                            <input type="file" id="image-input" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
                            <div class="upload-icon">ğŸ“·</div>
                            <h3>ê³ ê° ì‚¬ì§„ ì—…ë¡œë“œ</h3>
                            <p>ë“œë˜ê·¸ & ë“œë¡­ ë˜ëŠ” í´ë¦­í•˜ì—¬ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”</p>
                            <p style="font-size: 0.9rem; color: var(--accent-gray);">ì§€ì› í˜•ì‹: JPG, PNG, WEBP</p>
                        </div>
                        
                        <canvas id="draping-canvas" style="display: none; width: 100%; border-radius: var(--radius); margin-top: var(--spacing-lg);"></canvas>
                    </div>

                    <!-- ìƒ‰ìƒ íŒ”ë ˆíŠ¸ -->
                    <div class="color-palette-section">
                        <h3 style="text-align: center; margin-bottom: var(--spacing-lg);">4ê³„ì ˆ ìƒ‰ìƒ íŒ”ë ˆíŠ¸</h3>
                        
                        <div class="season-tabs">
                            <button class="season-tab active" onclick="showSeasonPalette('spring')">ë´„</button>
                            <button class="season-tab" onclick="showSeasonPalette('summer')">ì—¬ë¦„</button>
                            <button class="season-tab" onclick="showSeasonPalette('autumn')">ê°€ì„</button>
                            <button class="season-tab" onclick="showSeasonPalette('winter')">ê²¨ìš¸</button>
                        </div>

                        <div class="color-palette" id="color-palette">
                            <!-- ë™ì ìœ¼ë¡œ ìƒì„± -->
                        </div>

                        <div style="margin-top: var(--spacing-lg);">
                            <button class="mode-btn" onclick="applyVirtualHair()" style="width: 100%;">
                                ê°€ìƒ í—¤ì–´ì»¬ëŸ¬ ì ìš©
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Before/After ë¹„êµ ì„¹ì…˜ -->
                <div class="before-after-container" id="before-after-section" style="display: none;">
                    <div class="comparison-header">
                        <h3>Before/After ë¹„êµ</h3>
                        <div class="comparison-controls">
                            <button class="comparison-mode active" data-mode="slider" onclick="switchComparisonMode('slider')">ìŠ¬ë¼ì´ë”</button>
                            <button class="comparison-mode" data-mode="split" onclick="switchComparisonMode('split')">ë¶„í• </button>
                            <button class="comparison-mode" data-mode="toggle" onclick="switchComparisonMode('toggle')">í† ê¸€</button>
                            <button class="comparison-mode" data-mode="overlay" onclick="switchComparisonMode('overlay')">ì˜¤ë²„ë ˆì´</button>
                        </div>
                    </div>
                    
                    <!-- ìŠ¬ë¼ì´ë” ë¹„êµ ë·° -->
                    <div class="slider-comparison active" id="slider-view">
                        <div class="comparison-wrapper">
                            <canvas id="before-canvas"></canvas>
                            <canvas id="after-canvas"></canvas>
                            <div class="slider-handle" id="slider-handle"></div>
                        </div>
                        <input type="range" class="comparison-slider" min="0" max="100" value="50" id="comparison-slider">
                    </div>
                    
                    <!-- ë¶„í•  ë¹„êµ ë·° -->
                    <div class="split-comparison" id="split-view">
                        <div class="before-section">
                            <h4>Before</h4>
                            <canvas id="before-split-canvas"></canvas>
                        </div>
                        <div class="after-section">
                            <h4>After</h4>
                            <canvas id="after-split-canvas"></canvas>
                        </div>
                    </div>
                    
                    <!-- í† ê¸€ ë¹„êµ ë·° -->
                    <div class="toggle-comparison" id="toggle-view">
                        <canvas id="toggle-canvas"></canvas>
                        <button class="toggle-btn" onclick="toggleBeforeAfter()">Before â†” After</button>
                    </div>
                    
                    <!-- ì˜¤ë²„ë ˆì´ ë¹„êµ ë·° -->
                    <div class="overlay-comparison" id="overlay-view">
                        <div class="overlay-wrapper">
                            <canvas id="overlay-before-canvas"></canvas>
                            <canvas id="overlay-after-canvas"></canvas>
                        </div>
                        <input type="range" class="opacity-slider" min="0" max="100" value="50" id="opacity-slider">
                        <p>íˆ¬ëª…ë„ ì¡°ì ˆ</p>
                    </div>
                    
                    <!-- ê°œì„ ë„ ì§€í‘œ -->
                    <div class="improvement-metrics">
                        <div class="metric">
                            <span class="metric-label">í”¼ë¶€í†¤ ê°œì„ :</span>
                            <span class="metric-value" id="skin-improvement">+15%</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">ì „ì²´ ì¡°í™”ë„:</span>
                            <span class="metric-value" id="harmony-score">92ì </span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">ì „ë¬¸ê°€ ì¶”ì²œ:</span>
                            <span class="metric-value" id="expert-rating">â˜…â˜…â˜…â˜…â˜†</span>
                        </div>
                    </div>
                    
                    <div class="export-options">
                        <button class="export-btn" onclick="exportComparison()">ğŸ“± ë¹„êµ ì´ë¯¸ì§€ ì €ì¥</button>
                        <button class="export-btn" onclick="generateReport()">ğŸ“„ ìƒë‹´ ë¦¬í¬íŠ¸ ìƒì„±</button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- JavaScript íŒŒì¼ë“¤ -->
    <script src="app.js"></script>
    <script src="comparison.js"></script>
</body>
</html>
