// js/app.js - 퍼스널컬러 진단 시스템 메인 애플리케이션
console.log('퍼스널컬러 진단 시스템 v2.0 로딩 시작');

/**
 * 메인 퍼스널컬러 분석기 클래스
 */
class PersonalColorAnalyzer {
    constructor() {
        console.log('PersonalColorAnalyzer 초기화 시작');
        
        // 앱 상태
        this.currentStep = 0;
        this.analysisMode = null;
        this.currentDrapingStep = 0;
        this.maxSteps = 4;
        
        // 진단 데이터
        this.analysisData = {
            mode: null,
            results: {},
            selectedColors: {},
            finalSeason: null,
            confidence: 92
        };
        
        // 드래이핑 색상 그룹
        this.drapingSteps = [
            {
                name: '온도감',
                description: '따뜻한 색상 vs 차가운 색상',
                colors: [
                    { type: 'warm', name: '골든 옐로우', color: '#FFD700' },
                    { type: 'warm', name: '코랄 오렌지', color: '#FF7F50' },
                    { type: 'warm', name: '피치', color: '#FFCBA4' },
                    { type: 'warm', name: '올리브', color: '#8FBC8F' },
                    { type: 'cool', name: '아이시 핑크', color: '#FF1493' },
                    { type: 'cool', name: '로얄 블루', color: '#4169E1' },
                    { type: 'cool', name: '에메랄드', color: '#50C878' },
                    { type: 'cool', name: '라벤더', color: '#E6E6FA' }
                ]
            },
            {
                name: '명도',
                description: '밝은 색상 vs 깊은 색상',
                colors: [
                    { type: 'light', name: '라이트 핑크', color: '#FFB6C1' },
                    { type: 'light', name: '스카이 블루', color: '#87CEEB' },
                    { type: 'light', name: '민트', color: '#98FF98' },
                    { type: 'light', name: '크림', color: '#FFFDD0' },
                    { type: 'deep', name: '딥 레드', color: '#8B0000' },
                    { type: 'deep', name: '네이비', color: '#000080' },
                    { type: 'deep', name: '포레스트', color: '#228B22' },
                    { type: 'deep', name: '초콜릿', color: '#7B3F00' }
                ]
            },
            {
                name: '채도',
                description: '선명한 색상 vs 부드러운 색상',
                colors: [
                    { type: 'vivid', name: '비비드 레드', color: '#FF0000' },
                    { type: 'vivid', name: '일렉트릭 블루', color: '#0080FF' },
                    { type: 'vivid', name: '라임', color: '#00FF00' },
                    { type: 'vivid', name: '머젠타', color: '#FF00FF' },
                    { type: 'soft', name: '더스티 로즈', color: '#C4A484' },
                    { type: 'soft', name: '세이지', color: '#9CAF88' },
                    { type: 'soft', name: '머브', color: '#B784A7' },
                    { type: 'soft', name: '스모키 블루', color: '#6A9BD1' }
                ]
            }
        ];
        
        // 터치 상태
        this.touchState = {
            startX: 0,
            startY: 0,
            isScrolling: false
        };
        
        // 타이머
        this.colorPreviewTimer = null;
        
        // 초기화
        this.init();
    }
    
    /**
     * 앱 초기화
     */
    init() {
        console.log('앱 초기화 시작');
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => this.initializeApp());
        } else {
            this.initializeApp();
        }
    }
    
    /**
     * 앱 완전 초기화
     */
    initializeApp() {
        console.log('앱 완전 초기화');
        
        try {
            this.setupEventListeners();
            this.setupSwipeGestures();
            this.registerGlobalFunctions();
            this.hideLoading();
            this.showStep(0);
            this.updateNavigation();
            
            console.log('앱 초기화 완료');
        } catch (error) {
            console.error('앱 초기화 오류:', error);
            this.showError('시스템을 초기화하는 중 오류가 발생했습니다.');
        }
    }
    
    /**
     * 이벤트 리스너 설정
     */
    setupEventListeners() {
        console.log('이벤트 리스너 설정');
        
        // 뒤로가기 이벤트
        window.addEventListener('popstate', () => {
            this.goBack();
        });
        
        // 키보드 이벤트
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                this.closeModal();
            } else if (e.key === 'ArrowLeft') {
                this.goBack();
            }
        });
    }
    
    /**
     * 스와이프 제스처 설정
     */
    setupSwipeGestures() {
        console.log('스와이프 제스처 설정');
        
        const app = document.getElementById('app');
        if (!app) return;
        
        app.addEventListener('touchstart', (e) => {
            this.touchState.startX = e.touches[0].clientX;
            this.touchState.startY = e.touches[0].clientY;
            this.touchState.isScrolling = false;
        }, { passive: true });
        
        app.addEventListener('touchmove', (e) => {
            if (!this.touchState.startX || !this.touchState.startY) return;
            
            const diffX = Math.abs(e.touches[0].clientX - this.touchState.startX);
            const diffY = Math.abs(e.touches[0].clientY - this.touchState.startY);
            
            if (diffY > diffX) {
                this.touchState.isScrolling = true;
            }
        }, { passive: true });
        
        app.addEventListener('touchend', (e) => {
            if (!this.touchState.startX || this.touchState.isScrolling) return;
            
            const diffX = e.changedTouches[0].clientX - this.touchState.startX;
            
            if (Math.abs(diffX) > 50) {
                if (diffX > 0 && this.currentStep > 0) {
                    this.goBack();
                }
            }
            
            this.touchState.startX = 0;
            this.touchState.startY = 0;
        }, { passive: true });
    }
    
    /**
     * 전역 함수 등록
     */
    registerGlobalFunctions() {
        window.selectMode = (mode) => this.selectAnalysisMode(mode);
        window.selectColor = (step, type, colorName, colorData) => this.selectColor(step, type, colorName, colorData);
        window.goBack = () => this.goBack();
        window.goNext = () => this.goNext();
        window.resetApp = () => this.resetApp();
        window.exportToPDF = () => this.exportToPDF();
        window.shareResults = () => this.shareResults();
        window.showExpertManual = () => this.showExpertManual();
        window.enterFullscreenDraping = (colorData) => this.enterFullscreenDraping(colorData);
    }
    
    /**
     * 로딩 화면 숨기기
     */
    hideLoading() {
        console.log('로딩 화면 숨김');
        
        const loading = document.getElementById('loading');
        const app = document.getElementById('app');
        
        if (loading && app) {
            setTimeout(() => {
                loading.style.display = 'none';
                app.style.display = 'block';
            }, 500);
        }
    }
    
    /**
     * 단계 표시
     */
    showStep(stepNumber) {
        console.log('단계 표시:', stepNumber);
        
        // 모든 단계 숨기기
        document.querySelectorAll('.step-content').forEach(step => {
            step.style.display = 'none';
            step.classList.remove('fade-in-up');
        });
        
        // 현재 단계 표시
        const currentStepElement = document.getElementById(`step-${stepNumber}`);
        if (currentStepElement) {
            currentStepElement.style.display = 'block';
            
            // 애니메이션 적용
            setTimeout(() => {
                currentStepElement.classList.add('fade-in-up');
            }, 50);
        }
        
        this.currentStep = stepNumber;
        this.updateNavigation();
        this.updateProgressIndicator();
    }
    
    /**
     * 네비게이션 업데이트
     */
    updateNavigation() {
        const thumbBackBtn = document.getElementById('thumbBackBtn');
        const thumbHomeBtn = document.getElementById('thumbHomeBtn');
        
        // 뒤로가기 버튼
        if (thumbBackBtn) {
            thumbBackBtn.style.display = this.currentStep > 0 ? 'flex' : 'none';
        }
        
        // 홈 버튼은 항상 표시
        if (thumbHomeBtn) {
            thumbHomeBtn.style.display = 'flex';
        }
    }
    
    /**
     * 진행률 표시기 업데이트
     */
    updateProgressIndicator() {
        const indicators = document.querySelectorAll('.progress-step');
        indicators.forEach((indicator, index) => {
            if (index < this.currentStep) {
                indicator.classList.add('completed');
                indicator.classList.remove('active');
            } else if (index === this.currentStep) {
                indicator.classList.add('active');
                indicator.classList.remove('completed');
            } else {
                indicator.classList.remove('active', 'completed');
            }
        });
    }
    
    /**
     * 분석 모드 선택
     */
    selectAnalysisMode(mode) {
        console.log('분석 모드 선택:', mode);
        
        this.analysisMode = mode;
        this.analysisData.mode = mode;
        
        if (mode === 'photo') {
            // 사진 기반 분석
            this.showPhotoAnalysis();
        } else if (mode === 'expert') {
            // 전문가 드래이핑 분석
            this.showDrapingAnalysis();
        }
    }
    
    /**
     * 사진 분석 표시
     */
    showPhotoAnalysis() {
        console.log('사진 분석 모드 시작');
        
        // 간단한 시뮬레이션으로 결과 생성
        setTimeout(() => {
            this.analysisData.finalSeason = 'Spring Light';
            this.analysisData.confidence = 85;
            this.showStep(3); // 결과 단계로 이동
        }, 2000);
    }
    
    /**
     * 드래이핑 분석 표시
     */
    showDrapingAnalysis() {
        console.log('드래이핑 분석 시작');
        this.currentDrapingStep = 0;
        this.showDrapingStep();
    }
    
    /**
     * 드래이핑 단계 표시
     */
    showDrapingStep() {
        const stepData = this.drapingSteps[this.currentDrapingStep];
        
        if (!stepData) {
            this.calculateResults();
            return;
        }
        
        const content = document.getElementById('step-content');
        if (!content) return;
        
        content.innerHTML = `
            <div class="draping-step fade-in-up">
                <div class="text-center mb-8">
                    <h2 class="mega-font-sm text-gray-800 mb-4">${stepData.name} 분석</h2>
                    <p class="large-font text-gray-600 mb-6">${stepData.description}</p>
                    <div class="text-lg text-purple-600 font-medium">
                        ${this.currentDrapingStep + 1} / ${this.drapingSteps.length} 단계
                    </div>
                </div>
                
                <div class="color-grid grid grid-cols-2 gap-4 max-w-2xl mx-auto">
                    ${stepData.colors.map(color => `
                        <div class="color-card bg-white rounded-2xl shadow-lg overflow-hidden cursor-pointer transition-all duration-300 hover:scale-105 hover:shadow-xl"
                             onclick="selectColor(${this.currentDrapingStep}, '${color.type}', '${color.name}', ${JSON.stringify(color).replace(/"/g, '&quot;')})"
                             style="aspect-ratio: 1; min-height: 120px;">
                            <div class="h-3/4 relative" style="background: ${color.color};">
                                <div class="absolute inset-0 bg-black bg-opacity-20 flex items-center justify-center">
                                    <span class="text-white font-bold text-lg text-center px-2 py-1 bg-black bg-opacity-50 rounded">
                                        ${color.name}
                                    </span>
                                </div>
                                <button class="absolute top-2 right-2 bg-white bg-opacity-80 rounded-full p-2 text-gray-600 hover:bg-white transition-colors"
                                        onclick="event.stopPropagation(); enterFullscreenDraping(${JSON.stringify(color).replace(/"/g, '&quot;')})">
                                    🎭
                                </button>
                            </div>
                            <div class="h-1/4 px-4 py-2 flex items-center justify-center">
                                <span class="text-sm font-medium text-gray-700">${color.type === 'warm' ? '따뜻함' : color.type === 'cool' ? '차가움' : color.type === 'light' ? '밝음' : color.type === 'deep' ? '깊음' : color.type === 'vivid' ? '선명함' : '부드러움'}</span>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
        
        this.showStep(1);
    }
    
    /**
     * 색상 선택 처리
     */
    selectColor(step, type, colorName, colorData) {
        console.log(`색상 선택: 단계${step}, 타입${type}, 색상${colorName}`);
        
        // 선택된 색상 저장
        this.analysisData.selectedColors[step] = {
            step,
            type,
            colorName,
            colorData
        };
        
        // 다음 단계로 진행
        this.currentDrapingStep++;
        
        if (this.currentDrapingStep < this.drapingSteps.length) {
            setTimeout(() => {
                this.showDrapingStep();
            }, 300);
        } else {
            this.calculateResults();
        }
    }
    
    /**
     * 결과 계산
     */
    calculateResults() {
        console.log('결과 계산 중...');
        
        const selections = this.analysisData.selectedColors;
        let season = 'Spring Light'; // 기본값
        
        // 간단한 알고리즘으로 계절 판정
        const warmCount = Object.values(selections).filter(s => s.type === 'warm').length;
        const coolCount = Object.values(selections).filter(s => s.type === 'cool').length;
        const lightCount = Object.values(selections).filter(s => s.type === 'light').length;
        const deepCount = Object.values(selections).filter(s => s.type === 'deep').length;
        const vividCount = Object.values(selections).filter(s => s.type === 'vivid').length;
        const softCount = Object.values(selections).filter(s => s.type === 'soft').length;
        
        // 계절 판정 로직
        if (warmCount > coolCount) {
            if (lightCount > deepCount) {
                season = vividCount > softCount ? 'Spring True' : 'Spring Light';
            } else {
                season = 'Spring Deep';
            }
        } else {
            if (lightCount > deepCount) {
                season = vividCount > softCount ? 'Summer True' : 'Summer Light';
            } else {
                season = 'Summer Deep';
            }
        }
        
        this.analysisData.finalSeason = season;
        this.analysisData.confidence = 92;
        
        setTimeout(() => {
            this.showResults();
        }, 1000);
    }
    
    /**
     * 결과 표시
     */
    showResults() {
        console.log('결과 표시');
        
        const season = this.analysisData.finalSeason;
        const confidence = this.analysisData.confidence;
        
        // 계절별 데이터 (간단한 버전)
        const seasonData = {
            'Spring Light': {
                name: '봄 라이트',
                description: '밝고 따뜻한 색상이 잘 어울리는 타입',
                colors: ['#FFD700', '#FF7F50', '#FFCBA4', '#98FB98', '#87CEEB', '#DDA0DD'],
                makeup: '코랄, 피치, 골든 톤',
                hair: '라이트 브라운, 골든 브라운',
                fashion: '아이보리, 베이지, 소프트 컬러'
            },
            'Spring True': {
                name: '봄 트루',
                description: '선명하고 따뜻한 색상이 잘 어울리는 타입',
                colors: ['#FF0000', '#FF8C00', '#FFD700', '#00FF00', '#1E90FF', '#9370DB'],
                makeup: '브라이트 레드, 코랄, 오렌지',
                hair: '골든 브라운, 구리색',
                fashion: '선명한 컬러, 따뜻한 톤'
            }
        };
        
        const data = seasonData[season] || seasonData['Spring Light'];
        
        const content = document.getElementById('step-content');
        if (!content) return;
        
        content.innerHTML = `
            <div class="result-content fade-in-up">
                <div class="result-header bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-3xl shadow-2xl p-8 mb-8">
                    <div class="text-center">
                        <h2 class="text-4xl font-bold mb-4">🎉 진단 완료!</h2>
                        <div class="result-font mb-4">${data.name}</div>
                        <p class="text-xl mb-6 opacity-90">${data.description}</p>
                        <div class="flex justify-center space-x-8 mb-6">
                            <div class="text-center">
                                <div class="text-3xl font-bold">${confidence}%</div>
                                <div class="text-sm opacity-80">정확도</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold">${this.analysisMode === 'photo' ? '사진분석' : '전문가급'}</div>
                                <div class="text-sm opacity-80">분석 방법</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="recommendations grid md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white rounded-2xl shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-3">💄 메이크업</h3>
                        <p class="text-gray-600">${data.makeup}</p>
                    </div>
                    <div class="bg-white rounded-2xl shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-3">💇‍♀️ 헤어</h3>
                        <p class="text-gray-600">${data.hair}</p>
                    </div>
                    <div class="bg-white rounded-2xl shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-3">👗 패션</h3>
                        <p class="text-gray-600">${data.fashion}</p>
                    </div>
                </div>
                
                <div class="color-palette bg-white rounded-2xl shadow-lg p-6 mb-8">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6 text-center">🎨 추천 컬러 팔레트</h3>
                    <div class="grid grid-cols-6 gap-4">
                        ${data.colors.map(color => `
                            <div class="palette-color aspect-square rounded-xl shadow-lg transition-all duration-300 hover:scale-110 hover:shadow-xl"
                                 style="background: ${color};"
                                 title="${color}">
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="text-center space-y-4">
                    <div class="flex justify-center space-x-4">
                        <button onclick="shareResults()" 
                                class="bg-green-500 text-white px-6 py-3 rounded-xl hover:bg-green-600 transition-all font-bold">
                            📱 결과 공유하기
                        </button>
                        <button onclick="exportToPDF()" 
                                class="bg-blue-500 text-white px-6 py-3 rounded-xl hover:bg-blue-600 transition-all font-bold">
                            📄 PDF로 저장
                        </button>
                    </div>
                    <button onclick="resetApp()" 
                            class="bg-gray-500 text-white px-6 py-3 rounded-xl hover:bg-gray-600 transition-all font-bold">
                        🔄 다시 진단하기
                    </button>
                </div>
            </div>
        `;
        
        this.showStep(3);
    }
    
    /**
     * 뒤로가기
     */
    goBack() {
        if (this.currentStep > 0) {
            this.showStep(this.currentStep - 1);
        }
    }
    
    /**
     * 앱 리셋
     */
    resetApp() {
        console.log('앱 리셋');
        
        this.currentStep = 0;
        this.analysisMode = null;
        this.currentDrapingStep = 0;
        this.analysisData = {
            mode: null,
            results: {},
            selectedColors: {},
            finalSeason: null,
            confidence: 0
        };
        
        this.showStep(0);
    }
    
    /**
     * 전문가 매뉴얼 표시
     */
    showExpertManual() {
        console.log('전문가 매뉴얼 표시');
        
        const modal = document.getElementById('expertManualModal');
        if (!modal) return;
        
        modal.innerHTML = `
            <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                <div class="bg-white rounded-3xl max-w-4xl max-h-[90vh] overflow-y-auto p-8 relative">
                    <button onclick="this.closest('.fixed').classList.add('hidden')" 
                            class="absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-2xl font-bold">
                        ✕
                    </button>
                    
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-bold text-gray-800 mb-4">📖 전문가 매뉴얼</h2>
                        <p class="text-lg text-gray-600">과학적 퍼스널컬러 진단 방법</p>
                    </div>
                    
                    <div class="space-y-6">
                        <div class="bg-blue-50 p-6 rounded-2xl">
                            <h3 class="text-xl font-bold text-blue-800 mb-3">🔬 과학적 기반</h3>
                            <p class="text-blue-700">Munsell 색체계와 Von Kries 이론을 기반으로 한 정확한 색상 분석</p>
                        </div>
                        
                        <div class="bg-green-50 p-6 rounded-2xl">
                            <h3 class="text-xl font-bold text-green-800 mb-3">📋 3단계 진단</h3>
                            <ul class="text-green-700 space-y-2">
                                <li><strong>1단계:</strong> 온도감 (따뜻함 vs 차가움)</li>
                                <li><strong>2단계:</strong> 명도 (밝음 vs 깊음)</li>
                                <li><strong>3단계:</strong> 채도 (선명함 vs 부드러움)</li>
                            </ul>
                        </div>
                        
                        <div class="bg-purple-50 p-6 rounded-2xl">
                            <h3 class="text-xl font-bold text-purple-800 mb-3">🎯 사용법</h3>
                            <p class="text-purple-700">각 단계에서 더 잘 어울린다고 생각하는 색상을 선택하세요. 전체화면 미리보기로 실제 효과를 확인할 수 있습니다.</p>
                        </div>
                        
                        <div class="bg-orange-50 p-6 rounded-2xl">
                            <h3 class="text-xl font-bold text-orange-800 mb-3">📊 정확도</h3>
                            <p class="text-orange-700">전문가급 드래이핑: 92% 정확도 | 사진 기반 분석: 85% 정확도</p>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        modal.classList.remove('hidden');
    }
    
    /**
     * 전체화면 드래이핑
     */
    enterFullscreenDraping(colorData) {
        console.log('전체화면 드래이핑:', colorData);
        
        const modal = document.getElementById('fullscreenModal');
        if (!modal) return;
        
        modal.innerHTML = `
            <div class="fixed inset-0 z-50" style="background: ${colorData.color};">
                <div class="flex items-center justify-center h-full relative">
                    <button onclick="this.closest('.fixed').classList.add('hidden')" 
                            class="absolute top-6 right-6 bg-white bg-opacity-80 text-gray-800 hover:bg-white rounded-full p-3 text-xl font-bold transition-all">
                        ✕
                    </button>
                    
                    <div class="text-center text-white">
                        <h2 class="text-4xl font-bold mb-4" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.5);">
                            ${colorData.name}
                        </h2>
                        <p class="text-xl opacity-90" style="text-shadow: 1px 1px 2px rgba(0,0,0,0.5);">
                            이 색상이 얼굴에 주는 효과를 확인해보세요
                        </p>
                        <div class="mt-8 text-lg opacity-80">
                            화면을 터치하거나 ✕ 버튼을 눌러 닫기
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        modal.classList.remove('hidden');
        
        // 자동으로 2초 후 닫기
        setTimeout(() => {
            modal.classList.add('hidden');
        }, 2000);
    }
    
    /**
     * 결과 공유
     */
    shareResults() {
        console.log('결과 공유');
        
        const shareData = {
            title: '퍼스널컬러 진단 결과',
            text: `내 퍼스널컬러는 ${this.analysisData.finalSeason}입니다! (정확도: ${this.analysisData.confidence}%)`,
            url: window.location.href
        };
        
        if (navigator.share && navigator.canShare && navigator.canShare(shareData)) {
            navigator.share(shareData).catch(console.error);
        } else if (navigator.clipboard) {
            const shareText = `${shareData.text} ${shareData.url}`;
            navigator.clipboard.writeText(shareText).then(() => {
                alert('결과가 클립보드에 복사되었습니다!');
            }).catch(() => {
                alert('공유 기능을 사용할 수 없습니다.');
            });
        }
    }
    
    /**
     * PDF 내보내기
     */
    exportToPDF() {
        console.log('PDF 내보내기');
        alert('PDF 내보내기 기능은 곧 제공될 예정입니다.');
    }
    
    /**
     * 모달 닫기
     */
    closeModal() {
        const modals = document.querySelectorAll('.fixed');
        modals.forEach(modal => {
            if (!modal.classList.contains('hidden')) {
                modal.classList.add('hidden');
            }
        });
    }
    
    /**
     * 오류 표시
     */
    showError(message) {
        console.error('오류:', message);
        alert(message);
    }
    
    /**
     * 현재 시간 가져오기
     */
    getCurrentDateTime() {
        return new Date().toLocaleString('ko-KR', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit'
        });
    }
}

// 전역 함수들 (HTML에서 직접 호출)
function selectMode(mode) {
    if (window.app) {
        window.app.selectAnalysisMode(mode);
    }
}

function selectColor(step, type, colorName, colorData) {
    if (window.app) {
        window.app.selectColor(step, type, colorName, colorData);
    }
}

function goBack() {
    if (window.app) {
        window.app.goBack();
    }
}

function resetApp() {
    if (window.app) {
        window.app.resetApp();
    }
}

function exportToPDF() {
    if (window.app) {
        window.app.exportToPDF();
    }
}

function shareResults() {
    if (window.app) {
        window.app.shareResults();
    }
}

function showExpertManual() {
    if (window.app) {
        window.app.showExpertManual();
    }
}

function enterFullscreenDraping(colorData) {
    if (window.app) {
        window.app.enterFullscreenDraping(colorData);
    }
}

// 앱 인스턴스 생성 및 초기화
let app = null;

document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM 로드 완료 - 앱 초기화 시작');
    
    try {
        app = new PersonalColorAnalyzer();
        window.app = app;
        console.log('앱 인스턴스 생성 완료');
    } catch (error) {
        console.error('앱 초기화 실패:', error);
        alert('애플리케이션을 초기화하는 중 오류가 발생했습니다. 페이지를 새로고침해주세요.');
    }
});

// 전역 오류 핸들러
window.addEventListener('error', function(e) {
    console.error('전역 JavaScript 오류:', e.error);
});

window.addEventListener('unhandledrejection', function(e) {
    console.error('처리되지 않은 Promise 거부:', e.reason);
});

console.log('app.js 로딩 완료');
