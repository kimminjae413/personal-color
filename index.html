<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Color Analyzer Pro - 헤어디자이너 전용</title>
    
    <!-- PWA 메타데이터 -->
    <meta name="description" content="헤어디자이너를 위한 전문 퍼스널컬러 진단 시스템">
    <meta name="theme-color" content="#6366f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- PWA 매니페스트 -->
    <link rel="manifest" href="manifest.json">
    
    <!-- 아이콘들 -->
    <link rel="icon" type="image/png" sizes="32x32" href="assets/images/icons/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="192x192" href="assets/images/icons/icon-192x192.png">
    <link rel="apple-touch-icon" href="assets/images/icons/icon-192x192.png">
    
    <!-- Google Fonts (404 오류 해결) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- 인라인 핵심 CSS -->
    <style>
        /* CSS 변수 */
        :root {
            --font-korean: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            --font-english: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            --primary-color: #6366f1;
            --secondary-color: #8b5cf6;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --border-color: #e5e7eb;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-korean);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            overflow: hidden;
        }

        /* 로딩 스크린 */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .loading-container {
            text-align: center;
            color: white;
            max-width: 600px;
            padding: 2rem;
        }

        .loading-logo h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            animation: logoGlow 2s ease-in-out infinite alternate;
        }

        .loading-logo p {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 3rem;
        }

        @keyframes logoGlow {
            0% { text-shadow: 0 2px 4px rgba(0,0,0,0.3), 0 0 20px rgba(255,255,255,0.1); }
            100% { text-shadow: 0 2px 4px rgba(0,0,0,0.3), 0 0 30px rgba(255,255,255,0.3); }
        }

        .loading-progress-container {
            margin-bottom: 2rem;
        }

        .loading-progress-bar {
            width: 400px;
            height: 6px;
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
            overflow: hidden;
            margin: 0 auto 1rem;
        }

        .loading-progress {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #feca57, #48dbfb, #ff9ff3);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .loading-message {
            font-size: 1.1rem;
            font-weight: 500;
        }

        .loading-details {
            margin-top: 2rem;
        }

        .loading-step {
            margin: 0.5rem 0;
            font-size: 0.95rem;
            opacity: 0.8;
            transition: opacity 0.3s ease;
        }

        .loading-step.active {
            opacity: 1;
            font-weight: 500;
        }

        /* 메인 앱 */
        .main-app {
            display: none;
            height: 100vh;
            background: var(--bg-primary);
            position: relative;
        }

        /* 헤더 */
        .app-header {
            background: white;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 2rem;
            box-shadow: var(--shadow-sm);
            border-bottom: 1px solid var(--border-color);
        }

        .app-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin: 0;
        }

        .current-customer {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .header-btn {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.9rem;
            color: var(--text-primary);
            transition: all 0.2s ease;
            margin-left: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .header-btn:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        /* 메인 컨텐츠 */
        .main-content {
            height: calc(100vh - 80px);
            overflow-y: auto;
            padding: 2rem;
            background: var(--bg-secondary);
        }

        .diagnosis-mode-selection h2 {
            text-align: center;
            font-size: 2rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 3rem;
        }

        .mode-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .mode-card {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            box-shadow: var(--shadow-lg);
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .mode-card.selected {
            border-color: var(--primary-color);
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
        }

        .mode-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04);
            border-color: var(--primary-color);
        }

        .mode-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.1));
        }

        .mode-card h3 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
        }

        .mode-card.selected h3 {
            color: white;
        }

        .mode-card p {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .mode-card.selected p {
            color: rgba(255,255,255,0.9);
        }

        .mode-accuracy {
            display: inline-block;
            background: var(--success-color);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 500;
            margin-bottom: 1.5rem;
        }

        .mode-select-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
            width: 100%;
        }

        .mode-select-btn:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .mode-select-btn.recommended {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            position: relative;
        }

        .mode-select-btn.recommended::before {
            content: '⭐ ';
        }

        /* 진단 영역 */
        .diagnosis-area {
            display: none;
        }

        .diagnosis-area.active {
            display: block;
        }

        .diagnosis-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* AI 모드 컨테이너 */
        .ai-mode-container {
            display: none;
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: var(--shadow-lg);
        }

        .ai-mode-container.active {
            display: block;
        }

        .ai-mode-container h3 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 2rem;
            color: var(--text-primary);
        }

        .camera-container {
            position: relative;
            width: 100%;
            max-width: 640px;
            height: 480px;
            margin: 0 auto 2rem;
            border-radius: 12px;
            overflow: hidden;
            background: #f0f0f0;
        }

        .camera-preview {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .camera-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0,0,0,0.3);
            color: white;
            font-size: 1.2rem;
            font-weight: 500;
        }

        .camera-controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .camera-controls button {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .primary-btn {
            background: var(--primary-color);
            color: white;
        }

        .primary-btn:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .secondary-btn {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .secondary-btn:hover {
            background: var(--border-color);
        }

        /* 드레이핑 모드 컨테이너 */
        .draping-mode-container {
            display: none;
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: var(--shadow-lg);
        }

        .draping-mode-container.active {
            display: block;
        }

        .draping-mode-container h3 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 2rem;
            color: var(--text-primary);
        }

        .draping-workspace {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .color-palette {
            background: var(--bg-secondary);
            padding: 1.5rem;
            border-radius: 12px;
        }

        .color-palette h4 {
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .color-swatches {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
        }

        .color-swatch {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 3px solid transparent;
        }

        .color-swatch:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-md);
        }

        .color-swatch.selected {
            border-color: var(--primary-color);
            transform: scale(1.15);
        }

        .draping-notes {
            background: var(--bg-secondary);
            padding: 1.5rem;
            border-radius: 12px;
        }

        .draping-notes h4 {
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .draping-notes textarea {
            width: 100%;
            height: 200px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
            font-family: inherit;
            resize: vertical;
        }

        .draping-controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .draping-controls button {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        /* 결과 영역 */
        .diagnosis-result {
            display: none;
        }

        .diagnosis-result.active {
            display: block;
        }

        .result-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: var(--shadow-lg);
        }

        .result-container h2 {
            text-align: center;
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 2rem;
            color: var(--text-primary);
        }

        .result-summary {
            text-align: center;
            margin-bottom: 2rem;
        }

        .season-badge {
            display: inline-block;
            background: var(--primary-color);
            color: white;
            padding: 1rem 2rem;
            border-radius: 16px;
            margin-bottom: 1.5rem;
        }

        .season-name {
            font-size: 1.5rem;
            font-weight: 600;
            display: block;
        }

        .confidence {
            font-size: 1rem;
            opacity: 0.9;
        }

        .result-details {
            background: var(--bg-secondary);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 2rem;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .detail-item:last-child {
            margin-bottom: 0;
        }

        .label {
            font-weight: 500;
            color: var(--text-secondary);
        }

        .value {
            font-weight: 600;
            color: var(--text-primary);
        }

        .result-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .result-actions button {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        /* 사이드바 */
        .sidebar {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: white;
            box-shadow: -4px 0 20px rgba(0,0,0,0.1);
            z-index: 1000;
            transition: right 0.3s ease;
        }

        .sidebar.show {
            right: 0;
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sidebar-header h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .close-sidebar {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
        }

        .sidebar-content {
            padding: 1.5rem;
        }

        /* 반응형 */
        @media (max-width: 768px) {
            .loading-logo h1 {
                font-size: 2.5rem;
            }
            
            .loading-progress-bar {
                width: 300px;
            }
            
            .main-content {
                padding: 1rem;
            }
            
            .mode-cards {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            
            .draping-workspace {
                grid-template-columns: 1fr;
            }
        }

        /* 애니메이션 */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .main-app.loaded {
            animation: fadeInUp 0.6s ease-out;
        }

        /* 토스트 메시지 */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            pointer-events: none;
        }

        .toast {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 10px;
            padding: 16px;
            pointer-events: auto;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            border-left: 4px solid var(--primary-color);
            min-width: 300px;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast-success {
            border-left-color: var(--success-color);
        }

        .toast-error {
            border-left-color: var(--error-color);
        }

        .toast-warning {
            border-left-color: var(--warning-color);
        }

        .toast-content {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .toast-close {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            margin-left: auto;
        }
    </style>

    <!-- 외부 CSS 파일들 (비동기 로드, 404 오류 방지) -->
    <link rel="preload" href="css/styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'" onerror="console.warn('styles.css 로드 실패')">
    <link rel="preload" href="css/tablet.css" as="style" onload="this.onload=null;this.rel='stylesheet'" onerror="console.warn('tablet.css 로드 실패')">
    <link rel="preload" href="css/components.css" as="style" onload="this.onload=null;this.rel='stylesheet'" onerror="console.warn('components.css 로드 실패')">
    <link rel="preload" href="css/animations.css" as="style" onload="this.onload=null;this.rel='stylesheet'" onerror="console.warn('animations.css 로드 실패')">
    
    <noscript>
        <link rel="stylesheet" href="css/styles.css">
        <link rel="stylesheet" href="css/tablet.css">
        <link rel="stylesheet" href="css/components.css">
        <link rel="stylesheet" href="css/animations.css">
    </noscript>
</head>

<body>
    <!-- 로딩 스크린 -->
    <div class="loading-screen" id="loading-screen">
        <div class="loading-container">
            <div class="loading-logo">
                <h1>Personal Color Pro</h1>
                <p>헤어디자이너 전용 진단 시스템</p>
            </div>
            
            <div class="loading-progress-container">
                <div class="loading-progress-bar">
                    <div class="loading-progress" id="loading-progress" style="width: 0%"></div>
                </div>
                <div class="loading-message" id="loading-message">시스템 초기화 중...</div>
            </div>
            
            <div class="loading-details">
                <div class="loading-step" id="step-config">⏳ 설정 로드 중...</div>
                <div class="loading-step" id="step-modules">⏳ 모듈 로드 중...</div>
                <div class="loading-step" id="step-ai">⏳ AI 시스템 준비 중...</div>
                <div class="loading-step" id="step-ui">⏳ UI 초기화 중...</div>
            </div>
        </div>
    </div>

    <!-- 메인 애플리케이션 -->
    <div class="main-app" id="main-app">
        <!-- 헤더 -->
        <header class="app-header">
            <div class="header-left">
                <div>
                    <h1 class="app-title">Personal Color Pro</h1>
                    <div class="current-customer" id="current-customer">고객을 선택해주세요</div>
                </div>
            </div>
            
            <div class="header-right">
                <button id="customer-management" class="header-btn" title="고객 관리">
                    👥 고객 관리
                </button>
                
                <button id="settings-btn" class="header-btn" title="설정">
                    ⚙️ 설정
                </button>
            </div>
        </header>

        <!-- 메인 컨텐츠 -->
        <main class="main-content">
            <!-- 진단 모드 선택 -->
            <section class="diagnosis-mode-selection" id="mode-selection">
                <h2>진단 모드를 선택하세요</h2>
                
                <div class="mode-cards">
                    <div class="mode-card" data-mode="ai_photo" tabindex="0">
                        <div class="mode-icon">🤖</div>
                        <h3>AI 사진 분석</h3>
                        <p>스마트폰으로 간편하게<br>5-7분 소요</p>
                        <div class="mode-accuracy">정확도: 85%</div>
                        <button class="mode-select-btn">선택</button>
                    </div>
                    
                    <div class="mode-card" data-mode="draping" tabindex="0">
                        <div class="mode-icon">🎨</div>
                        <h3>전문가 드레이핑</h3>
                        <p>색상 천을 활용한 정밀 진단<br>15-20분 소요</p>
                        <div class="mode-accuracy">정확도: 95%</div>
                        <button class="mode-select-btn">선택</button>
                    </div>
                    
                    <div class="mode-card" data-mode="hybrid" tabindex="0">
                        <div class="mode-icon">⚡</div>
                        <h3>하이브리드</h3>
                        <p>AI + 전문가 검증<br>10-15분 소요</p>
                        <div class="mode-accuracy">정확도: 98%</div>
                        <button class="mode-select-btn recommended">추천</button>
                    </div>
                </div>
            </section>

            <!-- 진단 영역 -->
            <section class="diagnosis-area" id="diagnosis-area">
                <div class="diagnosis-container">
                    <!-- AI 모드 컨테이너 -->
                    <div class="ai-mode-container" id="ai-mode-container">
                        <h3>📷 AI 사진 분석</h3>
                        <div class="camera-container">
                            <video class="camera-preview" id="camera-preview" autoplay muted playsinline></video>
                            <canvas id="analysis-canvas" style="display: none;"></canvas>
                            <div class="camera-overlay">
                                <div class="face-guide">얼굴을 프레임에 맞춰주세요</div>
                            </div>
                        </div>
                        
                        <div class="camera-controls">
                            <button id="capture-btn" class="primary-btn">📸 촬영</button>
                            <button id="upload-btn" class="secondary-btn">📁 파일 선택</button>
                            <input type="file" id="file-input" accept="image/*" style="display: none;">
                        </div>
                    </div>
                    
                    <!-- 드레이핑 모드 컨테이너 -->
                    <div class="draping-mode-container" id="draping-mode-container">
                        <h3>🎨 전문가 드레이핑</h3>
                        <div class="draping-workspace">
                            <div class="color-palette">
                                <h4>테스트 색상</h4>
                                <div class="color-swatches">
                                    <div class="color-swatch" data-color="#FF6B6B" style="background: #FF6B6B;" title="코랄 핑크"></div>
                                    <div class="color-swatch" data-color="#4ECDC4" style="background: #4ECDC4;" title="터쿼이즈"></div>
                                    <div class="color-swatch" data-color="#45B7D1" style="background: #45B7D1;" title="스카이 블루"></div>
                                    <div class="color-swatch" data-color="#96CEB4" style="background: #96CEB4;" title="민트 그린"></div>
                                    <div class="color-swatch" data-color="#FECA57" style="background: #FECA57;" title="골든 옐로우"></div>
                                    <div class="color-swatch" data-color="#FF9FF3" style="background: #FF9FF3;" title="라벤더 핑크"></div>
                                    <div class="color-swatch" data-color="#54A0FF" style="background: #54A0FF;" title="브라이트 블루"></div>
                                    <div class="color-swatch" data-color="#5F27CD" style="background: #5F27CD;" title="딥 퍼플"></div>
                                </div>
                            </div>
                            
                            <div class="draping-notes">
                                <h4>관찰 메모</h4>
                                <textarea id="draping-notes" placeholder="색상별 피부 반응을 기록하세요...&#10;&#10;예시:&#10;• 코랄 핑크: 피부가 밝아 보임&#10;• 터쿼이즈: 혈색이 좋아 보임&#10;• 스카이 블루: 피부톤과 잘 어울림"></textarea>
                            </div>
                        </div>
                        
                        <div class="draping-controls">
                            <button id="add-comparison" class="primary-btn">비교 추가</button>
                            <button id="complete-draping" class="secondary-btn">진단 완료</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 결과 영역 -->
            <section class="diagnosis-result" id="diagnosis-result">
                <div class="result-container">
                    <h2>🎉 진단 결과</h2>
                    
                    <div class="result-summary">
                        <div class="season-badge">
                            <span class="season-name">봄 웜톤</span>
                            <span class="confidence">92% 확신</span>
                        </div>
                        
                        <div class="result-details">
                            <div class="detail-item">
                                <span class="label">피부 톤:</span>
                                <span class="value">따뜻한 톤</span>
                            </div>
                            <div class="detail-item">
                                <span class="label">밝기:</span>
                                <span class="value">밝은 톤</span>
                            </div>
                            <div class="detail-item">
                                <span class="label">채도:</span>
                                <span class="value">선명한 톤</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="result-actions">
                        <button id="generate-report" class="primary-btn">
                            📊 PDF 보고서 생성
                        </button>
                        <button id="save-result" class="secondary-btn">
                            💾 결과 저장
                        </button>
                        <button id="new-diagnosis" class="secondary-btn">
                            🔄 새 진단
                        </button>
                    </div>
                </div>
            </section>
        </main>

        <!-- 사이드바 (고객 관리) -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h3>고객 관리</h3>
                <button class="close-sidebar" id="close-sidebar">✕</button>
            </div>
            
            <div class="sidebar-content">
                <div class="customer-search">
                    <input type="text" placeholder="고객 검색..." id="customer-search">
                </div>
                
                <div class="customer-list" id="customer-list">
                    <p style="text-align: center; color: #6b7280; margin-top: 2rem;">등록된 고객이 없습니다.</p>
                </div>
                
                <button id="add-customer" class="header-btn" style="width: 100%; justify-content: center; margin-top: 1rem;">
                    ➕ 새 고객 추가
                </button>
            </div>
        </aside>
    </div>

    <!-- 토스트 메시지 컨테이너 -->
    <div class="toast-container" id="toast-container"></div>

    <!-- JavaScript 시작 -->
    <script>
        // 전역 설정
        window.PersonalColorApp = {
            version: '1.0.0',
            buildTime: new Date().toISOString(),
            isLoaded: false,
            currentMode: 'selection',
            customer: null,
            diagnosis: null,
            drapingData: {
                selectedColors: [],
                notes: '',
                comparisons: []
            }
        };

        // 로딩 관리자
        class LoadingManager {
            constructor() {
                this.currentProgress = 0;
                this.isComplete = false;
            }

            updateProgress(percentage, message) {
                this.currentProgress = Math.min(100, Math.max(0, percentage));
                
                const progressBar = document.getElementById('loading-progress');
                const messageEl = document.getElementById('loading-message');
                
                if (progressBar) {
                    progressBar.style.width = this.currentProgress + '%';
                }
                
                if (messageEl && message) {
                    messageEl.textContent = message;
                }
            }

            updateStep(stepId, status, customMessage) {
                const step = document.getElementById(stepId);
                if (!step) return;

                const icon = status === 'complete' ? '✅' : 
                            status === 'error' ? '❌' : 
                            status === 'active' ? '⏳' : '⏳';
                
                const message = customMessage || step.textContent.replace(/[⏳✅❌]\s*/, '');
                step.textContent = `${icon} ${message}`;
                
                if (status === 'active') {
                    step.classList.add('active');
                } else {
                    step.classList.remove('active');
                }
            }

            complete() {
                if (this.isComplete) return;
                this.isComplete = true;
                
                this.updateProgress(100, '준비 완료!');
                
                setTimeout(() => {
                    document.getElementById('loading-screen').style.display = 'none';
                    const mainApp = document.getElementById('main-app');
                    mainApp.style.display = 'block';
                    mainApp.classList.add('loaded');
                    window.PersonalColorApp.isLoaded = true;
                    
                    // 로딩 완료 이벤트
                    window.dispatchEvent(new CustomEvent('appLoaded'));
                }, 300);
            }
        }

        // 전역 로딩 관리자
        window.loadingManager = new LoadingManager();

        // 모드 관리자
        class ModeManager {
            constructor() {
                this.currentMode = 'selection';
                this.setupModeSelection();
            }

            setupModeSelection() {
                document.querySelectorAll('.mode-card').forEach(card => {
                    card.addEventListener('click', (e) => {
                        const mode = card.getAttribute('data-mode');
                        this.switchToMode(mode);
                    });
                });
            }

            switchToMode(mode) {
                console.log(`🔄 모드 전환: ${this.currentMode} → ${mode}`);
                
                // 모든 카드에서 selected 클래스 제거
                document.querySelectorAll('.mode-card').forEach(card => {
                    card.classList.remove('selected');
                });
                
                // 선택된 카드에 selected 클래스 추가
                const selectedCard = document.querySelector(`.mode-card[data-mode="${mode}"]`);
                if (selectedCard) {
                    selectedCard.classList.add('selected');
                }

                // UI 업데이트
                this.updateModeUI(mode);
                
                // 상태 업데이트
                this.currentMode = mode;
                window.PersonalColorApp.currentMode = mode;
                
                // 모드별 초기화
                this.initializeMode(mode);
                
                // 토스트 메시지
                this.showToast(`${this.getModeDisplayName(mode)} 모드로 전환되었습니다.`, 'success');
            }

            updateModeUI(mode) {
                const modeSelection = document.getElementById('mode-selection');
                const diagnosisArea = document.getElementById('diagnosis-area');
                const aiContainer = document.getElementById('ai-mode-container');
                const drapingContainer = document.getElementById('draping-mode-container');
                const resultArea = document.getElementById('diagnosis-result');

                // 모든 영역 숨기기
                if (modeSelection) modeSelection.style.display = 'none';
                if (diagnosisArea) diagnosisArea.style.display = 'none';
                if (aiContainer) aiContainer.classList.remove('active');
                if (drapingContainer) drapingContainer.classList.remove('active');
                if (resultArea) resultArea.classList.remove('active');

                // 선택된 모드에 따라 표시
                if (mode === 'selection') {
                    if (modeSelection) modeSelection.style.display = 'block';
                } else {
                    if (diagnosisArea) {
                        diagnosisArea.style.display = 'block';
                        diagnosisArea.classList.add('active');
                    }
                    
                    if (mode === 'ai_photo' || mode === 'hybrid') {
                        if (aiContainer) aiContainer.classList.add('active');
                    }
                    
                    if (mode === 'draping' || mode === 'hybrid') {
                        if (drapingContainer) drapingContainer.classList.add('active');
                    }
                }
            }

            initializeMode(mode) {
                switch (mode) {
                    case 'ai_photo':
                    case 'hybrid':
                        this.initializeAIMode();
                        break;
                    case 'draping':
                        this.initializeDrapingMode();
                        break;
                }
            }

            initializeAIMode() {
                console.log('📷 AI 모드 초기화');
                
                // 카메라 버튼 이벤트
                const captureBtn = document.getElementById('capture-btn');
                const uploadBtn = document.getElementById('upload-btn');
                const fileInput = document.getElementById('file-input');

                if (captureBtn) {
                    captureBtn.onclick = () => this.capturePhoto();
                }

                if (uploadBtn && fileInput) {
                    uploadBtn.onclick = () => fileInput.click();
                    fileInput.onchange = (e) => {
                        if (e.target.files.length > 0) {
                            this.handleFileUpload(e.target.files[0]);
                        }
                    };
                }

                // 카메라 시작 시도
                this.startCamera();
            }

            initializeDrapingMode() {
                console.log('🎨 드레이핑 모드 초기화');
                
                // 색상 견본 이벤트
                document.querySelectorAll('.color-swatch').forEach(swatch => {
                    swatch.addEventListener('click', (e) => {
                        const color = e.target.getAttribute('data-color');
                        this.selectDrapingColor(color, e.target);
                    });
                });

                // 드레이핑 버튼 이벤트
                const addComparisonBtn = document.getElementById('add-comparison');
                const completeDrapingBtn = document.getElementById('complete-draping');

                if (addComparisonBtn) {
                    addComparisonBtn.onclick = () => this.addDrapingComparison();
                }

                if (completeDrapingBtn) {
                    completeDrapingBtn.onclick = () => this.completeDraping();
                }
            }

            async startCamera() {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ 
                        video: { 
                            width: 640, 
                            height: 480,
                            facingMode: 'user'
                        } 
                    });
                    
                    const video = document.getElementById('camera-preview');
                    if (video) {
                        video.srcObject = stream;
                        
                        // 오버레이 숨기기
                        const overlay = document.querySelector('.camera-overlay');
                        if (overlay) {
                            overlay.style.display = 'none';
                        }
                    }
                    
                    console.log('📷 카메라 시작됨');
                } catch (error) {
                    console.warn('카메라 시작 실패:', error);
                    this.showToast('카메라에 접근할 수 없습니다. 파일 업로드를 이용해주세요.', 'warning');
                }
            }

            capturePhoto() {
                const video = document.getElementById('camera-preview');
                const canvas = document.getElementById('analysis-canvas');
                
                if (!video || !canvas) return;

                const ctx = canvas.getContext('2d');
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                ctx.drawImage(video, 0, 0);

                // Mock 분석 결과
                setTimeout(() => {
                    const mockResult = {
                        season: 'spring',
                        confidence: 87,
                        undertone: 'warm',
                        lightness: 'light',
                        saturation: 'medium'
                    };
                    this.showDiagnosisResult(mockResult);
                }, 2000);

                this.showToast('사진을 분석하고 있습니다...', 'info');
            }

            handleFileUpload(file) {
                if (!file.type.startsWith('image/')) {
                    this.showToast('이미지 파일을 선택해주세요.', 'error');
                    return;
                }

                this.showToast('이미지를 분석하고 있습니다...', 'info');

                // Mock 분석
                setTimeout(() => {
                    const mockResult = {
                        season: 'summer',
                        confidence: 91,
                        undertone: 'cool',
                        lightness: 'light',
                        saturation: 'medium'
                    };
                    this.showDiagnosisResult(mockResult);
                }, 2000);
            }

            selectDrapingColor(color, element) {
                console.log('색상 선택:', color);
                
                // 이전 선택 해제
                document.querySelectorAll('.color-swatch').forEach(swatch => {
                    swatch.classList.remove('selected');
                });
                
                // 현재 선택 표시
                element.classList.add('selected');
                
                // 데이터 저장
                window.PersonalColorApp.drapingData.selectedColors.push({
                    color: color,
                    timestamp: new Date(),
                    notes: ''
                });
                
                this.showToast(`색상 ${color}이(가) 선택되었습니다.`, 'success');
            }

            addDrapingComparison() {
                const selectedColors = window.PersonalColorApp.drapingData.selectedColors;
                const notes = document.getElementById('draping-notes').value;
                
                if (selectedColors.length === 0) {
                    this.showToast('먼저 테스트할 색상을 선택해주세요.', 'warning');
                    return;
                }

                window.PersonalColorApp.drapingData.comparisons.push({
                    colors: [...selectedColors],
                    notes: notes,
                    timestamp: new Date()
                });

                // 데이터 초기화
                window.PersonalColorApp.drapingData.selectedColors = [];
                document.getElementById('draping-notes').value = '';
                document.querySelectorAll('.color-swatch').forEach(swatch => {
                    swatch.classList.remove('selected');
                });

                this.showToast('비교 데이터가 추가되었습니다.', 'success');
            }

            completeDraping() {
                const comparisons = window.PersonalColorApp.drapingData.comparisons;
                
                if (comparisons.length === 0) {
                    this.showToast('최소 한 번의 색상 비교를 완료해주세요.', 'warning');
                    return;
                }

                // Mock 드레이핑 결과 생성
                const mockResult = {
                    season: 'autumn',
                    confidence: 93,
                    undertone: 'warm',
                    lightness: 'dark',
                    saturation: 'rich',
                    drapingData: comparisons
                };

                this.showDiagnosisResult(mockResult);
            }

            showDiagnosisResult(result) {
                console.log('✅ 진단 결과:', result);
                
                window.PersonalColorApp.diagnosis = result;
                
                // 결과 영역 표시
                const diagnosisArea = document.getElementById('diagnosis-area');
                const resultArea = document.getElementById('diagnosis-result');
                
                if (diagnosisArea) diagnosisArea.style.display = 'none';
                if (resultArea) {
                    resultArea.style.display = 'block';
                    resultArea.classList.add('active');
                }
                
                // 결과 내용 업데이트
                this.updateResultDisplay(result);
                
                // 결과 버튼 이벤트 설정
                this.setupResultButtons();
                
                this.currentMode = 'results';
                window.PersonalColorApp.currentMode = 'results';
            }

            updateResultDisplay(result) {
                const seasonName = this.getSeasonDisplayName(result.season);
                const seasonBadge = document.querySelector('.season-badge .season-name');
                const confidence = document.querySelector('.season-badge .confidence');
                
                if (seasonBadge) seasonBadge.textContent = seasonName;
                if (confidence) confidence.textContent = `${result.confidence}% 확신`;
                
                // 세부 정보 업데이트
                const details = document.querySelectorAll('.detail-item .value');
                if (details.length >= 3) {
                    details[0].textContent = result.undertone === 'warm' ? '따뜻한 톤' : '시원한 톤';
                    details[1].textContent = result.lightness === 'light' ? '밝은 톤' : '어두운 톤';
                    details[2].textContent = result.saturation || '중간 톤';
                }
            }

            setupResultButtons() {
                const generateBtn = document.getElementById('generate-report');
                const saveBtn = document.getElementById('save-result');
                const newBtn = document.getElementById('new-diagnosis');

                if (generateBtn) {
                    generateBtn.onclick = () => this.generateReport();
                }

                if (saveBtn) {
                    saveBtn.onclick = () => this.saveResult();
                }

                if (newBtn) {
                    newBtn.onclick = () => this.startNewDiagnosis();
                }
            }

            generateReport() {
                this.showToast('PDF 보고서를 생성합니다...', 'info');
                
                // Mock PDF 생성
                setTimeout(() => {
                    const result = window.PersonalColorApp.diagnosis;
                    const reportText = `
// index.html 파일의 1431번째 줄 근처 generateReport() 함수를 이것으로 교체하세요!

generateReport() {
    const result = window.PersonalColorApp.diagnosis;
    if (!result) {
        this.showToast('생성할 진단 결과가 없습니다.', 'error');
        return;
    }

    this.showToast('전문 퍼스널컬러 보고서를 생성합니다...', 'info');

    // 전문 보고서 생성
    const reportHTML = this.createProfessionalReport({
        customer: window.PersonalColorApp.customer || { name: '고객님', age: 25, gender: '여성' },
        season: result.season,
        confidence: result.confidence,
        undertone: result.undertone,
        lightness: result.lightness,
        saturation: result.saturation || 'medium'
    });

    // HTML 파일로 다운로드
    const fullHTML = `
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>퍼스널컬러 진단 보고서</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Noto Sans KR', sans-serif; 
            line-height: 1.6; 
            color: #333; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px;
            background: #f8fafc;
        }
        .report-container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        @media print {
            body { margin: 0; padding: 10px; background: white; }
            .no-print { display: none; }
            .report-container { box-shadow: none; }
        }
    </style>
</head>
<body>
    <div class="report-container">
        ${reportHTML}
    </div>
    <div class="no-print" style="text-align: center; margin: 20px 0; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
        <button onclick="window.print()" style="background: #6366f1; color: white; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; margin-right: 15px; font-size: 16px;">🖨️ PDF로 저장</button>
        <button onclick="window.close()" style="background: #6b7280; color: white; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px;">닫기</button>
    </div>
</body>
</html>`;

    // 다운로드
    const blob = new Blob([fullHTML], { type: 'text/html;charset=utf-8' });
    const url = URL.createObjectURL(blob);
    
    const link = document.createElement('a');
    link.href = url;
    link.download = `퍼스널컬러_진단보고서_${Date.now()}.html`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(url);

    this.showToast('🎉 전문 퍼스널컬러 진단 보고서가 생성되었습니다!', 'success');
}

// 이 함수도 ModeManager 클래스 안에 추가하세요!
createProfessionalReport(data) {
    const seasonInfo = this.getSeasonInfo(data.season);
    const today = new Date().toLocaleDateString('ko-KR', {
        year: 'numeric',
        month: 'long', 
        day: 'numeric',
        weekday: 'long'
    });

    return `
        <div style="text-align: center; margin-bottom: 40px;">
            <h1 style="color: #2C3E50; font-size: 28px; margin-bottom: 10px;">
                🎨 퍼스널 컬러 진단 보고서
            </h1>
            <div style="background: linear-gradient(135deg, ${seasonInfo.gradient}); color: white; padding: 15px; border-radius: 25px; display: inline-block;">
                <h2 style="margin: 0; font-size: 24px;">${seasonInfo.displayName}</h2>
                <div style="font-size: 14px; opacity: 0.9;">신뢰도 ${data.confidence}% • ${today}</div>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 40px;">
            <div style="background: #f8fafc; padding: 25px; border-radius: 12px;">
                <h3 style="color: #1f2937; margin-bottom: 15px; font-size: 18px;">👤 고객 정보</h3>
                <div style="line-height: 1.8; color: #4b5563;">
                    <div><strong>성명:</strong> ${data.customer.name}</div>
                    <div><strong>연령:</strong> ${data.customer.age}세</div>
                    <div><strong>성별:</strong> ${data.customer.gender}</div>
                    <div><strong>진단일:</strong> ${today}</div>
                    <div><strong>진단자:</strong> Personal Color Pro AI</div>
                </div>
            </div>

            <div style="background: #f8fafc; padding: 25px; border-radius: 12px;">
                <h3 style="color: #1f2937; margin-bottom: 15px; font-size: 18px;">📊 진단 결과</h3>
                <div style="line-height: 1.8; color: #4b5563;">
                    <div><strong>계절 타입:</strong> <span style="color: ${seasonInfo.color};">${seasonInfo.displayName}</span></div>
                    <div><strong>언더톤:</strong> ${data.undertone === 'warm' ? '웜톤 (따뜻함)' : '쿨톤 (차가움)'}</div>
                    <div><strong>명도:</strong> ${data.lightness === 'deep' ? '딥 (깊고 진함)' : '라이트 (밝고 연함)'}</div>
                    <div><strong>채도:</strong> ${data.saturation === 'rich' ? '리치 (풍부함)' : '소프트 (부드러움)'}</div>
                    <div><strong>진단 정확도:</strong> ${data.confidence}%</div>
                </div>
            </div>
        </div>

        <div style="margin-bottom: 40px;">
            <h3 style="color: #1f2937; margin-bottom: 20px; font-size: 20px; text-align: center;">🌟 ${seasonInfo.displayName} 특징</h3>
            <div style="background: linear-gradient(135deg, ${seasonInfo.gradient}); color: white; padding: 25px; border-radius: 15px; text-align: center;">
                <div style="font-size: 16px; line-height: 1.6; margin-bottom: 20px;">
                    ${seasonInfo.description}
                </div>
                <div style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;">
                    <div style="background: rgba(255,255,255,0.2); padding: 10px 15px; border-radius: 8px;">
                        <strong>키워드:</strong> ${seasonInfo.keywords.join(', ')}
                    </div>
                </div>
            </div>
        </div>

        <div style="margin-bottom: 40px;">
            <h3 style="color: #1f2937; margin-bottom: 20px; font-size: 20px; text-align: center;">🎨 추천 색상 팔레트</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px;">
                ${seasonInfo.bestColors.slice(0, 5).map((color, index) => `
                    <div style="text-align: center;">
                        <div style="width: 80px; height: 80px; background: ${color.hex}; border-radius: 50%; margin: 0 auto 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);"></div>
                        <div style="font-size: 14px; color: #4b5563;">${color.name}</div>
                    </div>
                `).join('')}
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 40px;">
            <div>
                <h3 style="color: #059669; margin-bottom: 15px;">✅ 추천 색상</h3>
                <div style="background: #ecfdf5; padding: 20px; border-radius: 10px; border-left: 4px solid #059669;">
                    ${seasonInfo.bestColors.slice(0, 5).map(color => `
                        <div style="display: flex; align-items: center; margin-bottom: 10px;">
                            <div style="width: 20px; height: 20px; background: ${color.hex}; border-radius: 3px; margin-right: 10px; border: 1px solid #ddd;"></div>
                            <span style="font-weight: 500;">${color.name}</span>
                        </div>
                    `).join('')}
                </div>
            </div>

            <div>
                <h3 style="color: #dc2626; margin-bottom: 15px;">❌ 피해야 할 색상</h3>
                <div style="background: #fef2f2; padding: 20px; border-radius: 10px; border-left: 4px solid #dc2626;">
                    ${seasonInfo.avoidColors.slice(0, 4).map(color => `
                        <div style="display: flex; align-items: center; margin-bottom: 10px;">
                            <div style="width: 20px; height: 20px; background: ${color.hex}; border-radius: 3px; margin-right: 10px; border: 1px solid #ddd;"></div>
                            <span style="font-weight: 500;">${color.name}</span>
                        </div>
                    `).join('')}
                </div>
            </div>
        </div>

        <div style="margin-bottom: 40px;">
            <h3 style="color: #1f2937; margin-bottom: 20px; text-align: center;">💄 화장품 추천</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                ${seasonInfo.makeup.map(item => `
                    <div style="background: #f8fafc; padding: 20px; border-radius: 10px; border: 1px solid #e5e7eb;">
                        <h4 style="color: #374151; margin-bottom: 10px;">${item.category}</h4>
                        <ul style="color: #6b7280; line-height: 1.6; margin: 0; padding-left: 20px;">
                            ${item.products.map(product => `<li>${product}</li>`).join('')}
                        </ul>
                    </div>
                `).join('')}
            </div>
        </div>

        <div style="margin-bottom: 40px;">
            <h3 style="color: #1f2937; margin-bottom: 20px; text-align: center;">✂️ 헤어컬러 추천</h3>
            <div style="background: #f8fafc; padding: 25px; border-radius: 12px; text-align: center;">
                <div style="display: flex; justify-content: center; gap: 30px; margin-bottom: 20px;">
                    ${seasonInfo.hairColors.map(hair => `
                        <div style="text-align: center;">
                            <div style="width: 60px; height: 60px; background: ${hair.color}; border-radius: 50%; margin: 0 auto 10px; box-shadow: 0 3px 10px rgba(0,0,0,0.2);"></div>
                            <div style="font-weight: 500; color: #374151;">${hair.name}</div>
                        </div>
                    `).join('')}
                </div>
                <div style="color: #6b7280; line-height: 1.6;">
                    <strong>추천 이유:</strong> ${seasonInfo.hairReason}
                </div>
            </div>
        </div>

        <div style="margin-bottom: 30px;">
            <h3 style="color: #1f2937; margin-bottom: 15px; text-align: center;">📝 전문가 조언</h3>
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 15px;">
                <div style="font-size: 16px; line-height: 1.7; text-align: center;">
                    💡 <strong>${data.customer.name}님은 ${seasonInfo.displayName}입니다.</strong><br><br>
                    ${seasonInfo.advice}
                </div>
            </div>
        </div>

        <div style="border-top: 2px solid #e5e7eb; padding-top: 20px; text-align: center; color: #6b7280;">
            <div style="margin-bottom: 10px;">
                <strong>Personal Color Pro</strong> v1.0.0 | 헤어디자이너 전용 퍼스널컬러 진단 시스템
            </div>
            <div style="font-size: 14px;">
                진단일: ${today} | AI 분석 정확도: ${data.confidence}% | 문의: personalcolor@pro.com
            </div>
        </div>
    `;
}

// getSeasonInfo 함수도 ModeManager 클래스 안에 추가하세요!
getSeasonInfo(season) {
    const seasons = {
        spring: {
            displayName: '봄 웜톤 (Spring Warm)',
            color: '#ff6b6b',
            gradient: '#ff6b6b, #feca57',
            description: '밝고 화사한 봄의 에너지를 가진 따뜻한 톤입니다. 생기 넘치고 활기찬 색상들이 피부를 더욱 환하게 만들어줍니다.',
            keywords: ['밝음', '활기참', '따뜻함', '생기', '화사함'],
            bestColors: [
                { name: '코랄 핑크', hex: '#ff6b6b' },
                { name: '골든 옐로우', hex: '#feca57' },
                { name: '피치 오렌지', hex: '#ff9ff3' },
                { name: '아이보리', hex: '#fff8e7' },
                { name: '카키 그린', hex: '#6ab04c' }
            ],
            avoidColors: [
                { name: '아이시 블루', hex: '#74b9ff' },
                { name: '퓨어 블랙', hex: '#2d3436' },
                { name: '실버 그레이', hex: '#b2bec3' },
                { name: '네이비', hex: '#2d3436' }
            ],
            makeup: [
                { category: '립 제품', products: ['코랄 립스틱', '피치 글로스', '오렌지 틴트'] },
                { category: '아이섀도', products: ['골드 브라운', '웜 베이지', '코퍼 브론즈'] },
                { category: '블러셔', products: ['코랄 블러셔', '피치 블러셔'] },
                { category: '베이스', products: ['웜 베이지 파운데이션', '골든 언더톤 컨실러'] }
            ],
            hairColors: [
                { name: '골든 브라운', color: '#cd853f' },
                { name: '허니 블론드', color: '#daa520' },
                { name: '카라멜 브라운', color: '#d2691e' }
            ],
            hairReason: '따뜻한 골드 톤이 들어간 헤어컬러가 봄 웜톤의 화사함을 극대화시켜줍니다.',
            advice: '밝고 따뜻한 색상들이 당신의 자연스러운 아름다움을 돋보이게 합니다.'
        },
        summer: {
            displayName: '여름 쿨톤 (Summer Cool)',
            color: '#74b9ff',
            gradient: '#74b9ff, #a29bfe',
            description: '시원하고 우아한 여름의 품격을 가진 쿨톤입니다. 부드럽고 세련된 색상들이 고급스러운 매력을 연출합니다.',
            keywords: ['시원함', '우아함', '세련됨', '부드러움', '고급스러움'],
            bestColors: [
                { name: '소프트 핑크', hex: '#fd79a8' },
                { name: '라벤더', hex: '#a29bfe' },
                { name: '로즈 그레이', hex: '#ddd' },
                { name: '아이스 블루', hex: '#74b9ff' },
                { name: '민트 그린', hex: '#00cec9' }
            ],
            avoidColors: [
                { name: '오렌지', hex: '#e17055' },
                { name: '골드', hex: '#fdcb6e' },
                { name: '브라운', hex: '#6c5ce7' },
                { name: '카키', hex: '#6ab04c' }
            ],
            makeup: [
                { category: '립 제품', products: ['로즈 핑크 립스틱', '베리 글로스', '쿨톤 레드'] },
                { category: '아이섀도', products: ['쿨 브라운', '실버 그레이', '라벤더'] },
                { category: '블러셔', products: ['로즈 블러셔', '핑크 블러셔'] },
                { category: '베이스', products: ['핑크 언더톤 파운데이션', '쿨톤 컨실러'] }
            ],
            hairColors: [
                { name: '애쉬 브라운', color: '#8b7355' },
                { name: '플래티넘 블론드', color: '#f5f5dc' },
                { name: '버건디', color: '#800020' }
            ],
            hairReason: '차가운 톤의 헤어컬러가 여름 쿨톤의 우아하고 세련된 이미지를 완성합니다.',
            advice: '차가우면서도 부드러운 색상들이 당신의 우아한 매력을 극대화합니다.'
        },
        autumn: {
            displayName: '가을 웜톤 (Autumn Warm)',
            color: '#d63031',
            gradient: '#d63031, #e17055',
            description: '깊고 풍부한 가을의 따뜻함을 가진 웜톤입니다. 고급스럽고 성숙한 색상들이 강인하면서도 우아한 매력을 연출합니다.',
            keywords: ['깊이', '풍부함', '성숙함', '고급스러움', '강인함'],
            bestColors: [
                { name: '딥 레드', hex: '#d63031' },
                { name: '골든 옐로우', hex: '#fdcb6e' },
                { name: '번트 오렌지', hex: '#e17055' },
                { name: '올리브 그린', hex: '#6c5ce7' },
                { name: '카라멜 브라운', hex: '#d2691e' }
            ],
            avoidColors: [
                { name: '파스텔 핑크', hex: '#fd79a8' },
                { name: '아이스 블루', hex: '#74b9ff' },
                { name: '라벤더', hex: '#a29bfe' },
                { name: '실버', hex: '#b2bec3' }
            ],
            makeup: [
                { category: '립 제품', products: ['딥 레드 립스틱', '브라운 글로스', '번트 오렌지 틴트'] },
                { category: '아이섀도', products: ['골드 브라운', '딥 브론즈', '올리브 그린'] },
                { category: '블러셔', products: ['테라코타 블러셔', '피치 브라운'] },
                { category: '베이스', products: ['골든 언더톤 파운데이션', '웜톤 컨실러'] }
            ],
            hairColors: [
                { name: '초콜릿 브라운', color: '#8b4513' },
                { name: '오번', color: '#a0522d' },
                { name: '딥 레드', color: '#8b0000' }
            ],
            hairReason: '깊고 풍부한 브라운 계열 색상이 가을 웜톤의 성숙하고 고급스러운 매력을 강조합니다.',
            advice: '깊고 풍부한 색상들이 당신의 성숙한 매력을 돋보이게 합니다.'
        },
        winter: {
            displayName: '겨울 쿨톤 (Winter Cool)',
            color: '#2d3436',
            gradient: '#2d3436, #6c5ce7',
            description: '강렬하고 선명한 겨울의 카리스마를 가진 쿨톤입니다. 대비가 강한 색상들이 도시적이고 세련된 매력을 연출합니다.',
            keywords: ['강렬함', '선명함', '카리스마', '도시적', '세련됨'],
            bestColors: [
                { name: '퓨어 블랙', hex: '#2d3436' },
                { name: '로열 블루', hex: '#0984e3' },
                { name: '에메랄드', hex: '#00b894' },
                { name: '퓨어 화이트', hex: '#ffffff' },
                { name: '딥 퍼플', hex: '#6c5ce7' }
            ],
            avoidColors: [
                { name: '오렌지', hex: '#e17055' },
                { name: '베이지', hex: '#ddd' },
                { name: '골드', hex: '#fdcb6e' },
                { name: '카키', hex: '#6ab04c' }
            ],
            makeup: [
                { category: '립 제품', products: ['레드 립스틱', '베리 글로스', '플럼 틴트'] },
                { category: '아이섀도', products: ['쿨 브라운', '실버', '블루 그레이'] },
                { category: '블러셔', products: ['로즈 블러셔', '베리 블러셔'] },
                { category: '베이스', products: ['핑크 언더톤 파운데이션', '쿨톤 컨실러'] }
            ],
            hairColors: [
                { name: '젯 블랙', color: '#000000' },
                { name: '애쉬 브라운', color: '#696969' },
                { name: '플래티넘', color: '#e5e5e5' }
            ],
            hairReason: '강렬하고 선명한 헤어컬러가 겨울 쿨톤의 카리스마 있고 도시적인 매력을 극대화합니다.',
            advice: '강렬하고 선명한 색상들이 당신의 도시적인 매력을 극대화합니다.'
        }
    };
    
    return seasons[season] || seasons.spring;
}

            saveResult() {
                try {
                    const results = JSON.parse(localStorage.getItem('diagnosis_results') || '[]');
                    results.push({
                        ...window.PersonalColorApp.diagnosis,
                        customer: window.PersonalColorApp.customer,
                        timestamp: new Date().toISOString()
                    });
                    
                    if (results.length > 100) results.shift();
                    
                    localStorage.setItem('diagnosis_results', JSON.stringify(results));
                    this.showToast('진단 결과가 저장되었습니다!', 'success');
                } catch (error) {
                    this.showToast('저장에 실패했습니다.', 'error');
                }
            }

            startNewDiagnosis() {
                // 상태 초기화
                window.PersonalColorApp.currentMode = 'selection';
                window.PersonalColorApp.diagnosis = null;
                window.PersonalColorApp.drapingData = {
                    selectedColors: [],
                    notes: '',
                    comparisons: []
                };

                // UI 초기화
                this.switchToMode('selection');
                
                this.showToast('새 진단을 시작합니다.', 'info');
            }

            getModeDisplayName(mode) {
                const names = {
                    ai_photo: 'AI 사진 분석',
                    draping: '전문가 드레이핑',
                    hybrid: '하이브리드',
                    selection: '모드 선택'
                };
                return names[mode] || mode;
            }

            getSeasonDisplayName(season) {
                const names = {
                    spring: '봄 웜톤',
                    summer: '여름 쿨톤',
                    autumn: '가을 웜톤',
                    winter: '겨울 쿨톤'
                };
                return names[season] || season;
            }

            showToast(message, type = 'info', duration = 5000) {
                const container = document.getElementById('toast-container');
                if (!container) return;

                const toast = document.createElement('div');
                toast.className = `toast toast-${type}`;
                
                const icons = {
                    success: '✅',
                    error: '❌',
                    warning: '⚠️',
                    info: 'ℹ️'
                };

                toast.innerHTML = `
                    <div class="toast-content">
                        <span class="toast-icon">${icons[type] || 'ℹ️'}</span>
                        <span class="toast-message">${message}</span>
                        <button class="toast-close">×</button>
                    </div>
                `;

                container.appendChild(toast);

                // 표시 애니메이션
                setTimeout(() => toast.classList.add('show'), 100);

                // 자동 제거
                const autoRemove = setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => {
                        if (toast.parentNode) {
                            toast.parentNode.removeChild(toast);
                        }
                    }, 300);
                }, duration);

                // 수동 닫기
                const closeBtn = toast.querySelector('.toast-close');
                if (closeBtn) {
                    closeBtn.onclick = () => {
                        clearTimeout(autoRemove);
                        toast.classList.remove('show');
                        setTimeout(() => {
                            if (toast.parentNode) {
                                toast.parentNode.removeChild(toast);
                            }
                        }, 300);
                    };
                }
            }
        }

        // 전역 모드 관리자
        window.modeManager = null;

        // DOM 준비 완료 처리
        document.addEventListener('DOMContentLoaded', () => {
            console.log('✅ DOM 로드 완료');
            
            // 모드 관리자 초기화
            window.modeManager = new ModeManager();
            
            // 헤더 버튼 이벤트
            const customerBtn = document.getElementById('customer-management');
            const settingsBtn = document.getElementById('settings-btn');
            const closeSidebarBtn = document.getElementById('close-sidebar');

            if (customerBtn) {
                customerBtn.onclick = () => {
                    const sidebar = document.getElementById('sidebar');
                    if (sidebar) {
                        sidebar.classList.add('show');
                    }
                };
            }

            if (settingsBtn) {
                settingsBtn.onclick = () => {
                    if (window.modeManager) {
                        window.modeManager.showToast('설정 기능은 준비 중입니다.', 'info');
                    }
                };
            }

            if (closeSidebarBtn) {
                closeSidebarBtn.onclick = () => {
                    const sidebar = document.getElementById('sidebar');
                    if (sidebar) {
                        sidebar.classList.remove('show');
                    }
                };
            }

            console.log('✅ 이벤트 리스너 설정 완료');
        });

        // 에러 처리
        window.addEventListener('error', (e) => {
            console.error('전역 에러:', e.error);
        });

        // 앱 로딩 시뮬레이션
        function startLoadingSequence() {
            console.log('🚀 Personal Color Pro 시작');
            
            // 1단계: 설정
            window.loadingManager.updateStep('step-config', 'active');
            setTimeout(() => {
                window.loadingManager.updateStep('step-config', 'complete', '설정 로드 완료');
                window.loadingManager.updateProgress(25);
                
                // 2단계: 모듈
                window.loadingManager.updateStep('step-modules', 'active');
                setTimeout(() => {
                    window.loadingManager.updateStep('step-modules', 'complete', '모듈 로드 완료');
                    window.loadingManager.updateProgress(50);
                    
                    // 3단계: AI
                    window.loadingManager.updateStep('step-ai', 'active');
                    setTimeout(() => {
                        window.loadingManager.updateStep('step-ai', 'complete', 'AI 시스템 준비 완료');
                        window.loadingManager.updateProgress(75);
                        
                        // 4단계: UI
                        window.loadingManager.updateStep('step-ui', 'active');
                        setTimeout(() => {
                            window.loadingManager.updateStep('step-ui', 'complete', 'UI 초기화 완료');
                            window.loadingManager.updateProgress(100);
                            
                            // 완료
                            setTimeout(() => {
                                window.loadingManager.complete();
                                console.log('🎉 Personal Color Pro 로딩 완료!');
                            }, 500);
                        }, 800);
                    }, 600);
                }, 800);
            }, 500);
        }

        // 로딩 시작
        startLoadingSequence();
    </script>

    <!-- PWA 서비스 워커 등록 (404 오류 무시) -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('✅ SW 등록 성공');
                    })
                    .catch(error => {
                        console.log('⚠️ SW 등록 실패 (무시됨):', error);
                    });
            });
        }
    </script>

    <!-- 외부 스크립트들 (404 오류 방지) -->
    <script>
        window.addEventListener('appLoaded', () => {
            console.log('📦 추가 모듈들 로딩 시작');
            
            const scripts = [
                { src: 'js/config.js', required: false },
                { src: 'js/utils/validation.js', required: false },
                { src: 'js/utils/performance.js', required: false },
                { src: 'js/utils/analytics.js', required: false }
            ];
            
            scripts.forEach((script, index) => {
                setTimeout(() => {
                    const scriptEl = document.createElement('script');
                    scriptEl.src = script.src;
                    scriptEl.async = true;
                    scriptEl.onerror = () => {
                        console.warn(`스크립트 로드 실패 (무시됨): ${script.src}`);
                    };
                    document.head.appendChild(scriptEl);
                }, index * 200);
            });
        });
    </script>
</body>
</html>
