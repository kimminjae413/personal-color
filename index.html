<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="description" content="헤어디자이너용 퍼스널컬러 진단 태블릿 시스템">
    <title>Personal Color Pro - 퍼스널컬러 진단 시스템</title>
    
    <!-- 외부 라이브러리 CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_detection/face_detection.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/color-convert/2.0.1/color-convert.min.js"></script>
    
    <!-- CSS 파일 -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- 로딩 화면 -->
    <div class="loading-screen" id="loading-screen">
        <div class="loading-content">
            <div class="loading-logo">🎨</div>
            <h2>Personal Color Pro</h2>
            <p>AI 퍼스널컬러 진단 시스템 로딩 중...</p>
            <div class="loading-bar">
                <div class="loading-progress" id="loading-progress"></div>
            </div>
            <div class="loading-message" id="loading-message">시스템 초기화 중...</div>
        </div>
    </div>

    <!-- 메인 애플리케이션 -->
    <div class="main-app" id="main-app">
        <!-- 헤더 -->
        <header class="app-header">
            <div class="header-top">
                <div>
                    <h1 class="app-title">Personal Color AI Pro</h1>
                    <div class="app-subtitle">헤어샵 전용 완전한 퍼스널컬러 진단 시스템</div>
                </div>
                <div class="header-status">
                    <div class="status-item">AI 엔진: <span class="status-active" id="ai-status">준비됨</span></div>
                    <div class="status-item">Delta E 2000: <span class="status-active" id="deltae-status">활성</span></div>
                    <div class="status-item">분석 완료: <span id="analysis-count">0</span>건</div>
                </div>
            </div>
            
            <div class="header-controls">
                <button class="header-btn" id="photo-analysis-btn" onclick="switchMode('photo')">📸 AI 사진 분석</button>
                <button class="header-btn" id="draping-mode-btn" onclick="switchMode('draping')">🎭 드래이핑 모드</button>
                <button class="header-btn" id="system-status-btn" onclick="showSystemStatus()">⚙️ 시스템 상태</button>
            </div>
        </header>

        <!-- 메인 콘텐츠 -->
        <main class="main-content">
            <!-- 모드 선택 섹션 -->
            <section class="section active" id="mode-selection">
                <h2>퍼스널컬러 진단 모드 선택</h2>
                <div class="mode-cards">
                    <!-- AI 사진 분석 모드 -->
                    <div class="mode-card" data-mode="photo" onclick="selectModeCard(this)">
                        <span class="mode-icon">📸</span>
                        <h3>AI 사진 분석 모드</h3>
                        <p>실시간 카메라를 통한 AI 기반 과학적 퍼스널컬러 진단</p>
                        <ul class="mode-features">
                            <li>MediaPipe 얼굴 인식</li>
                            <li>RGB→LAB 색공간 변환</li>
                            <li>Delta E 2000 색차 측정</li>
                            <li>4단계 실시간 분석</li>
                            <li>브랜드별 제품 추천</li>
                        </ul>
                        <button class="mode-btn" onclick="startPhotoAnalysis()">시작하기</button>
                    </div>

                    <!-- 드래이핑 모드 -->
                    <div class="mode-card" data-mode="draping" onclick="selectModeCard(this)">
                        <span class="mode-icon">🎭</span>
                        <h3>전문가 드래이핑 모드</h3>
                        <p>전문가 노하우를 반영한 가상 드래이핑 진단</p>
                        <ul class="mode-features">
                            <li>사진 업로드 & 실시간 오버레이</li>
                            <li>4계절 색상 팔레트</li>
                            <li>유이레/빛날윤/블루미 노하우</li>
                            <li>가상 헤어컬러 적용</li>
                            <li>Before/After 비교 (4가지 모드)</li>
                        </ul>
                        <button class="mode-btn" onclick="startDraping()">시작하기</button>
                    </div>
                </div>
            </section>

            <!-- AI 사진 분석 섹션 -->
            <section class="section" id="photo-analysis">
                <h2>AI 기반 퍼스널컬러 진단</h2>
                
                <div class="analysis-grid">
                    <!-- 카메라 영역 -->
                    <div class="video-container">
                        <video id="camera-feed" class="video-feed" autoplay muted playsinline></video>
                        <canvas id="face-overlay" class="camera-overlay"></canvas>
                        <div class="face-detection-guide" id="face-guide">
                            얼굴을 가이드라인에 맞춰주세요
                        </div>
                    </div>

                    <!-- 분석 패널 -->
                    <div class="analysis-panel">
                        <!-- 1단계: 얼굴 인식 -->
                        <div class="analysis-step active" id="step-face-detection">
                            <div class="step-indicator">
                                <div class="step-dot active"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                            </div>
                            <h3>1단계: 얼굴 인식</h3>
                            <div class="progress-ring">
                                <svg>
                                    <circle class="bg" cx="60" cy="60" r="50"></circle>
                                    <circle class="progress" cx="60" cy="60" r="50" id="progress-circle-1"></circle>
                                </svg>
                                <div class="progress-text" id="progress-text-1">0%</div>
                            </div>
                            <p>MediaPipe를 사용하여 얼굴을 인식하고 있습니다...</p>
                            <button class="mode-btn" onclick="startFaceDetection()">얼굴 인식 시작</button>
                        </div>

                        <!-- 2단계: 피부 색상 분석 -->
                        <div class="analysis-step" id="step-color-analysis">
                            <div class="step-indicator">
                                <div class="step-dot completed"></div>
                                <div class="step-dot active"></div>
                                <div class="step-dot"></div>
                                <div class="step-dot"></div>
                            </div>
                            <h3>2단계: 피부 색상 분석</h3>
                            <div class="progress-ring">
                                <svg>
                                    <circle class="bg" cx="60" cy="60" r="50"></circle>
                                    <circle class="progress" cx="60" cy="60" r="50" id="progress-circle-2"></circle>
                                </svg>
                                <div class="progress-text" id="progress-text-2">0%</div>
                            </div>
                            <p>RGB → LAB 색공간 변환 및 색상 추출 중...</p>
                        </div>

                        <!-- 3단계: Delta E 계산 -->
                        <div class="analysis-step" id="step-delta-calculation">
                            <div class="step-indicator">
                                <div class="step-dot completed"></div>
                                <div class="step-dot completed"></div>
                                <div class="step-dot active"></div>
                                <div class="step-dot"></div>
                            </div>
                            <h3>3단계: Delta E 2000 계산</h3>
                            <div class="progress-ring">
                                <svg>
                                    <circle class="bg" cx="60" cy="60" r="50"></circle>
                                    <circle class="progress" cx="60" cy="60" r="50" id="progress-circle-3"></circle>
                                </svg>
                                <div class="progress-text" id="progress-text-3">0%</div>
                            </div>
                            <p>과학적 색차 측정을 통한 계절 판정 중...</p>
                        </div>

                        <!-- 4단계: 결과 생성 -->
                        <div class="analysis-step" id="step-result-generation">
                            <div class="step-indicator">
                                <div class="step-dot completed"></div>
                                <div class="step-dot completed"></div>
                                <div class="step-dot completed"></div>
                                <div class="step-dot active"></div>
                            </div>
                            <h3>4단계: 결과 생성</h3>
                            <div class="progress-ring">
                                <svg>
                                    <circle class="bg" cx="60" cy="60" r="50"></circle>
                                    <circle class="progress" cx="60" cy="60" r="50" id="progress-circle-4"></circle>
                                </svg>
                                <div class="progress-text" id="progress-text-4">0%</div>
                            </div>
                            <p>전문가 노하우를 반영한 최종 결과 생성 중...</p>
                        </div>
                    </div>
                </div>

                <!-- 결과 표시 영역 -->
                <div class="results-container" id="analysis-results" style="display: none;">
                    <div class="result-header">
                        <div class="result-season" id="result-season">봄 웜톤</div>
                        <div class="result-confidence">정확도: <span id="confidence-score">92%</span></div>
                    </div>
                    
                    <div class="result-details">
                        <div class="result-card">
                            <h4>색상 분석 데이터</h4>
                            <p>L: <span id="lab-l">65.2</span></p>
                            <p>A: <span id="lab-a">12.8</span></p>
                            <p>B: <span id="lab-b">15.4</span></p>
                            <p>Delta E: <span id="delta-e">8.3</span></p>
                        </div>
                        
                        <div class="result-card">
                            <h4>전문가 분석</h4>
                            <p id="expert-analysis">
                                아이보리 피부톤에 따뜻한 언더톤이 감지되었습니다. 
                                유이레 노하우에 따르면 코토리베이지 계열이 잘 어울립니다.
                            </p>
                        </div>
                        
                        <div class="result-card">
                            <h4>추천 컬러</h4>
                            <div class="recommended-colors" id="recommended-colors">
                                <!-- 동적으로 생성 -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 브랜드별 제품 추천 -->
                <div class="product-recommendations" id="product-recommendations" style="display: none;">
                    <h3 style="text-align: center; color: var(--primary-pink); margin-bottom: var(--spacing-lg);">
                        브랜드별 제품 추천
                    </h3>
                    
                    <div class="brand-tabs">
                        <button class="brand-tab active" onclick="showBrandProducts('loreal')">로레알</button>
                        <button class="brand-tab" onclick="showBrandProducts('wella')">웰라</button>
                        <button class="brand-tab" onclick="showBrandProducts('milbon')">밀본</button>
                    </div>

                    <div class="product-grid" id="product-grid">
                        <!-- 동적으로 생성 -->
                    </div>
                </div>
            </section>

            <!-- 드래이핑 모드 섹션 -->
            <section class="section" id="draping-mode">
                <h2>전문가 드래이핑 진단</h2>
                
                <div class="draping-container">
                    <!-- 이미지 업로드 및 드래이핑 영역 -->
                    <div>
                        <div class="image-upload-area" id="image-upload-area" onclick="document.getElementById('image-input').click()">
                            <input type="file" id="image-input" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
                            <div class="upload-icon">📷</div>
                            <h3>고객 사진 업로드</h3>
                            <p>드래그 & 드롭 또는 클릭하여 이미지를 업로드하세요</p>
                            <p style="font-size: 0.9rem; color: var(--accent-gray);">지원 형식: JPG, PNG, WEBP</p>
                        </div>
                        
                        <canvas id="draping-canvas" style="display: none; width: 100%; border-radius: var(--radius); margin-top: var(--spacing-lg);"></canvas>
                    </div>

                    <!-- 색상 팔레트 -->
                    <div class="color-palette-section">
                        <h3 style="text-align: center; margin-bottom: var(--spacing-lg);">4계절 색상 팔레트</h3>
                        
                        <div class="season-tabs">
                            <button class="season-tab active" onclick="showSeasonPalette('spring')">봄</button>
                            <button class="season-tab" onclick="showSeasonPalette('summer')">여름</button>
                            <button class="season-tab" onclick="showSeasonPalette('autumn')">가을</button>
                            <button class="season-tab" onclick="showSeasonPalette('winter')">겨울</button>
                        </div>

                        <div class="color-palette" id="color-palette">
                            <!-- 동적으로 생성 -->
                        </div>

                        <div style="margin-top: var(--spacing-lg);">
                            <button class="mode-btn" onclick="applyVirtualHair()" style="width: 100%;">
                                가상 헤어컬러 적용
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Before/After 비교 섹션 -->
                <div class="before-after-container" id="before-after-section" style="display: none;">
                    <div class="comparison-header">
                        <h3>Before/After 비교</h3>
                        <div class="comparison-controls">
                            <button class="comparison-mode active" data-mode="slider" onclick="switchComparisonMode('slider')">슬라이더</button>
                            <button class="comparison-mode" data-mode="split" onclick="switchComparisonMode('split')">분할</button>
                            <button class="comparison-mode" data-mode="toggle" onclick="switchComparisonMode('toggle')">토글</button>
                            <button class="comparison-mode" data-mode="overlay" onclick="switchComparisonMode('overlay')">오버레이</button>
                        </div>
                    </div>
                    
                    <!-- 슬라이더 비교 뷰 -->
                    <div class="slider-comparison active" id="slider-view">
                        <div class="comparison-wrapper">
                            <canvas id="before-canvas"></canvas>
                            <canvas id="after-canvas"></canvas>
                            <div class="slider-handle" id="slider-handle"></div>
                        </div>
                        <input type="range" class="comparison-slider" min="0" max="100" value="50" id="comparison-slider">
                    </div>
                    
                    <!-- 분할 비교 뷰 -->
                    <div class="split-comparison" id="split-view">
                        <div class="before-section">
                            <h4>Before</h4>
                            <canvas id="before-split-canvas"></canvas>
                        </div>
                        <div class="after-section">
                            <h4>After</h4>
                            <canvas id="after-split-canvas"></canvas>
                        </div>
                    </div>
                    
                    <!-- 토글 비교 뷰 -->
                    <div class="toggle-comparison" id="toggle-view">
                        <canvas id="toggle-canvas"></canvas>
                        <button class="toggle-btn" onclick="toggleBeforeAfter()">Before ↔ After</button>
                    </div>
                    
                    <!-- 오버레이 비교 뷰 -->
                    <div class="overlay-comparison" id="overlay-view">
                        <div class="overlay-wrapper">
                            <canvas id="overlay-before-canvas"></canvas>
                            <canvas id="overlay-after-canvas"></canvas>
                        </div>
                        <input type="range" class="opacity-slider" min="0" max="100" value="50" id="opacity-slider">
                        <p>투명도 조절</p>
                    </div>
                    
                    <!-- 개선도 지표 -->
                    <div class="improvement-metrics">
                        <div class="metric">
                            <span class="metric-label">피부톤 개선:</span>
                            <span class="metric-value" id="skin-improvement">+15%</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">전체 조화도:</span>
                            <span class="metric-value" id="harmony-score">92점</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">전문가 추천:</span>
                            <span class="metric-value" id="expert-rating">★★★★☆</span>
                        </div>
                    </div>
                    
                    <div class="export-options">
                        <button class="export-btn" onclick="exportComparison()">📱 비교 이미지 저장</button>
                        <button class="export-btn" onclick="generateReport()">📄 상담 리포트 생성</button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- JavaScript 파일들 -->
    <script src="app.js"></script>
    <script src="comparison.js"></script>
</body>
</html>
