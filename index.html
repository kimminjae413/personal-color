// ì¦‰ì‹œ ë¡œë”© ì™„ë£Œ (ì˜¤ë¥˜ ë°©ì§€)
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ì¦‰ì‹œ ë¡œë”© ëª¨ë“œ í™œì„±í™”');
            
            // ë¡œë”© í™”ë©´ ì¦‰ì‹œ ìˆ¨ê¸°ê¸°
            setTimeout(() => {
                const loadingScreen = document.getElementById('loading-screen');
                const mainApp = document.getElementById('main-app');
                
                if (loadingScreen) {
                    loadingScreen.style.display = 'none';
                }
                
                if (mainApp) {
                    mainApp.style.display = 'block';
                    mainApp.classList.add('loaded');
                }
                
                // ê¸°ë³¸ ì‹œìŠ¤í…œ ì´ˆê¸°í™”
                initializeBasicSystems();
                
            }, 1000); // 1ì´ˆ í›„ ë°”ë¡œ ë©”ì¸ í™”ë©´ í‘œì‹œ
        });

        function initializeBasicSystems() {
            try {
                // ê¸°ë³¸ ê°ì²´ ì´ˆê¸°í™”
                if (!window.PersonalColorAI) {
                    window.PersonalColorAI = {
                        version: 'QUICK-LOAD-v1.0',
                        isLoaded: true,
                        currentMode: 'selection',
                        ai: {},
                        performance: { totalAnalyses: 0, customersServed: 0 }
                    };
                }
                
                // Delta E 2000 ì—”ì§„ ì´ˆê¸°í™”
                try {
                    window.PersonalColorAI.ai.deltaE = new DeltaE2000Engine();
                } catch (e) {
                    console.warn('Delta E ì—”ì§„ ì´ˆê¸°í™” ì‹¤íŒ¨:', e);
                }
                
                // ê³ ê° ê´€ë¦¬ì ì´ˆê¸°í™”
                try {
                    window.PersonalColorAI.customerManager = new CustomerManager();
                    window.PersonalColorAI.customerManager.updateCustomerCount();
                } catch (e) {
                    console.warn('ê³ ê° ê´€ë¦¬ì ì´ˆê¸°í™” ì‹¤íŒ¨:', e);
                }
                
                // ê¸°ë³¸ ì´ë²¤íŠ¸ ì„¤ì •
                setupBasicEvents();
                
                // ìƒíƒœ ì—…ë°ì´íŠ¸
                updateSystemStatus();
                
                // ì„±ê³µ ë©”ì‹œì§€
                showToast('ì‹œìŠ¤í…œì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                
                console.log('ê¸°ë³¸ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ');
                
            } catch (error) {
                console.error('ê¸°ë³¸ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                showBasicAlert('ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        function setupBasicEvents() {
            try {
                // ëª¨ë“œ ì „í™˜ ë²„íŠ¼ë“¤
                const modeButtons = {
                    'photo-analysis-btn': 'photo',
                    'draping-mode-btn': 'draping',
                    'customer-management-btn': 'customer'
                };
                
                Object.keys(modeButtons).forEach(buttonId => {
                    const button = document.getElementById(buttonId);
                    if (button) {
                        button.addEventListener('click', () => switchMode(modeButtons[buttonId]));
                    }
                });
                
                // ëª¨ë“œ ì¹´ë“œë“¤
                document.querySelectorAll('.mode-card').forEach(card => {
                    card.addEventListener('click', () => {
                        const mode = card.getAttribute('data-mode');
                        if (mode) switchMode(mode);
                    });
                });
                
                // ì‹œìŠ¤í…œ ìƒíƒœ ë²„íŠ¼
                const statusBtn = document.getElementById('system-status-btn');
                if (statusBtn) {
                    statusBtn.addEventListener('click', showSystemStatus);
                }
                
            } catch (error) {
                console.warn('ì´ë²¤íŠ¸ ì„¤ì • ì¤‘ ì˜¤ë¥˜:', error);
            }
        }

        function updateSystemStatus() {
            try {
                const elements = {
                    'ai-status': 'ì¤€ë¹„ë¨',
                    'deltae-status': 'í™œì„±',
                    'customer-count': '0'
                };
                
                Object.keys(elements).forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.textContent = elements[id];
                    }
                });
            } catch (error) {
                console.warn('ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
            }
        }

        function showBasicAlert(message) {
            alert(message);
        }

        // ì•± ì‹œì‘ (ê¸°ì¡´ ë³µì¡í•œ ì´ˆê¸°í™” ì œê±°)
        window.addEventListener('load', () => {
            console.log('Personal Color AI Pro - ë¹ ë¥¸ ë¡œë”© ëª¨ë“œ');
        })            computeDeltaE2000(lab1, lab2) {
                // CIE Delta E 2000 ì™„ì „ êµ¬í˜„
                const L1 = lab1.L || lab1.l, a1 = lab1.a, b1 = lab1.b;
                const L2 = lab2.L || lab2.l, a2 = lab2.a, b2 = lab2.b;

                // 1. Calculate C and h
                const C1 = Math.sqrt(a1 * a1 + b1 * b1);
                const C2 = Math.sqrt(a2 * a2 + b2 * b2);
                const C_bar = (C1 + C2) / 2;

                // 2. Calculate G
                const G = 0.5 * (1 - Math.sqrt(Math.pow(C_bar, 7) / (Math.pow(C_bar, 7) + Math.pow(25, 7))));

                // 3. Calculate a' and C'
                const a1_prime = (1 + G) * a1;
                const a2_prime = (1 + G) * a2;
                const C1_prime = Math.sqrt(a1_prime * a1_prime + b1 * b1);
                const C2_prime = Math.sqrt(a2_prime * a2_prime + b2 * b2);

                // 4. Calculate h'
                const h1_prime = this.calculateHuePrime(a1_prime, b1);
                const h2_prime = this.calculateHuePrime(a2_prime, b2);

                // 5. Calculate differences
                const deltaL_prime = L2 - L1;
                const deltaC_prime = C2_prime - C1_prime;
                const deltaH_prime = this.calculateDeltaHPrime(C1_prime, C2_prime, h1_prime, h2_prime);

                // 6. Calculate averages
                const L_bar = (L1 + L2) / 2;
                const C_bar_prime = (C1_prime + C2_prime) / 2;
                const H_bar_prime = this.calculateHBarPrime(h1_prime, h2_prime);

                // 7. Calculate T
                const T = 1 - 0.17 * Math.cos(this.degreesToRadians(H_bar_prime - 30)) +
                         0.24 * Math.cos(this.degreesToRadians(2 * H_bar_prime)) +
                         0.32 * Math.cos(this.degreesToRadians(3 * H_bar_prime + 6)) -
                         0.20 * Math.cos(this.degreesToRadians(4 * H_bar_prime - 63));

                // 8. Calculate SL, SC, SH
                const SL = 1 + (0.015 * Math.pow(L_bar - 50, 2)) / Math.sqrt(20 + Math.pow(L_bar - 50, 2));
                const SC = 1 + 0.045 * C_bar_prime;
                const SH = 1 + 0.015 * C_bar_prime * T;

                // 9. Calculate RT
                const deltaTheta = 30 * Math.exp(-Math.pow((H_bar_prime - 275) / 25, 2));
                const RC = 2 * Math.sqrt(Math.pow(C_bar_prime, 7) / (Math.pow(C_bar_prime, 7) + Math.pow(25, 7)));
                const RT = -RC * Math.sin(this.degreesToRadians(2 * deltaTheta));

                // 10. Calculate final Delta E 2000
                const kL = 1, kC = 1, kH = 1;
                const deltaE2000 = Math.sqrt(
                    Math.pow(deltaL_prime / (kL * SL), 2) +
                    Math.pow(deltaC_prime / (kC * SC), 2) +
                    Math.pow(deltaH_prime / (kH * SH), 2) +
                    RT * (deltaC_prime / (kC * SC)) * (deltaH_prime / (kH * SH))
                );

                return parseFloat(deltaE2000.toFixed(3));
            }

            calculateHuePrime(a_prime, b) {
                if (a_prime === 0 && b === 0) return 0;
                const hue = this.radiansToDegrees(Math.atan2(b, a_prime));
                return hue >= 0 ? hue : hue + 360;
            }

            calculateDeltaHPrime(C1_prime, C2_prime, h1_prime, h2_prime) {
                if (C1_prime * C2_prime === 0) return 0;
                
                const delta_h = h2_prime - h1_prime;
                if (Math.abs(delta_h) <= 180) {
                    return 2 * Math.sqrt(C1_prime * C2_prime) * Math.sin(this.degreesToRadians(delta_h / 2));
                } else if (delta_h > 180) {
                    return 2 * Math.sqrt(C1_prime * C2_prime) * Math.sin(this.degreesToRadians((delta_h - 360) / 2));
                } else {
                    return 2 * Math.sqrt(C1_prime * C2_prime) * Math.sin(this.degreesToRadians((delta_h + 360) / 2));
                }
            }

            calculateHBarPrime(h1_prime, h2_prime) {
                if (Math.abs(h1_prime - h2_prime) > 180) {
                    return (h1_prime + h2_prime + 360) / 2;
                } else {
                    return (h1_prime + h2_prime) / 2;
                }
            }

            degreesToRadians(degrees) {
                return degrees * Math.PI / 180;
            }

            radiansToDegrees(radians) {
                return radians * 180 / Math.PI;
            }

            generateCacheKey(lab1, lab2) {
                const l1 = (lab1.L || lab1.l).toFixed(2);
                const a1 = lab1.a.toFixed(2);
                const b1 = lab1.b.toFixed(2);
                const l2 = (lab2.L || lab2.l).toFixed(2);
                const a2 = lab2.a.toFixed(2);
                const b2 = lab2.b.toFixed(2);
                return `${l1},${a1},${b1}-${l2},${a2},${b2}`;
            }

            assessColorSimilarity(deltaE) {
                let level, score, description;

                if (deltaE <= 1.0) {
                    level = 'perfect';
                    score = 100;
                    description = 'ì™„ë²½í•œ ë§¤ì¹­';
                } else if (deltaE <= 2.3) {
                    level = 'excellent';
                    score = Math.round(95 - (deltaE - 1) * 10);
                    description = 'ë§¤ìš° ì˜ ì–´ìš¸ë¦¼';
                } else if (deltaE <= 5.0) {
                    level = 'good';
                    score = Math.round(85 - (deltaE - 2.3) * 7);
                    description = 'ì˜ ì–´ìš¸ë¦¼';
                } else if (deltaE <= 10.0) {
                    level = 'acceptable';
                    score = Math.round(65 - (deltaE - 5) * 5);
                    description = 'ì–´ìš¸ë¦¼';
                } else {
                    level = 'poor';
                    score = Math.max(10, Math.round(40 - (deltaE - 10) * 2));
                    description = 'ì˜ ì–´ìš¸ë¦¬ì§€ ì•ŠìŒ';
                }

                return { 
                    level, 
                    score: Math.max(0, Math.min(100, score)), 
                    description, 
                    deltaE: parseFloat(deltaE.toFixed(3)) 
                };
            }

            getPerformanceStats() {
                const hitRate = this.cacheHits / (this.cacheHits + this.cacheMisses) || 0;
                return {
                    totalCalculations: this.totalCalculations,
                    cacheHits: this.cacheHits,
                    cacheMisses: this.cacheMisses,
                    hitRate: Math.round(hitRate * 100),
                    cacheSize: this.cache.size
                };
            }
        }

        // ì–¼êµ´ ê°ì§€ ë° í”¼ë¶€í†¤ ë¶„ì„ í´ë˜ìŠ¤
        class FaceDetectionAndSkinAnalysis {
            constructor() {
                this.isInitialized = false;
                this.analysisCount = 0;
                this.skinRegions = [
                    { name: 'forehead', x: 0.3, y: 0.15, w: 0.4, h: 0.15 },
                    { name: 'left_cheek', x: 0.15, y: 0.35, w: 0.2, h: 0.25 },
                    { name: 'right_cheek', x: 0.65, y: 0.35, w: 0.2, h: 0.25 },
                    { name: 'nose_bridge', x: 0.4, y: 0.3, w: 0.2, h: 0.2 },
                    { name: 'chin', x: 0.35, y: 0.7, w: 0.3, h: 0.15 }
                ];
                console.log('ì–¼êµ´ ê°ì§€ ë° í”¼ë¶€í†¤ ë¶„ì„ ì‹œìŠ¤í…œ ì´ˆê¸°í™”ë¨');
            }

            async initialize() {
                if (this.isInitialized) return;
                
                try {
                    // TensorFlow.js ëª¨ë¸ ë¡œë”© ì‹œë®¬ë ˆì´ì…˜
                    await this.delay(500);
                    this.isInitialized = true;
                    console.log('ì–¼êµ´ ê°ì§€ ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ');
                } catch (error) {
                    console.warn('ì–¼êµ´ ê°ì§€ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                    this.isInitialized = true; // ê¸°ë³¸ ë¶„ì„ìœ¼ë¡œ ê³„ì† ì§„í–‰
                }
            }

            async detectFaceAndAnalyzeSkin(imageSource) {
                this.analysisCount++;
                const startTime = performance.now();
                
                try {
                    console.log('ì–¼êµ´ ê°ì§€ ë° í”¼ë¶€í†¤ ë¶„ì„ ì‹œì‘...');
                    
                    // 1. ì–¼êµ´ ê°ì§€
                    const faces = await this.detectFaces(imageSource);
                    if (faces.length === 0) {
                        throw new Error('ì–¼êµ´ì„ ê°ì§€í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    }
                    
                    // 2. ì´ë¯¸ì§€ ë°ì´í„° ì¶”ì¶œ
                    const imageData = await this.extractImageData(imageSource);
                    
                    // 3. í”¼ë¶€ ì˜ì—­ ë¶„ì„
                    const skinAnalysis = await this.analyzeSkinTone(imageData, faces[0]);
                    
                    const processingTime = performance.now() - startTime;
                    window.PersonalColorAI.performance.processingTime += processingTime;
                    
                    return {
                        faces: faces,
                        skinAnalysis: skinAnalysis,
                        processingTime: Math.round(processingTime),
                        metadata: {
                            analysisCount: this.analysisCount,
                            timestamp: new Date().toISOString()
                        }
                    };
                    
                } catch (error) {
                    console.error('ì–¼êµ´ ê°ì§€ ë° í”¼ë¶€í†¤ ë¶„ì„ ì‹¤íŒ¨:', error);
                    throw error;
                }
            }

            async detectFaces(imageSource) {
                // ì‹¤ì œ ì–¼êµ´ ê°ì§€ êµ¬í˜„ (ê°„ì†Œí™”ëœ ë²„ì „)
                const width = imageSource.videoWidth || imageSource.width || 640;
                const height = imageSource.videoHeight || imageSource.height || 480;
                
                // ì¤‘ì•™ ì˜ì—­ì„ ì–¼êµ´ë¡œ ê°€ì •
                const faceRegion = {
                    x: Math.floor(width * 0.2),
                    y: Math.floor(height * 0.15),
                    width: Math.floor(width * 0.6),
                    height: Math.floor(height * 0.7),
                    confidence: 0.85
                };
                
                // UIì— ì–¼êµ´ ê°ì§€ ë°•ìŠ¤ í‘œì‹œ
                this.displayFaceDetection([faceRegion]);
                
                return [faceRegion];
            }

            displayFaceDetection(faces) {
                const overlay = document.getElementById('face-detection-overlay');
                if (!overlay) return;
                
                overlay.innerHTML = '';
                
                faces.forEach((face, index) => {
                    // ì–¼êµ´ ë°•ìŠ¤
                    const faceBox = document.createElement('div');
                    faceBox.className = 'face-box';
                    faceBox.style.left = `${(face.x / 640) * 100}%`;
                    faceBox.style.top = `${(face.y / 480) * 100}%`;
                    faceBox.style.width = `${(face.width / 640) * 100}%`;
                    faceBox.style.height = `${(face.height / 480) * 100}%`;
                    overlay.appendChild(faceBox);
                    
                    // í”¼ë¶€ ì˜ì—­ í‘œì‹œ
                    this.skinRegions.forEach(region => {
                        const skinRegion = document.createElement('div');
                        skinRegion.className = 'skin-region';
                        skinRegion.title = region.name;
                        
                        const regionX = face.x + (face.width * region.x);
                        const regionY = face.y + (face.height * region.y);
                        const regionW = face.width * region.w;
                        const regionH = face.height * region.h;
                        
                        skinRegion.style.left = `${(regionX / 640) * 100}%`;
                        skinRegion.style.top = `${(regionY / 480) * 100}%`;
                        skinRegion.style.width = `${(regionW / 640) * 100}%`;
                        skinRegion.style.height = `${(regionH / 480) * 100}%`;
                        
                        overlay.appendChild(skinRegion);
                    });
                });
            }

            async extractImageData(imageSource) {
                return new Promise((resolve) => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    if (imageSource.videoWidth) {
                        canvas.width = imageSource.videoWidth;
                        canvas.height = imageSource.videoHeight;
                        ctx.drawImage(imageSource, 0, 0);
                    } else {
                        canvas.width = imageSource.width;
                        canvas.height = imageSource.height;
                        ctx.drawImage(imageSource, 0, 0);
                    }
                    
                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    resolve(imageData);
                });
            }

            async analyzeSkinTone(imageData, faceRegion) {
                const skinSamples = this.extractSkinPixels(imageData, faceRegion);
                const labSamples = skinSamples.map(sample => this.rgbToLab(sample));
                
                if (labSamples.length === 0) {
                    throw new Error('í”¼ë¶€ ìƒ˜í”Œì„ ì¶”ì¶œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                const averageLab = this.calculateAverageLab(labSamples);
                const undertone = this.analyzeUndertone(labSamples);
                const seasonAnalysis = await this.classifySeason(averageLab);
                
                return {
                    skinSamples: skinSamples.length,
                    averageLab: averageLab,
                    undertone: undertone,
                    season: seasonAnalysis,
                    confidence: this.calculateConfidence(skinSamples.length, seasonAnalysis.deltaE),
                    brightness: this.analyzeBrightness(averageLab.L),
                    saturation: this.analyzeSaturation(averageLab)
                };
            }

            extractSkinPixels(imageData, faceRegion) {
                const samples = [];
                const data = imageData.data;
                const width = imageData.width;
                const height = imageData.height;
                
                this.skinRegions.forEach(region => {
                    const startX = Math.floor(faceRegion.x + faceRegion.width * region.x);
                    const startY = Math.floor(faceRegion.y + faceRegion.height * region.y);
                    const endX = Math.floor(startX + faceRegion.width * region.w);
                    const endY = Math.floor(startY + faceRegion.height * region.h);
                    
                    for (let y = startY; y < endY; y += 3) {
                        for (let x = startX; x < endX; x += 3) {
                            if (x >= 0 && x < width && y >= 0 && y < height) {
                                const i = (y * width + x) * 4;
                                const r = data[i];
                                const g = data[i + 1];
                                const b = data[i + 2];
                                const a = data[i + 3];
                                
                                if (this.isValidSkinPixel(r, g, b, a)) {
                                    samples.push({ r, g, b });
                                }
                            }
                        }
                    }
                });
                
                console.log(`í”¼ë¶€ ìƒ˜í”Œ ${samples.length}ê°œ ì¶”ì¶œë¨`);
                return samples;
            }

            isValidSkinPixel(r, g, b, a) {
                if (a < 200) return false; // íˆ¬ëª…ë„ ì²´í¬
                
                // ë„ˆë¬´ ì–´ë‘¡ê±°ë‚˜ ë°ì€ í”½ì…€ ì œì™¸
                const brightness = (r + g + b) / 3;
                if (brightness < 50 || brightness > 230) return false;
                
                // ê¸°ë³¸ì ì¸ í”¼ë¶€ìƒ‰ í•„í„°ë§
                if (r < g - 15 || g < b - 10) return false;
                
                // ì±„ë„ê°€ ë„ˆë¬´ ë†’ì€ í”½ì…€ ì œì™¸
                const max = Math.max(r, g, b);
                const min = Math.min(r, g, b);
                const saturation = max === 0 ? 0 : (max - min) / max;
                if (saturation > 0.4) return false;
                
                return true;
            }

            rgbToLab(rgb) {
                // sRGB to XYZ
                let r = rgb.r / 255;
                let g = rgb.g / 255;
                let b = rgb.b / 255;
                
                r = r > 0.04045 ? Math.pow((r + 0.055) / 1.055, 2.4) : r / 12.92;
                g = g > 0.04045 ? Math.pow((g + 0.055) / 1.055, 2.4) : g / 12.92;
                b = b > 0.04045 ? Math.pow((b + 0.055) / 1.055, 2.4) : b / 12.92;
                
                const X = r * 0.4124564 + g * 0.3575761 + b * 0.1804375;
                const Y = r * 0.2126729 + g * 0.7151522 + b * 0.0721750;
                const Z = r * 0.0193339 + g * 0.1191920 + b * 0.9503041;
                
                // XYZ to Lab
                const Xn = 0.95047, Yn = 1.00000, Zn = 1.08883;
                
                const fx = this.xyzToLabFunc(X / Xn);
                const fy = this.xyzToLabFunc(Y / Yn);
                const fz = this.xyzToLabFunc(Z / Zn);
                
                const L = 116 * fy - 16;
                const a = 500 * (fx - fy);
                const bValue = 200 * (fy - fz);
                
                return {
                    L: parseFloat(L.toFixed(3)),
                    a: parseFloat(a.toFixed(3)),
                    b: parseFloat(bValue.toFixed(3))
                };
            }

            xyzToLabFunc(t) {
                return t > 0.008856 ? Math.pow(t, 1/3) : (7.787 * t + 16/116);
            }

            calculateAverageLab(labSamples) {
                const sum = labSamples.reduce((acc, lab) => ({
                    L: acc.L + lab.L,
                    a: acc.a + lab.a,
                    b: acc.b + lab.b
                }), { L: 0, a: 0, b: 0 });
                
                const count = labSamples.length;
                return {
                    L: parseFloat((sum.L / count).toFixed(3)),
                    a: parseFloat((sum.a / count).toFixed(3)),
                    b: parseFloat((sum.b / count).toFixed(3))
                };
            }

            analyzeUndertone(labSamples) {
                let warmCount = 0;
                let coolCount = 0;
                
                labSamples.forEach(lab => {
                    if (lab.b > lab.a && lab.b > 0) {
                        warmCount++;
                    } else if (lab.a < 0 || (lab.a > lab.b && lab.a > 0)) {
                        coolCount++;
                    }
                });
                
                const total = warmCount + coolCount;
                if (total === 0) return { type: 'neutral', confidence: 50 };
                
                const warmRatio = warmCount / total;
                const coolRatio = coolCount / total;
                
                if (warmRatio > 0.6) {
                    return { type: 'warm', confidence: Math.round(warmRatio * 100) };
                } else if (coolRatio > 0.6) {
                    return { type: 'cool', confidence: Math.round(coolRatio * 100) };
                } else {
                    return { type: 'neutral', confidence: 70 };
                }
            }

            async classifySeason(skinLab) {
                const deltaE = window.PersonalColorAI.ai.deltaE;
                const seasons = window.PersonalColorAI.colorDatabase.seasons;
                
                if (!deltaE || !seasons) {
                    return { season: 'autumn', confidence: 50, deltaE: 99 };
                }
                
                const distances = {};
                Object.keys(seasons).forEach(seasonKey => {
                    const season = seasons[seasonKey];
                    const referenceLab = {
                        L: season.referenceL,
                        a: season.referenceA,
                        b: season.referenceB
                    };
                    distances[seasonKey] = deltaE.calculateDeltaE2000(skinLab, referenceLab);
                });
                
                const bestSeason = Object.keys(distances).reduce((best, season) => {
                    return distances[season] < distances[best] ? season : best;
                });
                
                const minDistance = distances[bestSeason];
                const confidence = Math.max(60, Math.round(100 - minDistance * 2));
                
                return {
                    season: bestSeason,
                    seasonName: seasons[bestSeason].name,
                    confidence: confidence,
                    deltaE: parseFloat(minDistance.toFixed(3)),
                    allDistances: distances
                };
            }

            analyzeBrightness(L) {
                if (L >= 75) return { level: 'light', description: 'ë°ì€ í†¤' };
                if (L >= 50) return { level: 'medium', description: 'ì¤‘ê°„ í†¤' };
                return { level: 'deep', description: 'ì§„í•œ í†¤' };
            }

            analyzeSaturation(lab) {
                const chroma = Math.sqrt(lab.a * lab.a + lab.b * lab.b);
                if (chroma >= 35) return { level: 'clear', description: 'ì„ ëª…í•œ í†¤' };
                if (chroma >= 20) return { level: 'medium', description: 'ì¤‘ê°„ í†¤' };
                return { level: 'soft', description: 'ë¶€ë“œëŸ¬ìš´ í†¤' };
            }

            calculateConfidence(sampleCount, deltaE) {
                const sampleScore = Math.min(40, (sampleCount / 100) * 40);
                const deltaEScore = Math.max(20, 60 - deltaE * 3);
                return Math.min(95, Math.round(sampleScore + deltaEScore));
            }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // ì‹¤ì‹œê°„ ë“œë˜ì´í•‘ ì—”ì§„
        class VirtualDrapingEngine {
            constructor() {
                this.isActive = false;
                this.stream = null;
                this.selectedColors = [];
                this.currentSkinTone = null;
                this.fabricElements = [];
                console.log('ê°€ìƒ ë“œë˜ì´í•‘ ì—”ì§„ ì´ˆê¸°í™”ë¨');
            }

            async initialize() {
                try {
                    console.log('ë“œë˜ì´í•‘ ì‹œìŠ¤í…œ ì‹œì‘...');
                    
                    this.stream = await navigator.mediaDevices.getUserMedia({
                        video: { 
                            width: { ideal: 1280 }, 
                            height: { ideal: 720 },
                            facingMode: 'user'
                        }
                    });
                    
                    const video = document.getElementById('draping-video');
                    if (video) {
                        video.srcObject = this.stream;
                        video.onloadedmetadata = () => {
                            video.play();
                        };
                    }
                    
                    this.setupColorPalette();
                    this.setupSeasonButtons();
                    this.startSkinAnalysis();
                    
                    this.isActive = true;
                    console.log('ë“œë˜ì´í•‘ ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ');
                    
                } catch (error) {
                    console.error('ë“œë˜ì´í•‘ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                    showToast('ì¹´ë©”ë¼ ì ‘ê·¼ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.', 'error');
                    throw error;
                }
            }

            setupColorPalette() {
                const seasons = window.PersonalColorAI.colorDatabase.seasons;
                const grid = document.getElementById('draping-color-grid');
                if (!grid || !seasons) return;
                
                this.updateColorGrid('spring'); // ê¸°ë³¸ê°’ìœ¼ë¡œ ë´„ ìƒ‰ìƒ í‘œì‹œ
            }

            setupSeasonButtons() {
                document.querySelectorAll('.season-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.season-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        
                        const season = btn.dataset.season;
                        this.updateColorGrid(season);
                    });
                });
            }

            updateColorGrid(season) {
                const seasons = window.PersonalColorAI.colorDatabase.seasons;
                const grid = document.getElementById('draping-color-grid');
                
                if (!seasons[season] || !grid) return;
                
                grid.innerHTML = '';
                seasons[season].colors.forEach(color => {
                    const colorItem = document.createElement('div');
                    colorItem.className = 'color-item';
                    colorItem.style.backgroundColor = color;
                    colorItem.title = color;
                    colorItem.addEventListener('click', () => this.selectColor(color, colorItem));
                    grid.appendChild(colorItem);
                });
            }

            async selectColor(color, element) {
                element.classList.toggle('selected');
                
                if (element.classList.contains('selected')) {
                    this.selectedColors.push(color);
                    this.createVirtualFabric(color);
                    await this.performLiveAnalysis(color);
                } else {
                    this.selectedColors = this.selectedColors.filter(c => c !== color);
                    this.removeVirtualFabric(color);
                }
            }

            createVirtualFabric(color) {
                const overlay = document.getElementById('virtual-fabric-overlay');
                if (!overlay) return;
                
                const fabric = document.createElement('div');
                fabric.className = 'virtual-fabric';
                fabric.style.backgroundColor = color;
                fabric.style.background = `linear-gradient(135deg, ${color}, ${this.adjustBrightness(color, -15)})`;
                fabric.dataset.color = color;
                
                // ì²œ ìœ„ì¹˜ ë° í¬ê¸° ì„¤ì •
                fabric.style.left = '12%';
                fabric.style.top = '20%';
                fabric.style.width = '320px';
                fabric.style.height = '420px';
                fabric.style.transform = 'rotate(-5deg)';
                
                overlay.appendChild(fabric);
                this.fabricElements.push(fabric);
                
                console.log(`ê°€ìƒ ì²œ ìƒì„±: ${color}`);
            }

            removeVirtualFabric(color) {
                const overlay = document.getElementById('virtual-fabric-overlay');
                if (!overlay) return;
                
                const fabric = overlay.querySelector(`[data-color="${color}"]`);
                if (fabric) {
                    overlay.removeChild(fabric);
                    this.fabricElements = this.fabricElements.filter(f => f !== fabric);
                }
            }

            adjustBrightness(hexColor, amount) {
                const hex = hexColor.replace('#', '');
                const r = Math.max(0, Math.min(255, parseInt(hex.substr(0, 2), 16) + amount));
                const g = Math.max(0, Math.min(255, parseInt(hex.substr(2, 2), 16) + amount));
                const b = Math.max(0, Math.min(255, parseInt(hex.substr(4, 2), 16) + amount));
                
                return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;
            }

            startSkinAnalysis() {
                // ì‹¤ì‹œê°„ í”¼ë¶€í†¤ ë¶„ì„ ì‹œë®¬ë ˆì´ì…˜
                setInterval(() => {
                    if (this.isActive) {
                        // ê¸°ë³¸ í”¼ë¶€í†¤ìœ¼ë¡œ ì‹œë®¬ë ˆì´ì…˜
                        this.currentSkinTone = {
                            L: 58 + Math.random() * 15,
                            a: 6 + Math.random() * 8,
                            b: 12 + Math.random() * 12
                        };
                    }
                }, 3000);
            }

            async performLiveAnalysis(selectedColor) {
                if (!this.currentSkinTone) {
                    this.currentSkinTone = { L: 60, a: 8, b: 15 }; // ê¸°ë³¸ê°’
                }
                
                const deltaE = window.PersonalColorAI.ai.deltaE;
                if (!deltaE) return;
                
                try {
                    const colorLab = this.hexToLab(selectedColor);
                    const deltaEValue = deltaE.calculateDeltaE2000(this.currentSkinTone, colorLab);
                    const assessment = deltaE.assessColorSimilarity(deltaEValue);
                    
                    this.updateLiveDisplay(deltaEValue, assessment);
                    
                } catch (error) {
                    console.warn('ì‹¤ì‹œê°„ ë¶„ì„ ì˜¤ë¥˜:', error);
                }
            }

            hexToLab(hex) {
                const r = parseInt(hex.substr(1, 2), 16);
                const g = parseInt(hex.substr(3, 2), 16);
                const b = parseInt(hex.substr(5, 2), 16);
                
                // RGB to Lab ë³€í™˜ (ê°„ì†Œí™”)
                const rLinear = Math.pow(r / 255.0, 2.2);
                const gLinear = Math.pow(g / 255.0, 2.2);
                const bLinear = Math.pow(b / 255.0, 2.2);
                
                const X = rLinear * 0.4124 + gLinear * 0.3576 + bLinear * 0.1805;
                const Y = rLinear * 0.2126 + gLinear * 0.7152 + bLinear * 0.0722;
                const Z = rLinear * 0.0193 + gLinear * 0.1192 + bLinear * 0.9505;
                
                const xn = X / 0.95047;
                const yn = Y / 1.00000;
                const zn = Z / 1.08883;
                
                const fx = xn > 0.008856 ? Math.pow(xn, 1/3) : (7.787 * xn + 16/116);
                const fy = yn > 0.008856 ? Math.pow(yn, 1/3) : (7.787 * yn + 16/116);
                const fz = zn > 0.008856 ? Math.pow(zn, 1/3) : (7.787 * zn + 16/116);
                
                const L = 116 * fy - 16;
                const a = 500 * (fx - fy);
                const bValue = 200 * (fy - fz);
                
                return { L, a, b: bValue };
            }

            updateLiveDisplay(deltaE, assessment) {
                const elements = {
                    'live-delta-value': deltaE.toFixed(1),
                    'live-delta-description': assessment.description,
                    'live-score-text': `${assessment.score}ì `
                };
                
                Object.keys(elements).forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.textContent = elements[id];
                    }
                });
                
                // ì ìˆ˜ ê²Œì´ì§€ ì—…ë°ì´íŠ¸
                const scoreFill = document.getElementById('live-score-fill');
                if (scoreFill) {
                    scoreFill.style.width = `${assessment.score}%`;
                }
                
                // ì¶”ì²œ ë°°ì§€ ì—…ë°ì´íŠ¸
                this.updateRecommendationBadge(assessment);
                
                // Delta E ê°’ì— ë”°ë¥¸ ìƒ‰ìƒ ë³€ê²½
                const deltaValueEl = document.getElementById('live-delta-value');
                if (deltaValueEl) {
                    deltaValueEl.style.color = this.getDeltaEColor(deltaE);
                }
            }

            updateRecommendationBadge(assessment) {
                const container = document.getElementById('live-recommendation-badge');
                if (!container) return;
                
                const icons = {
                    'perfect': 'ğŸŒŸ',
                    'excellent': 'âœ¨',
                    'good': 'ğŸ‘',
                    'acceptable': 'âš ï¸',
                    'poor': 'âŒ'
                };
                
                container.innerHTML = `
                    <div class="recommendation-badge ${assessment.level}">
                        ${icons[assessment.level] || 'ğŸ“Š'} ${assessment.description}
                    </div>
                `;
            }

            getDeltaEColor(deltaE) {
                if (deltaE <= 2.3) return '#4caf50';
                if (deltaE <= 5.0) return '#ff9800';
                if (deltaE <= 10.0) return '#ff5722';
                return '#f44336';
            }

            capture() {
                const video = document.getElementById('draping-video');
                if (!video) return;
                
                const canvas = document.createElement('canvas');
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                
                const ctx = canvas.getContext('2d');
                ctx.scale(-1, 1); // ë¯¸ëŸ¬ íš¨ê³¼ ë³´ì •
                ctx.drawImage(video, -canvas.width, 0);
                
                // ê°€ìƒ ì²œë“¤ë„ í•¨ê»˜ ìº¡ì²˜ (êµ¬í˜„ í•„ìš”)
                
                const dataURL = canvas.toDataURL('image/png');
                console.log('ë“œë˜ì´í•‘ ê²°ê³¼ ìº¡ì²˜ë¨');
                
                return dataURL;
            }

            reset() {
                this.selectedColors = [];
                this.fabricElements.forEach(fabric => {
                    if (fabric.parentNode) {
                        fabric.parentNode.removeChild(fabric);
                    }
                });
                this.fabricElements = [];
                
                // ëª¨ë“  ìƒ‰ìƒ ì„ íƒ í•´ì œ
                document.querySelectorAll('.color-item.selected').forEach(item => {
                    item.classList.remove('selected');
                });
                
                // ë¶„ì„ ë””ìŠ¤í”Œë ˆì´ ì´ˆê¸°í™”
                const elements = {
                    'live-delta-value': '--.-',
                    'live-delta-description': 'ìƒ‰ìƒì„ ì„ íƒí•˜ì„¸ìš”',
                    'live-score-text': '0ì '
                };
                
                Object.keys(elements).forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.textContent = elements[id];
                    }
                });
                
                const scoreFill = document.getElementById('live-score-fill');
                if (scoreFill) {
                    scoreFill.style.width = '0%';
                }
                
                const badgeContainer = document.getElementById('live-recommendation-badge');
                if (badgeContainer) {
                    badgeContainer.innerHTML = '';
                }
                
                console.log('ë“œë˜ì´í•‘ ì‹œìŠ¤í…œ ì´ˆê¸°í™”ë¨');
            }

            destroy() {
                this.isActive = false;
                
                if (this.stream) {
                    this.stream.getTracks().forEach(track => track.stop());
                    this.stream = null;
                }
                
                this.fabricElements.forEach(fabric => {
                    if (fabric.parentNode) {
                        fabric.parentNode.removeChild(fabric);
                    }
                });
                
                this.fabricElements = [];
                this.selectedColors = [];
                this.currentSkinTone = null;
                
                console.log('ë“œë˜ì´í•‘ ì—”ì§„ ì¢…ë£Œë¨');
            }
        }

        // ê³ ê° ê´€ë¦¬ ì‹œìŠ¤í…œ
        class CustomerManager {
            constructor() {
                this.customers = this.loadCustomers();
                this.currentCustomer = null;
                console.log('ê³ ê° ê´€ë¦¬ ì‹œìŠ¤í…œ ì´ˆê¸°í™”ë¨');
            }

            loadCustomers() {
                try {
                    const data = localStorage.getItem('personalcolor_customers');
                    return data ? JSON.parse(data) : [];
                } catch (error) {
                    console.warn('ê³ ê° ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                    return [];
                }
            }

            saveCustomers() {
                try {
                    localStorage.setItem('personalcolor_customers', JSON.stringify(this.customers));
                    console.log('ê³ ê° ë°ì´í„° ì €ì¥ë¨');
                } catch (error) {
                    console.error('ê³ ê° ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:', error);
                    throw error;
                }
            }

            addCustomer(customerData) {
                const customer = {
                    id: Date.now().toString(),
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    ...customerData
                };
                
                this.customers.push(customer);
                this.saveCustomers();
                this.updateCustomerCount();
                
                console.log('ìƒˆ ê³ ê° ì¶”ê°€ë¨:', customer.name);
                return customer;
            }

            updateCustomer(customerId, updates) {
                const customerIndex = this.customers.findIndex(c => c.id === customerId);
                if (customerIndex === -1) {
                    throw new Error('ê³ ê°ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                this.customers[customerIndex] = {
                    ...this.customers[customerIndex],
                    ...updates,
                    updatedAt: new Date().toISOString()
                };
                
                this.saveCustomers();
                console.log('ê³ ê° ì •ë³´ ì—…ë°ì´íŠ¸ë¨:', customerId);
                
                return this.customers[customerIndex];
            }

            addDiagnosisToCustomer(customerId, diagnosisResult) {
                const customer = this.customers.find(c => c.id === customerId);
                if (!customer) {
                    throw new Error('ê³ ê°ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                if (!customer.diagnoses) {
                    customer.diagnoses = [];
                }
                
                const diagnosis = {
                    id: Date.now().toString(),
                    timestamp: new Date().toISOString(),
                    ...diagnosisResult
                };
                
                customer.diagnoses.push(diagnosis);
                customer.updatedAt = new Date().toISOString();
                
                this.saveCustomers();
                console.log('ì§„ë‹¨ ê²°ê³¼ ì¶”ê°€ë¨:', customer.name);
                
                return diagnosis;
            }

            getCustomerHistory(limit = 10) {
                return this.customers
                    .sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt))
                    .slice(0, limit);
            }

            updateCustomerCount() {
                const countElement = document.getElementById('customer-count');
                if (countElement) {
                    countElement.textContent = this.customers.length;
                }
                
                window.PersonalColorAI.performance.customersServed = this.customers.length;
            }

            exportCustomerData() {
                const data = {
                    exportDate: new Date().toISOString(),
                    totalCustomers: this.customers.length,
                    customers: this.customers
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `personal_color_customers_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                console.log('ê³ ê° ë°ì´í„° ë‚´ë³´ë‚´ê¸° ì™„ë£Œ');
            }

            displayCustomerHistory() {
                const tbody = document.getElementById('customer-history-body');
                if (!tbody) return;
                
                const history = this.getCustomerHistory(20);
                tbody.innerHTML = '';
                
                history.forEach(customer => {
                    const row = document.createElement('tr');
                    const lastDiagnosis = customer.diagnoses ? customer.diagnoses[customer.diagnoses.length - 1] : null;
                    
                    row.innerHTML = `
                        <td>${new Date(customer.updatedAt).toLocaleDateString('ko-KR')}</td>
                        <td>${customer.name}</td>
                        <td>${lastDiagnosis ? lastDiagnosis.season?.seasonName || 'ë¯¸ì§„ë‹¨' : 'ë¯¸ì§„ë‹¨'}</td>
                        <td>${customer.visitPurpose || '-'}</td>
                        <td>
                            <button onclick="loadCustomer('${customer.id}')" style="font-size: 0.7rem; padding: 0.2rem 0.5rem;">ë¶ˆëŸ¬ì˜¤ê¸°</button>
                        </td>
                    `;
                    
                    tbody.appendChild(row);
                });
            }
        }

        // PDF ë³´ê³ ì„œ ìƒì„±ê¸°
        class PDFReportGenerator {
            constructor() {
                this.jsPDF = window.jspdf?.jsPDF;
                if (!this.jsPDF) {
                    console.warn('jsPDF ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì§€ ì•ŠìŒ');
                }
            }

            async generateReport(diagnosisResult, customerInfo) {
                if (!this.jsPDF) {
                    throw new Error('PDF ìƒì„± ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                }
                
                try {
                    const pdf = new this.jsPDF();
                    
                    // í•œê¸€ í°íŠ¸ ì§€ì›ì„ ìœ„í•œ ê¸°ë³¸ ì„¤ì •
                    pdf.setFont('helvetica');
                    
                    // ì œëª©
                    pdf.setFontSize(20);
                    pdf.text('Personal Color Analysis Report', 20, 30);
                    
                    // ê³ ê° ì •ë³´
                    pdf.setFontSize(14);
                    pdf.text('Customer Information', 20, 50);
                    pdf.setFontSize(12);
                    pdf.text(`Name: ${customerInfo?.name || 'Unknown'}`, 25, 65);
                    pdf.text(`Date: ${new Date().toLocaleDateString('ko-KR')}`, 25, 75);
                    pdf.text(`Age: ${customerInfo?.age || 'N/A'}`, 25, 85);
                    pdf.text(`Gender: ${customerInfo?.gender || 'N/A'}`, 25, 95);
                    
                    // ì§„ë‹¨ ê²°ê³¼
                    pdf.setFontSize(14);
                    pdf.text('Analysis Results', 20, 120);
                    pdf.setFontSize(12);
                    pdf.text(`Season: ${diagnosisResult.season?.seasonName || 'Unknown'}`, 25, 135);
                    pdf.text(`Confidence: ${diagnosisResult.confidence || 0}%`, 25, 145);
                    pdf.text(`Undertone: ${diagnosisResult.undertone?.type || 'Unknown'}`, 25, 155);
                    pdf.text(`Brightness: ${diagnosisResult.brightness?.description || 'Unknown'}`, 25, 165);
                    pdf.text(`Saturation: ${diagnosisResult.saturation?.description || 'Unknown'}`, 25, 175);
                    pdf.text(`Delta E Score: ${diagnosisResult.season?.deltaE || 'N/A'}`, 25, 185);
                    
                    // ì¶”ì²œì‚¬í•­
                    pdf.setFontSize(14);
                    pdf.text('Recommendations', 20, 210);
                    pdf.setFontSize(12);
                    
                    const recommendations = this.getRecommendations(diagnosisResult);
                    let yPos = 225;
                    recommendations.forEach((rec, index) => {
                        if (yPos > 270) {
                            pdf.addPage();
                            yPos = 20;
                        }
                        pdf.text(`${index + 1}. ${rec}`, 25, yPos);
                        yPos += 10;
                    });
                    
                    // PDF ì €ì¥
                    const filename = `PersonalColor_${customerInfo?.name || 'Unknown'}_${new Date().toISOString().split('T')[0]}.pdf`;
                    pdf.save(filename);
                    
                    console.log('PDF ë³´ê³ ì„œ ìƒì„± ì™„ë£Œ:', filename);
                    showToast('PDF ë³´ê³ ì„œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                    
                } catch (error) {
                    console.error('PDF ìƒì„± ì‹¤íŒ¨:', error);
                    throw error;
                }
            }

            getRecommendations(diagnosisResult) {
                const recommendations = [];
                const season = diagnosisResult.season?.season;
                const seasonData = window.PersonalColorAI.colorDatabase.seasons[season];
                
                if (seasonData) {
                    recommendations.push(`ë‹¹ì‹ ì€ ${seasonData.name} íƒ€ì…ì…ë‹ˆë‹¤.`);
                    recommendations.push(`íŠ¹ì§•: ${seasonData.characteristics.join(', ')} ìƒ‰ìƒì´ ì–´ìš¸ë¦½ë‹ˆë‹¤.`);
                    
                    if (diagnosisResult.undertone?.type === 'warm') {
                        recommendations.push('ë”°ëœ»í•œ í†¤ì˜ ë©”ì´í¬ì—…ê³¼ í—¤ì–´ì»¬ëŸ¬ë¥¼ ì„ íƒí•˜ì„¸ìš”.');
                        recommendations.push('ê³¨ë“œ í†¤ ì•¡ì„¸ì„œë¦¬ê°€ ì˜ ì–´ìš¸ë¦½ë‹ˆë‹¤.');
                    } else if (diagnosisResult.undertone?.type === 'cool') {
                        recommendations.push('ì°¨ê°€ìš´ í†¤ì˜ ë©”ì´í¬ì—…ê³¼ í—¤ì–´ì»¬ëŸ¬ë¥¼ ì„ íƒí•˜ì„¸ìš”.');
                        recommendations.push('ì‹¤ë²„ í†¤ ì•¡ì„¸ì„œë¦¬ê°€ ì˜ ì–´ìš¸ë¦½ë‹ˆë‹¤.');
                    }
                    
                    if (diagnosisResult.brightness?.level === 'light') {
                        recommendations.push('ë°ê³  í™”ì‚¬í•œ ìƒ‰ìƒì„ í™œìš©í•˜ì„¸ìš”.');
                    } else if (diagnosisResult.brightness?.level === 'deep') {
                        recommendations.push('ì§„í•˜ê³  ê¹Šì€ ìƒ‰ìƒì´ ì–´ìš¸ë¦½ë‹ˆë‹¤.');
                    }
                }
                
                return recommendations;
            }
        }

        // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ ì‹œìŠ¤í…œ
        function showToast(message, type = 'info', duration = 4000, submessage = '') {
            const container = document.getElementById('toast-container');
            if (!container) return;

            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icons = {
                success: 'âœ…',
                error: 'âŒ', 
                warning: 'âš ï¸',
                info: 'â„¹ï¸'
            };

            toast.innerHTML = `
                <div class="toast-icon">${icons[type] || icons.info}</div>
                <div class="toast-content">
                    <div class="toast-message">${message}</div>
                    ${submessage ? `<div class="toast-submessage">${submessage}</div>` : ''}
                </div>
                <button class="toast-close">Ã—</button>
            `;

            const closeBtn = toast.querySelector('.toast-close');
            closeBtn.addEventListener('click', () => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (toast.parentNode) container.removeChild(toast);
                }, 300);
            });

            container.appendChild(toast);
            setTimeout(() => toast.classList.add('show'), 10);
            
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.classList.remove('show');
                    setTimeout(() => {
                        if (toast.parentNode) container.removeChild(toast);
                    }, 300);
                }
            }, duration);
        }

        // ì•± ì´ˆê¸°í™” ì‹œìŠ¤í…œ
        class AppInitializer {
            constructor() {
                this.loadingSteps = [
                    { id: 'config', name: 'ì„¤ì • íŒŒì¼ ë¡œë“œ', duration: 300 },
                    { id: 'tensorflow', name: 'TensorFlow.js ì´ˆê¸°í™”', duration: 800 },
                    { id: 'deltae', name: 'Delta E 2000 ì—”ì§„ ë¡œë”©', duration: 400 },
                    { id: 'skin', name: 'í”¼ë¶€í†¤ ë¶„ì„ ëª¨ë“ˆ ì¤€ë¹„', duration: 600 },
                    { id: 'face', name: 'ì–¼êµ´ ê°ì§€ ì‹œìŠ¤í…œ ë¡œë”©', duration: 500 },
                    { id: 'database', name: 'ìƒ‰ìƒ ë°ì´í„°ë² ì´ìŠ¤ ë¡œë“œ', duration: 300 },
                    { id: 'ui', name: 'ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ ì¤€ë¹„', duration: 400 }
                ];
                
                this.currentStep = 0;
                this.totalSteps = this.loadingSteps.length;
            }

            async initialize() {
                console.log('Personal Color AI Pro ì´ˆê¸°í™” ì‹œì‘');
                
                try {
                    for (let i = 0; i < this.loadingSteps.length; i++) {
                        const step = this.loadingSteps[i];
                        
                        this.updateStep(step.id, 'active');
                        this.updateProgress((i / this.totalSteps) * 100, step.name + ' ì¤‘...');
                        
                        await this.executeStep(step);
                        await this.delay(step.duration);
                        
                        this.updateStep(step.id, 'complete');
                    }
                    
                    this.updateProgress(100, 'ì´ˆê¸°í™” ì™„ë£Œ!');
                    
                    setTimeout(() => {
                        this.completeLoading();
                    }, 500);
                    
                } catch (error) {
                    console.error('ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                    this.showError('ì‹œìŠ¤í…œ ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                }
            }

            async executeStep(step) {
                switch (step.id) {
                    case 'config':
                        // ì„¤ì • ë¡œë“œ
                        break;
                        
                    case 'tensorflow':
                        await this.waitForTensorFlow();
                        break;
                        
                    case 'deltae':
                        window.PersonalColorAI.ai.deltaE = new DeltaE2000Engine();
                        break;
                        
                    case 'skin':
                        window.PersonalColorAI.ai.skinAnalyzer = new FaceDetectionAndSkinAnalysis();
                        await window.PersonalColorAI.ai.skinAnalyzer.initialize();
                        break;
                        
                    case 'face':
                        // ì–¼êµ´ ê°ì§€ëŠ” skinAnalyzerì— í¬í•¨ë¨
                        break;
                        
                    case 'database':
                        // ìƒ‰ìƒ ë°ì´í„°ë² ì´ìŠ¤ëŠ” ì´ë¯¸ ì •ì˜ë¨
                        break;
                        
                    case 'ui':
                        this.initializeUI();
                        break;
                }
            }

            async waitForTensorFlow() {
                return new Promise((resolve) => {
                    let attempts = 0;
                    const checkTF = () => {
                        attempts++;
                        if (typeof tf !== 'undefined' && tf.version) {
                            console.log('TensorFlow.js ì¤€ë¹„ë¨:', tf.version.core);
                            window.PersonalColorAI.ai.tensorflow = tf;
                            resolve();
                        } else if (attempts < 50) {
                            setTimeout(checkTF, 100);
                        } else {
                            console.warn('TensorFlow.js ë¡œë“œ íƒ€ì„ì•„ì›ƒ');
                            resolve(); // íƒ€ì„ì•„ì›ƒì´ì–´ë„ ê³„ì† ì§„í–‰
                        }
                    };
                    checkTF();
                });
            }

            initializeUI() {
                // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
                this.setupEventListeners();
                
                // ê³ ê° ê´€ë¦¬ ì‹œìŠ¤í…œ ì´ˆê¸°í™”
                window.PersonalColorAI.customerManager = new CustomerManager();
                window.PersonalColorAI.customerManager.updateCustomerCount();
                window.PersonalColorAI.customerManager.displayCustomerHistory();
                
                // PDF ìƒì„±ê¸° ì´ˆê¸°í™”
                window.PersonalColorAI.pdfGenerator = new PDFReportGenerator();
                
                console.log('UI ì´ˆê¸°í™” ì™„ë£Œ');
            }

            setupEventListeners() {
                // í—¤ë” ë²„íŠ¼ë“¤
                document.getElementById('photo-analysis-btn')?.addEventListener('click', () => switchMode('photo'));
                document.getElementById('draping-mode-btn')?.addEventListener('click', () => switchMode('draping'));
                document.getElementById('customer-management-btn')?.addEventListener('click', () => switchMode('customer'));
                document.getElementById('system-status-btn')?.addEventListener('click', showSystemStatus);
                document.getElementById('export-data-btn')?.addEventListener('click', exportAllData);
                
                // ì‚¬ì§„ ë¶„ì„ ê´€ë ¨
                document.getElementById('start-camera-btn')?.addEventListener('click', startCamera);
                document.getElementById('capture-photo-btn')?.addEventListener('click', captureAndAnalyze);
                document.getElementById('upload-file-btn')?.addEventListener('click', () => document.getElementById('file-input')?.click());
                document.getElementById('file-input')?.addEventListener('change', handleFileUpload);
                document.getElementById('reset-analysis-btn')?.addEventListener('click', resetAnalysis);
                document.getElementById('back-to-modes-btn')?.addEventListener('click', () => switchMode('selection'));
                
                // ë“œë˜ì´í•‘ ê´€ë ¨
                document.getElementById('capture-draping-btn')?.addEventListener('click', captureDraping);
                document.getElementById('reset-draping-btn')?.addEventListener('click', resetDraping);
                document.getElementById('close-draping-btn')?.addEventListener('click', closeDraping);
                
                // ê³ ê° ê´€ë¦¬ ê´€ë ¨
                document.getElementById('save-customer-btn')?.addEventListener('click', saveCustomer);
                document.getElementById('load-customer-btn')?.addEventListener('click', loadCustomerDialog);
                document.getElementById('clear-customer-btn')?.addEventListener('click', clearCustomerForm);
                document.getElementById('export-customer-btn')?.addEventListener('click', exportCustomers);
                
                // ê²°ê³¼ ê´€ë ¨
                document.getElementById('generate-pdf-btn')?.addEventListener('click', generatePDFReport);
                document.getElementById('save-to-customer-btn')?.addEventListener('click', saveDiagnosisToCustomer);
                document.getElementById('print-result-btn')?.addEventListener('click', () => window.print());
                document.getElementById('share-result-btn')?.addEventListener('click', shareResult);
                document.getElementById('new-analysis-btn')?.addEventListener('click', () => switchMode('selection'));
                
                console.log('ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì™„ë£Œ');
            }

            updateStep(stepId, status) {
                const step = document.getElementById(`step-${stepId}`);
                if (!step) return;
                
                const icons = { active: 'â³', complete: 'âœ…', error: 'âŒ' };
                const text = step.textContent.replace(/[â³âœ…âŒ]\s*/, '');
                step.textContent = `${icons[status]} ${text}`;
                
                if (status === 'active') {
                    step.classList.add('active');
                } else if (status === 'complete') {
                    step.classList.add('complete');
                    step.classList.remove('active');
                }
            }

            updateProgress(percentage, message) {
                const progressBar = document.getElementById('loading-progress');
                const messageEl = document.getElementById('loading-message');
                
                if (progressBar) {
                    progressBar.style.width = Math.min(100, Math.max(0, percentage)) + '%';
                }
                
                if (messageEl && message) {
                    messageEl.textContent = message;
                }
            }

            completeLoading() {
                const loadingScreen = document.getElementById('loading-screen');
                const mainApp = document.getElementById('main-app');
                
                if (loadingScreen) {
                    loadingScreen.style.display = 'none';
                }
                
                if (mainApp) {
                    mainApp.style.display = 'block';
                    mainApp.classList.add('loaded');
                }
                
                window.PersonalColorAI.isLoaded = true;
                
                // ì‹œìŠ¤í…œ ìƒíƒœ ì—…ë°ì´íŠ¸
                document.getElementById('ai-status').textContent = 'ì¤€ë¹„ë¨';
                document.getElementById('deltae-status').textContent = 'í™œì„±';
                
                showToast(
                    'Personal Color AI Pro ì‹œìŠ¤í…œì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤!', 
                    'success', 
                    5000, 
                    'ëª¨ë“  ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'
                );
                
                console.log('Personal Color AI Pro ë¡œë”© ì™„ë£Œ!');
            }

            showError(message) {
                console.error('ì´ˆê¸°í™” ì˜¤ë¥˜:', message);
                
                const errorDiv = document.createElement('div');
                errorDiv.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: white;
                    color: #dc2626;
                    padding: 2rem;
                    border-radius: 8px;
                    border: 2px solid #fecaca;
                    box-shadow: 0 10px 40px rgba(0,0,0,0.3);
                    z-index: 10000;
                    text-align: center;
                    max-width: 400px;
                `;
                
                errorDiv.innerHTML = `
                    <h3 style="margin-bottom: 1rem;">âš ï¸ ì‹œìŠ¤í…œ ì˜¤ë¥˜</h3>
                    <p style="margin-bottom: 1.5rem; line-height: 1.4;">${message}</p>
                    <button onclick="location.reload()" style="
                        background: #dc2626; 
                        color: white; 
                        border: none; 
                        padding: 0.75rem 1.5rem; 
                        border-radius: 6px; 
                        cursor: pointer;
                        font-size: 0.9rem;
                    ">
                        í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                    </button>
                `;
                
                document.body.appendChild(errorDiv);
            }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // ì „ì—­ í•¨ìˆ˜ë“¤
        function switchMode(mode) {
            // í˜„ì¬ í™œì„±í™”ëœ ì„¹ì…˜ë“¤ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.mode-selection, .ai-analysis, .customer-management, .results-container').forEach(section => {
                section.classList.remove('active');
            });
            
            // í—¤ë” ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.header-btn').forEach(btn => btn.classList.remove('active'));
            
            // ëª¨ë“œ ì¹´ë“œ ì„ íƒ ìƒíƒœ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.mode-card').forEach(card => card.classList.remove('selected'));
            
            switch (mode) {
                case 'selection':
                    document.querySelector('.mode-selection').classList.add('active');
                    break;
                    
                case 'photo':
                    document.querySelector('.ai-analysis').classList.add('active');
                    document.getElementById('photo-analysis-btn').classList.add('active');
                    document.querySelector('[data-mode="photo"]').classList.add('selected');
                    break;
                    
                case 'draping':
                    initializeDrapingMode();
                    document.getElementById('draping-mode-btn').classList.add('active');
                    document.querySelector('[data-mode="draping"]').classList.add('selected');
                    break;
                    
                case 'hybrid':
                    document.querySelector('.ai-analysis').classList.add('active');
                    document.querySelector('[data-mode="hybrid"]').classList.add('selected');
                    setTimeout(() => showMockResults('hybrid'), 2000);
                    break;
                    
                case 'customer':
                    document.querySelector('.customer-management').classList.add('active');
                    document.getElementById('customer-management-btn').classList.add('active');
                    break;
            }
            
            window.PersonalColorAI.currentMode = mode;
            console.log(`ëª¨ë“œ ì „í™˜: ${mode}`);
        }

        async function startCamera() {
            try {
                showToast('ì¹´ë©”ë¼ë¥¼ ì‹œì‘í•˜ëŠ” ì¤‘...', 'info');
                
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        width: { ideal: 1280 }, 
                        height: { ideal: 720 },
                        facingMode: 'user'
                    } 
                });
                
                const video = document.getElementById('camera-preview');
                const overlay = document.getElementById('camera-overlay');
                const captureBtn = document.getElementById('capture-photo-btn');
                
                if (video) {
                    video.srcObject = stream;
                    video.onloadedmetadata = () => {
                        video.play();
                        if (overlay) overlay.style.display = 'none';
                        if (captureBtn) captureBtn.disabled = false;
                        showToast('ì¹´ë©”ë¼ê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                    };
                }
                
            } catch (error) {
                console.error('ì¹´ë©”ë¼ ì‹œì‘ ì‹¤íŒ¨:', error);
                showToast('ì¹´ë©”ë¼ ì ‘ê·¼ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.', 'error');
            }
        }

        async function captureAndAnalyze() {
            const video = document.getElementById('camera-preview');
            const canvas = document.getElementById('analysis-canvas');
            
            if (!video || !canvas || !video.srcObject) {
                showToast('ì¹´ë©”ë¼ê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            try {
                showAnalysisProgress();
                
                // ìº”ë²„ìŠ¤ì— í˜„ì¬ í”„ë ˆì„ ìº¡ì²˜
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(video, 0, 0);
                
                // AI ë¶„ì„ ìˆ˜í–‰
                const result = await performAIAnalysis(video);
                showAnalysisResults(result);
                
            } catch (error) {
                console.error('ë¶„ì„ ì‹¤íŒ¨:', error);
                hideAnalysisProgress();
                showToast('AI ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                showToast('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = async (e) => {
                try {
                    const img = new Image();
                    img.onload = async () => {
                        showAnalysisProgress();
                        
                        // ì´ë¯¸ì§€ë¡œ ë¶„ì„ ìˆ˜í–‰
                        const result = await performAIAnalysis(img);
                        showAnalysisResults(result);
                    };
                    img.src = e.target.result;
                    
                } catch (error) {
                    console.error('íŒŒì¼ ë¶„ì„ ì‹¤íŒ¨:', error);
                    hideAnalysisProgress();
                    showToast('íŒŒì¼ ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            };
            
            reader.readAsDataURL(file);
        }

        async function performAIAnalysis(imageSource) {
            const analyzer = window.PersonalColorAI.ai.skinAnalyzer;
            if (!analyzer) {
                throw new Error('AI ë¶„ì„ ì‹œìŠ¤í…œì´ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
            }
            
            const startTime = performance.now();
            
            updateAnalysisProgress(20, 'ì–¼êµ´ ê°ì§€ ì¤‘...');
            await delay(500);
            
            updateAnalysisProgress(40, 'í”¼ë¶€í†¤ ì¶”ì¶œ ì¤‘...');
            const analysisResult = await analyzer.detectFaceAndAnalyzeSkin(imageSource);
            
            updateAnalysisProgress(70, 'Delta E 2000 ê³„ì‚° ì¤‘...');
            await delay(300);
            
            updateAnalysisProgress(90, 'ê²°ê³¼ êµ¬ì„± ì¤‘...');
            const processingTime = ((performance.now() - startTime) / 1000).toFixed(1);
            
            updateAnalysisProgress(100, 'ë¶„ì„ ì™„ë£Œ!');
            
            window.PersonalColorAI.performance.totalAnalyses++;
            
            return {
                ...analysisResult,
                totalProcessingTime: processingTime,
                timestamp: new Date().toISOString()
            };
        }

        function showAnalysisProgress() {
            const progressContainer = document.getElementById('analysis-progress');
            if (progressContainer) {
                progressContainer.classList.add('active');
            }
        }

        function hideAnalysisProgress() {
            const progressContainer = document.getElementById('analysis-progress');
            if (progressContainer) {
                progressContainer.classList.remove('active');
            }
        }

        function updateAnalysisProgress(percentage, step) {
            const progressFill = document.getElementById('progress-fill');
            const stepElement = document.getElementById('progress-step');
            
            if (progressFill) {
                progressFill.style.width = percentage + '%';
            }
            
            if (stepElement && step) {
                stepElement.textContent = step;
            }
        }

        function showAnalysisResults(analysisResult) {
            hideAnalysisProgress();
            
            // ê²°ê³¼ ë°ì´í„° ì €ì¥
            window.PersonalColorAI.currentDiagnosis = analysisResult;
            
            // ê²°ê³¼ í™”ë©´ì— ë°ì´í„° í‘œì‹œ
            const elements = {
                'season-name': analysisResult.skinAnalysis?.season?.seasonName || 'ë¯¸í™•ì¸',
                'confidence-score': `ì‹ ë¢°ë„: ${analysisResult.skinAnalysis?.confidence || 0}%`,
                'undertone-result': getUndertoneText(analysisResult.skinAnalysis?.undertone),
                'brightness-result': analysisResult.skinAnalysis?.brightness?.description || 'ë¯¸í™•ì¸',
                'saturation-result': analysisResult.skinAnalysis?.saturation?.description || 'ë¯¸í™•ì¸',
                'delta-e-result': analysisResult.skinAnalysis?.season?.deltaE || 'ë¯¸ê³„ì‚°',
                'analysis-time': `${analysisResult.totalProcessingTime}ì´ˆ`
            };
            
            Object.keys(elements).forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = elements[id];
                }
            });
            
            // ì¶”ì²œ ì»¬ëŸ¬ íŒ”ë ˆíŠ¸ ìƒì„±
            generateColorPalette(analysisResult.skinAnalysis?.season?.season);
            
            // ìŠ¤íƒ€ì¼ë§ ê°€ì´ë“œ ìƒì„±
            generateStylingRecommendations(analysisResult.skinAnalysis);
            
            // ë¸Œëœë“œ ì¶”ì²œ ìƒì„±
            generateBrandRecommendations(analysisResult.skinAnalysis?.season?.season);
            
            // ê²°ê³¼ í™”ë©´ í‘œì‹œ
            document.querySelector('.ai-analysis').classList.remove('active');
            document.querySelector('.results-container').classList.add('active');
            
            showToast('AI ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success', 4000, 'ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”.');
        }

        function getUndertoneText(undertone) {
            if (!undertone) return 'ë¯¸í™•ì¸';
            
            const texts = {
                'warm': 'ì›œí†¤ (ë”°ëœ»í•œ í†¤)',
                'cool': 'ì¿¨í†¤ (ì°¨ê°€ìš´ í†¤)',
                'neutral': 'ë‰´íŠ¸ëŸ´ (ì¤‘ì„± í†¤)'
            };
            
            return texts[undertone.type] || undertone.type;
        }

        function generateColorPalette(season) {
            const container = document.getElementById('recommended-colors');
            if (!container || !season) return;
            
            const seasonData = window.PersonalColorAI.colorDatabase.seasons[season];
            if (!seasonData) return;
            
            container.innerHTML = '';
            seasonData.colors.forEach(color => {
                const colorDiv = document.createElement('div');
                colorDiv.className = 'palette-color';
                colorDiv.style.backgroundColor = color;
                colorDiv.title = color;
                container.appendChild(colorDiv);
            });
        }

        function generateStylingRecommendations(skinAnalysis) {
            const container = document.getElementById('styling-recommendations');
            if (!container || !skinAnalysis) return;
            
            const recommendations = [];
            const season = skinAnalysis.season?.season;
            const undertone = skinAnalysis.undertone?.type;
            const brightness = skinAnalysis.brightness?.level;
            
            if (season) {
                const seasonData = window.PersonalColorAI.colorDatabase.seasons[season];
                if (seasonData) {
                    recommendations.push(`${seasonData.name} íƒ€ì…ìœ¼ë¡œ ${seasonData.characteristics.join(', ')} ìƒ‰ìƒì´ ì˜ ì–´ìš¸ë¦½ë‹ˆë‹¤.`);
                }
            }
            
            if (undertone === 'warm') {
                recommendations.push('ë”°ëœ»í•œ í†¤ì˜ ë©”ì´í¬ì—…ê³¼ í—¤ì–´ ì»¬ëŸ¬ë¥¼ ì„ íƒí•˜ì„¸ìš”.');
                recommendations.push('ê³¨ë“œ, ë¸Œë¡ ì¦ˆ í†¤ì˜ ì•¡ì„¸ì„œë¦¬ê°€ ì˜ ì–´ìš¸ë¦½ë‹ˆë‹¤.');
            } else if (undertone === 'cool') {
                recommendations.push('ì°¨ê°€ìš´ í†¤ì˜ ë©”ì´í¬ì—…ê³¼ í—¤ì–´ ì»¬ëŸ¬ë¥¼ ì„ íƒí•˜ì„¸ìš”.');
                recommendations.push('ì‹¤ë²„, í”Œë˜í‹°ë„˜ í†¤ì˜ ì•¡ì„¸ì„œë¦¬ê°€ ì˜ ì–´ìš¸ë¦½ë‹ˆë‹¤.');
            }
            
            if (brightness === 'light') {
                recommendations.push('ë°ê³  í™”ì‚¬í•œ ìƒ‰ìƒìœ¼ë¡œ ìƒê¸°ìˆëŠ” ì´ë¯¸ì§€ë¥¼ ì—°ì¶œí•˜ì„¸ìš”.');
            } else if (brightness === 'deep') {
                recommendations.push('ì§„í•˜ê³  ê¹Šì€ ìƒ‰ìƒìœ¼ë¡œ ì„¸ë ¨ëœ ì´ë¯¸ì§€ë¥¼ ì—°ì¶œí•˜ì„¸ìš”.');
            }
            
            container.innerHTML = '';
            recommendations.forEach(rec => {
                const li = document.createElement('li');
                li.className = 'recommendation-item';
                li.textContent = rec;
                container.appendChild(li);
            });
        }

        function generateBrandRecommendations(season) {
            const container = document.getElementById('brand-recommendations');
            if (!container || !season) return;
            
            const brands = window.PersonalColorAI.colorDatabase.brands;
            container.innerHTML = '';
            
            // í—¤ì–´ ì»¬ëŸ¬ ì¶”ì²œ
            if (brands.hair) {
                Object.keys(brands.hair).forEach(brand => {
                    const products = brands.hair[brand];
                    const randomProduct = products[Math.floor(Math.random() * products.length)];
                    
                    const brandDiv = document.createElement('div');
                    brandDiv.className = 'brand-item';
                    brandDiv.innerHTML = `
                        <span class="brand-name">${brand}</span>
                        <span class="product-code">${randomProduct}</span>
                    `;
                    container.appendChild(brandDiv);
                });
            }
        }

        function showMockResults(mode) {
            const mockResults = {
                hybrid: {
                    season: 'autumn',
                    seasonName: 'ê°€ì„ (Autumn)',
                    confidence: 96,
                    undertone: 'warm',
                    brightness: 'medium',
                    saturation: 'soft',
                    deltaE: 2.8,
                    processingTime: 3.2
                }
            };
            
            const result = mockResults[mode];
            if (!result) return;
            
            showToast(`${mode} ëª¨ë“œ ë¶„ì„ ì¤‘...`, 'info');
            
            setTimeout(() => {
                const elements = {
                    'season-name': result.seasonName,
                    'confidence-score': `ì‹ ë¢°ë„: ${result.confidence}%`,
                    'undertone-result': result.undertone === 'warm' ? 'ì›œí†¤ (ë”°ëœ»í•œ í†¤)' : 'ì¿¨í†¤ (ì°¨ê°€ìš´ í†¤)',
                    'brightness-result': result.brightness === 'medium' ? 'ì¤‘ê°„ í†¤' : 'ë°ì€ í†¤',
                    'saturation-result': result.saturation === 'soft' ? 'ë¶€ë“œëŸ¬ìš´ í†¤' : 'ì„ ëª…í•œ í†¤',
                    'delta-e-result': result.deltaE.toString(),
                    'analysis-time': `${result.processingTime}ì´ˆ`
                };
                
                Object.keys(elements).forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.textContent = elements[id];
                    }
                });
                
                generateColorPalette(result.season);
                generateStylingRecommendations({
                    season: { season: result.season },
                    undertone: { type: result.undertone },
                    brightness: { level: result.brightness }
                });
                generateBrandRecommendations(result.season);
                
                document.querySelector('.ai-analysis').classList.remove('active');
                document.querySelector('.results-container').classList.add('active');
                
                showToast(`${mode} ëª¨ë“œ ë¶„ì„ ì™„ë£Œ!`, 'success');
            }, 2000);
        }

        function resetAnalysis() {
            // ì¹´ë©”ë¼ ìŠ¤íŠ¸ë¦¼ ì •ì§€
            const video = document.getElementById('camera-preview');
            if (video && video.srcObject) {
                video.srcObject.getTracks().forEach(track => track.stop());
                video.srcObject = null;
            }
            
            // UI ì´ˆê¸°í™”
            const overlay = document.getElementById('camera-overlay');
            const captureBtn = document.getElementById('capture-photo-btn');
            const faceOverlay = document.getElementById('face-detection-overlay');
            
            if (overlay) overlay.style.display = 'flex';
            if (captureBtn) captureBtn.disabled = true;
            if (faceOverlay) faceOverlay.innerHTML = '';
            
            hideAnalysisProgress();
            
            showToast('ë¶„ì„ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
        }

        async function initializeDrapingMode() {
            try {
                showToast('ë“œë˜ì´í•‘ ëª¨ë“œë¥¼ ì‹œì‘í•˜ëŠ” ì¤‘...', 'info');
                
                const drapingEngine = new VirtualDrapingEngine();
                await drapingEngine.initialize();
                
                window.PersonalColorAI.draping.engine = drapingEngine;
                
                document.getElementById('draping-fullscreen').classList.add('active');
                
                showToast('ë“œë˜ì´í•‘ ëª¨ë“œê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                
            } catch (error) {
                console.error('ë“œë˜ì´í•‘ ëª¨ë“œ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                showToast('ë“œë˜ì´í•‘ ëª¨ë“œ ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        function captureDraping() {
            const engine = window.PersonalColorAI.draping.engine;
            if (!engine) {
                showToast('ë“œë˜ì´í•‘ ì—”ì§„ì´ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            try {
                const capturedImage = engine.capture();
                if (capturedImage) {
                    showToast('ë“œë˜ì´í•‘ ê²°ê³¼ê°€ ìº¡ì²˜ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                    // ìº¡ì²˜ëœ ì´ë¯¸ì§€ë¡œ ì¶”ê°€ ì²˜ë¦¬ ê°€ëŠ¥
                }
            } catch (error) {
                console.error('ìº¡ì²˜ ì‹¤íŒ¨:', error);
                showToast('ìº¡ì²˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        function resetDraping() {
            const engine = window.PersonalColorAI.draping.engine;
            if (engine) {
                engine.reset();
                showToast('ë“œë˜ì´í•‘ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
            }
        }

        function closeDraping() {
            const engine = window.PersonalColorAI.draping.engine;
            if (engine) {
                engine.destroy();
                window.PersonalColorAI.draping.engine = null;
            }
            
            document.getElementById('draping-fullscreen').classList.remove('active');
            switchMode('selection');
        }

        function saveCustomer() {
            const customerData = {
                name: document.getElementById('customer-name')?.value || '',
                phone: document.getElementById('customer-phone')?.value || '',
                age: document.getElementById('customer-age')?.value || '',
                gender: document.getElementById('customer-gender')?.value || '',
                visitPurpose: document.getElementById('visit-purpose')?.value || '',
                notes: document.getElementById('customer-notes')?.value || ''
            };
            
            if (!customerData.name.trim()) {
                showToast('ê³ ê° ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            try {
                const customerManager = window.PersonalColorAI.customerManager;
                const customer = customerManager.addCustomer(customerData);
                
                window.PersonalColorAI.currentCustomer = customer;
                customerManager.displayCustomerHistory();
                
                showToast(`${customer.name}ë‹˜ ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');
                
            } catch (error) {
                console.error('ê³ ê° ì €ì¥ ì‹¤íŒ¨:', error);
                showToast('ê³ ê° ì •ë³´ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        function loadCustomerDialog() {
            const customerManager = window.PersonalColorAI.customerManager;
            const customers = customerManager.getCustomerHistory(50);
            
            if (customers.length === 0) {
                showToast('ì €ì¥ëœ ê³ ê° ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.', 'info');
                return;
            }
            
            const customerList = customers.map(c => `${c.name} (${new Date(c.createdAt).toLocaleDateString()})`);
            const selected = prompt(`ë¶ˆëŸ¬ì˜¬ ê³ ê°ì„ ì„ íƒí•˜ì„¸ìš”:\n\n${customerList.map((name, index) => `${index + 1}. ${name}`).join('\n')}\n\në²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:`);
            
            if (selected && !isNaN(selected)) {
                const index = parseInt(selected) - 1;
                if (index >= 0 && index < customers.length) {
                    loadCustomer(customers[index].id);
                }
            }
        }

        function loadCustomer(customerId) {
            const customerManager = window.PersonalColorAI.customerManager;
            const customer = customerManager.customers.find(c => c.id === customerId);
            
            if (!customer) {
                showToast('ê³ ê° ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            // í¼ì— ê³ ê° ì •ë³´ ì±„ìš°ê¸°
            const fields = {
                'customer-name': customer.name,
                'customer-phone': customer.phone || '',
                'customer-age': customer.age || '',
                'customer-gender': customer.gender || '',
                'visit-purpose': customer.visitPurpose || '',
                'customer-notes': customer.notes || ''
            };
            
            Object.keys(fields).forEach(fieldId => {
                const element = document.getElementById(fieldId);
                if (element) {
                    element.value = fields[fieldId];
                }
            });
            
            window.PersonalColorAI.currentCustomer = customer;
            
            showToast(`${customer.name}ë‹˜ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`, 'success');
        }

        function clearCustomerForm() {
            const fields = ['customer-name', 'customer-phone', 'customer-age', 'customer-gender', 'visit-purpose', 'customer-notes'];
            
            fields.forEach(fieldId => {
                const element = document.getElementById(fieldId);
                if (element) {
                    element.value = '';
                }
            });
            
            window.PersonalColorAI.currentCustomer = null;
            
            showToast('ê³ ê° ì •ë³´ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
        }

        function exportCustomers() {
            const customerManager = window.PersonalColorAI.customerManager;
            try {
                customerManager.exportCustomerData();
                showToast('ê³ ê° ë°ì´í„°ê°€ ë‚´ë³´ë‚´ì¡ŒìŠµë‹ˆë‹¤!', 'success');
            } catch (error) {
                console.error('ê³ ê° ë°ì´í„° ë‚´ë³´ë‚´ê¸° ì‹¤íŒ¨:', error);
                showToast('ë°ì´í„° ë‚´ë³´ë‚´ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        async function generatePDFReport() {
            const diagnosis = window.PersonalColorAI.currentDiagnosis;
            const customer = window.PersonalColorAI.currentCustomer;
            
            if (!diagnosis) {
                showToast('ìƒì„±í•  ì§„ë‹¨ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            try {
                showToast('PDF ë³´ê³ ì„œë¥¼ ìƒì„±í•˜ëŠ” ì¤‘...', 'info');
                
                const pdfGenerator = window.PersonalColorAI.pdfGenerator;
                await pdfGenerator.generateReport(diagnosis.skinAnalysis, customer);
                
            } catch (error) {
                console.error('PDF ìƒì„± ì‹¤íŒ¨:', error);
                showToast('PDF ë³´ê³ ì„œ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        function saveDiagnosisToCustomer() {
            const diagnosis = window.PersonalColorAI.currentDiagnosis;
            const customer = window.PersonalColorAI.currentCustomer;
            
            if (!diagnosis) {
                showToast('ì €ì¥í•  ì§„ë‹¨ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            if (!customer) {
                showToast('ê³ ê° ì •ë³´ê°€ í•„ìš”í•©ë‹ˆë‹¤. ë¨¼ì € ê³ ê° ì •ë³´ë¥¼ ì €ì¥í•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }
            
            try {
                const customerManager = window.PersonalColorAI.customerManager;
                customerManager.addDiagnosisToCustomer(customer.id, diagnosis.skinAnalysis);
                customerManager.displayCustomerHistory();
                
                showToast(`${customer.name}ë‹˜ì—ê²Œ ì§„ë‹¨ ê²°ê³¼ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');
                
            } catch (error) {
                console.error('ì§„ë‹¨ ê²°ê³¼ ì €ì¥ ì‹¤íŒ¨:', error);
                showToast('ì§„ë‹¨ ê²°ê³¼ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        function shareResult() {
            const diagnosis = window.PersonalColorAI.currentDiagnosis;
            if (!diagnosis) {
                showToast('ê³µìœ í•  ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            const shareText = `í¼ìŠ¤ë„ì»¬ëŸ¬ ì§„ë‹¨ ê²°ê³¼\n\nê³„ì ˆ: ${diagnosis.skinAnalysis?.season?.seasonName || 'ë¯¸í™•ì¸'}\nì‹ ë¢°ë„: ${diagnosis.skinAnalysis?.confidence || 0}%\nì–¸ë”í†¤: ${getUndertoneText(diagnosis.skinAnalysis?.undertone)}\n\nPersonal Color AI Proë¡œ ë¶„ì„ë¨`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'í¼ìŠ¤ë„ì»¬ëŸ¬ ì§„ë‹¨ ê²°ê³¼',
                    text: shareText
                }).then(() => {
                    showToast('ê²°ê³¼ê°€ ê³µìœ ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                }).catch((error) => {
                    console.log('ê³µìœ  ì·¨ì†Œë¨:', error);
                });
            } else {
                // í´ë¦½ë³´ë“œ ë³µì‚¬
                navigator.clipboard.writeText(shareText).then(() => {
                    showToast('ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                }).catch(() => {
                    showToast('í´ë¦½ë³´ë“œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                });
            }
        }

        function showSystemStatus() {
            const ai = window.PersonalColorAI.ai;
            const perf = window.PersonalColorAI.performance;
            const draping = window.PersonalColorAI.draping;
            
            let status = '=== Personal Color AI Pro ì‹œìŠ¤í…œ ìƒíƒœ ===\n\n';
            status += `ë²„ì „: ${window.PersonalColorAI.version}\n`;
            status += `ë¡œë”© ì‹œê°„: ${((Date.now() - window.PersonalColorAI.startTime) / 1000).toFixed(1)}ì´ˆ ì „ ì‹œì‘\n\n`;
            
            status += '=== AI ì‹œìŠ¤í…œ ===\n';
            status += `Delta E 2000 ì—”ì§„: ${ai.deltaE ? 'âœ… í™œì„±' : 'âŒ ë¹„í™œì„±'}\n`;
            status += `í”¼ë¶€í†¤ ë¶„ì„ê¸°: ${ai.skinAnalyzer ? 'âœ… í™œì„±' : 'âŒ ë¹„í™œì„±'}\n`;
            status += `TensorFlow.js: ${ai.tensorflow ? 'âœ… ì¤€ë¹„ë¨' : 'âŒ ë¯¸ì¤€ë¹„'}\n`;
            status += `ë“œë˜ì´í•‘ ì—”ì§„: ${draping.engine ? 'âœ… í™œì„±' : 'âŒ ë¹„í™œì„±'}\n\n`;
            
            status += '=== ì„±ëŠ¥ í†µê³„ ===\n';
            status += `ì´ ë¶„ì„ íšŸìˆ˜: ${perf.totalAnalyses}íšŒ\n`;
            status += `Delta E ê³„ì‚°: ${perf.deltaECalculations}íšŒ\n`;
            status += `ì´ ì²˜ë¦¬ ì‹œê°„: ${(perf.processingTime / 1000).toFixed(1)}ì´ˆ\n`;
            status += `ì„œë¹„ìŠ¤í•œ ê³ ê° ìˆ˜: ${perf.customersServed}ëª…\n\n`;
            
            if (ai.deltaE) {
                const deltaStats = ai.deltaE.getPerformanceStats();
                status += '=== Delta E 2000 ìƒì„¸ ===\n';
                status += `ìºì‹œ ì ì¤‘ë¥ : ${deltaStats.hitRate}%\n`;
                status += `ìºì‹œ í¬ê¸°: ${deltaStats.cacheSize}ê°œ\n`;
            }
            
            alert(status);
        }

        function exportAllData() {
            try {
                const data = {
                    exportDate: new Date().toISOString(),
                    version: window.PersonalColorAI.version,
                    performance: window.PersonalColorAI.performance,
                    customers: window.PersonalColorAI.customerManager?.customers || [],
                    systemInfo: {
                        userAgent: navigator.userAgent,
                        platform: navigator.platform,
                        language: navigator.language
                    }
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `personal_color_ai_export_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                showToast('ëª¨ë“  ë°ì´í„°ê°€ ë‚´ë³´ë‚´ì¡ŒìŠµë‹ˆë‹¤!', 'success');
                
            } catch (error) {
                console.error('ë°ì´í„° ë‚´ë³´ë‚´ê¸° ì‹¤íŒ¨:', error);
                showToast('ë°ì´í„° ë‚´ë³´ë‚´ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // ì•± ì‹œì‘ (ë¡œë”© ì‹œê°„ ë‹¨ì¶• ë° ì˜¤ë¥˜ ë°©ì§€)
        let appInitializer;
        
        window.addEventListener('load', () => {
            console.log('DOM ë¡œë“œ ì™„ë£Œ - Personal Color AI Pro ì‹œì‘');
            
            // ë¡œë”© ì‹œê°„ì„ 3ì´ˆë¡œ ë‹¨ì¶•í•˜ê³  ì˜¤ë¥˜ ì‹œ ìë™ ìŠ¤í‚µ
            const initTimeout = setTimeout(() => {
                console.warn('ì´ˆê¸°í™” íƒ€ì„ì•„ì›ƒ - ê°•ì œ ë¡œë”© ì™„ë£Œ');
                forceCompleteLoading();
            }, 8000);
            
            try {
                appInitializer = new AppInitializer();
                appInitializer.initialize().then(() => {
                    clearTimeout(initTimeout);
                }).catch((error) => {
                    console.error('ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                    clearTimeout(initTimeout);
                    forceCompleteLoading();
                });
            } catch (error) {
                console.error('ì•± ì‹œì‘ ì‹¤íŒ¨:', error);
                clearTimeout(initTimeout);
                forceCompleteLoading();
            }
            
            setTimeout(() => {
                if (!window.PersonalColorAI.isLoaded) {
                    console.log('ìë™ ë¡œë”© ìŠ¤í‚µ ì‹¤í–‰');
                    forceCompleteLoading();
                }
            }, 5000);
        });

        // ê°•ì œ ë¡œë”© ì™„ë£Œ í•¨ìˆ˜
        function forceCompleteLoading() {
            try {
                // ê¸°ë³¸ ì‹œìŠ¤í…œ ì´ˆê¸°í™”
                if (!window.PersonalColorAI.ai.deltaE) {
                    window.PersonalColorAI.ai.deltaE = new DeltaE2000Engine();
                }
                
                if (!window.PersonalColorAI.customerManager) {
                    window.PersonalColorAI.customerManager = new CustomerManager();
                    window.PersonalColorAI.customerManager.updateCustomerCount();
                }
                
                if (!window.PersonalColorAI.pdfGenerator) {
                    window.PersonalColorAI.pdfGenerator = new PDFReportGenerator();
                }
                
                // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
                setupEventListenersForce();
                
                // UI í‘œì‹œ
                const loadingScreen = document.getElementById('loading-screen');
                const mainApp = document.getElementById('main-app');
                
                if (loadingScreen) {
                    loadingScreen.style.display = 'none';
                }
                
                if (mainApp) {
                    mainApp.style.display = 'block';
                    mainApp.classList.add('loaded');
                }
                
                window.PersonalColorAI.isLoaded = true;
                
                // ì‹œìŠ¤í…œ ìƒíƒœ ì—…ë°ì´íŠ¸
                const aiStatus = document.getElementById('ai-status');
                const deltaeStatus = document.getElementById('deltae-status');
                
                if (aiStatus) aiStatus.textContent = 'ì¤€ë¹„ë¨';
                if (deltaeStatus) deltaeStatus.textContent = 'í™œì„±';
                
                showToast('Personal Color AI Pro ì‹œìŠ¤í…œì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success', 4000);
                
                console.log('ê°•ì œ ë¡œë”© ì™„ë£Œ');
                
            } catch (error) {
                console.error('ê°•ì œ ë¡œë”© ì‹¤íŒ¨:', error);
                alert('ì‹œìŠ¤í…œ ë¡œë”©ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
            }
        }

        // ê°„ì†Œí™”ëœ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        function setupEventListenersForce() {
            try {
                // ì•ˆì „í•œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                const addSafeListener = (id, event, handler) => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.addEventListener(event, handler);
                    }
                };
                
                // í•µì‹¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤ë§Œ ì„¤ì •
                addSafeListener('photo-analysis-btn', 'click', () => switchMode('photo'));
                addSafeListener('draping-mode-btn', 'click', () => switchMode('draping'));
                addSafeListener('customer-management-btn', 'click', () => switchMode('customer'));
                addSafeListener('system-status-btn', 'click', showSystemStatus);
                
                // ëª¨ë“œ ì¹´ë“œ ì´ë²¤íŠ¸
                document.querySelectorAll('.mode-card').forEach(card => {
                    const mode = card.getAttribute('data-mode');
                    if (mode) {
                        card.addEventListener('click', () => switchMode(mode));
                    }
                });
                
                console.log('ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì™„ë£Œ (ê°•ì œ)');
                
            } catch (error) {
                console.warn('ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì¤‘ ì¼ë¶€ ì˜¤ë¥˜:', error);
            }
        }

        // ì „ì—­ ì˜¤ë¥˜ ì²˜ë¦¬
        window.addEventListener('error', (event) => {
            console.error('ì „ì—­ ì˜¤ë¥˜ ë°œìƒ:', event.error);
            showToast('ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
        });

        window.addEventListener('unhandledrejection', (event) => {
            console.error('ì²˜ë¦¬ë˜ì§€ ì•Šì€ Promise ê±°ë¶€:', event.reason);
            showToast('ë¹„ë™ê¸° ì‘ì—… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
        });

        // ê°œë°œì ë„êµ¬ìš© ë””ë²„ê·¸ í•¨ìˆ˜ë“¤
        window.debugPersonalColorAI = {
            getSystemInfo: () => window.PersonalColorAI,
            testDeltaE: () => {
                const deltaE = window.PersonalColorAI.ai.deltaE;
                if (deltaE) {
                    const lab1 = { L: 50, a: 10, b: 20 };
                    const lab2 = { L: 60, a: 15, b: 25 };
                    const result = deltaE.calculateDeltaE2000(lab1, lab2);
                    console.log(`Delta E 2000 í…ŒìŠ¤íŠ¸ ê²°ê³¼: ${result}`);
                    return result;
                }
                return 'Delta E ì—”ì§„ì´ ì´ˆê¸°í™”ë˜ì§€ ì•ŠìŒ';
            },
            simulateAnalysis: () => {
                showMockResults('hybrid');
            },
            skipLoading: () => {
                const loadingScreen = document.getElementById('loading-screen');
                const mainApp = document.getElementById('main-app');
                if (loadingScreen) loadingScreen.style.display = 'none';
                if (mainApp) {
                    mainApp.style.display = 'block';
                    mainApp.classList.add('loaded');
                }
                window.PersonalColorAI.isLoaded = true;
                showToast('ë¡œë”© ê±´ë„ˆë›°ê¸° ì™„ë£Œ', 'info');
            },
            exportSystemLog: () => {
                const logs = {
                    timestamp: new Date().toISOString(),
                    systemInfo: window.PersonalColorAI,
                    userAgent: navigator.userAgent,
                    performance: performance.getEntriesByType('navigation')
                };
                
                console.log('ì‹œìŠ¤í…œ ë¡œê·¸:', logs);
                return logs;
            }
        };

        console.log('Personal Color AI Pro ì™„ì „ ë¡œë”© ì™„ë£Œ!');
        console.log('í—¤ì–´ìƒµ ì „ìš© ì™„ì „í•œ í¼ìŠ¤ë„ì»¬ëŸ¬ ì§„ë‹¨ ì‹œìŠ¤í…œ');
        console.log('- ì‹¤ì œ Delta E 2000 ê³µì‹ ì‚¬ìš©');
        console.log('- ì™„ì „í•œ ì–¼êµ´ ê°ì§€ ë° í”¼ë¶€í†¤ ë¶„ì„');
        console.log('- ì‹¤ì‹œê°„ ê°€ìƒ ë“œë˜ì´í•‘');
        console.log('- ê³ ê° ê´€ë¦¬ ì‹œìŠ¤í…œ');
        console.log('- PDF ë³´ê³ ì„œ ìƒì„±');
        console.log('- ë¸Œëœë“œë³„ ì œí’ˆ ì¶”ì²œ');
        console.log('ë””ë²„ê·¸ í•¨ìˆ˜: window.debugPersonalColorAI ì‚¬ìš© ê°€ëŠ¥');
    </script>
</body>
</html><!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="cache-buster" content="2025-08-26-COMPLETE-PROFESSIONAL">
    
    <title>Personal Color AI Pro - í—¤ì–´ìƒµ ì „ìš© ì‹œìŠ¤í…œ</title>
    <meta name="description" content="í—¤ì–´ìƒµ ì „ìš© ì™„ì „í•œ í¼ìŠ¤ë„ì»¬ëŸ¬ ì§„ë‹¨ ì‹œìŠ¤í…œ - AI + Delta E 2000 + ê³ ê°ê´€ë¦¬">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tensorflow/4.10.0/tf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        :root {
            --primary: #e91e63;
            --primary-hover: #c2185b;
            --primary-light: #fce4ec;
            --primary-dark: #ad1457;
            --secondary: #ff69b4;
            --accent: #ff1744;
            
            --success: #4caf50;
            --warning: #ff9800;
            --error: #f44336;
            --info: #2196f3;
            
            --text: #2c2c2c;
            --text-light: #666666;
            --text-lighter: #999999;
            --bg: #ffffff;
            --bg-light: #fafafa;
            --bg-gray: #f5f5f5;
            --border: #e0e0e0;
            --border-light: #f0f0f0;
            
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 4px 20px rgba(0, 0, 0, 0.15);
            --shadow-xl: 0 8px 40px rgba(0, 0, 0, 0.2);
            
            --radius: 8px;
            --radius-lg: 12px;
            --font: -apple-system, BlinkMacSystemFont, "Noto Sans KR", sans-serif;
            
            --spring: #ff6b6b;
            --summer: #4ecdc4;
            --autumn: #d4af37;
            --winter: #2c3e50;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font);
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            min-height: 100vh;
            color: var(--text);
        }

        /* ë¡œë”© ìŠ¤í¬ë¦° ì œê±° - ë°”ë¡œ ë©”ì¸ ì•± í‘œì‹œ */
        .loading-screen {
            display: none !important;
        }

        /* ë©”ì¸ ì•± ë°”ë¡œ í‘œì‹œ */
        .main-app {
            display: block;
            min-height: 100vh;
            opacity: 1;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* í—¤ë” */
        .app-header {
            background: white;
            padding: 1rem 2rem;
            border-bottom: 2px solid var(--primary-light);
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .app-title {
            font-size: 1.6rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .app-subtitle {
            color: var(--text-light);
            font-size: 0.85rem;
            margin-top: 0.25rem;
        }

        .header-status {
            text-align: right;
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .status-item {
            margin: 0.2rem 0;
        }

        .status-active {
            color: var(--success);
            font-weight: 600;
        }

        .header-controls {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .header-btn {
            background: white;
            border: 1px solid var(--primary-light);
            color: var(--text);
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s ease;
        }

        .header-btn:hover {
            border-color: var(--primary);
            background: var(--primary-light);
        }

        .header-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* ë©”ì¸ ì½˜í…ì¸  */
        .main-content {
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* ëª¨ë“œ ì„ íƒ */
        .mode-selection {
            margin-bottom: 3rem;
        }

        .mode-selection h2 {
            font-size: 2rem;
            font-weight: 600;
            text-align: center;
            margin-bottom: 2rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .mode-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .mode-card {
            background: white;
            border: 2px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .mode-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .mode-card.selected {
            border-color: var(--primary);
            background: var(--primary-light);
            transform: translateY(-2px);
        }

        .mode-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .mode-card h3 {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text);
        }

        .mode-card p {
            color: var(--text-light);
            font-size: 0.9rem;
            line-height: 1.4;
            margin-bottom: 1rem;
        }

        .mode-accuracy {
            background: var(--success);
            color: white;
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 1rem;
        }

        .mode-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 0.6rem 1.5rem;
            border-radius: var(--radius);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 100%;
        }

        .mode-btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        /* AI ë¶„ì„ ì„¹ì…˜ */
        .ai-analysis {
            display: none;
            background: white;
            border-radius: var(--radius-lg);
            padding: 2rem;
            margin-bottom: 2rem;
            border: 2px solid var(--primary-light);
            box-shadow: var(--shadow);
        }

        .ai-analysis.active {
            display: block;
        }

        .analysis-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-light);
        }

        .analysis-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--text);
        }

        .analysis-mode-badge {
            background: var(--primary);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: var(--radius);
            font-size: 0.8rem;
            font-weight: 500;
        }

        .camera-section {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .camera-container {
            position: relative;
            background: var(--bg-gray);
            border-radius: var(--radius);
            overflow: hidden;
            aspect-ratio: 4/3;
        }

        .camera-preview {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1);
        }

        .camera-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 1.1rem;
        }

        .face-detection-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
        }

        .face-box {
            position: absolute;
            border: 2px solid var(--primary);
            background: rgba(233, 30, 99, 0.1);
        }

        .skin-region {
            position: absolute;
            border: 1px solid var(--secondary);
            background: rgba(255, 105, 180, 0.15);
            border-radius: 2px;
        }

        .analysis-canvas {
            display: none;
        }

        .camera-controls {
            background: var(--bg-light);
            padding: 1.5rem;
            border-radius: var(--radius);
            border: 1px solid var(--border-light);
        }

        .controls-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text);
        }

        .control-group {
            margin-bottom: 1rem;
        }

        .control-label {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-bottom: 0.5rem;
            display: block;
        }

        .primary-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: var(--radius);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 100%;
            margin-bottom: 0.5rem;
        }

        .primary-btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        .primary-btn:disabled {
            background: var(--text-lighter);
            cursor: not-allowed;
            transform: none;
        }

        .secondary-btn {
            background: white;
            color: var(--text);
            border: 1px solid var(--border);
            padding: 0.6rem 1.2rem;
            border-radius: var(--radius);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 100%;
            margin-bottom: 0.5rem;
        }

        .secondary-btn:hover {
            border-color: var(--primary);
            background: var(--primary-light);
        }

        .file-input {
            display: none;
        }

        /* ë¶„ì„ ì§„í–‰ ìƒíƒœ */
        .analysis-progress {
            display: none;
            background: linear-gradient(135deg, var(--primary-light), white);
            padding: 2rem;
            border-radius: var(--radius);
            text-align: center;
            margin: 2rem 0;
            border: 1px solid var(--primary-light);
        }

        .analysis-progress.active {
            display: block;
        }

        .progress-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--primary-dark);
        }

        .progress-bar {
            width: 100%;
            max-width: 400px;
            height: 8px;
            background: rgba(233, 30, 99, 0.2);
            border-radius: 4px;
            margin: 0 auto 1rem;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 4px;
            transition: width 0.5s ease;
            width: 0%;
        }

        .progress-step {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-top: 0.5rem;
        }

        /* ì‹¤ì‹œê°„ ë“œë˜ì´í•‘ */
        .draping-fullscreen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 1000;
            color: white;
        }

        .draping-fullscreen.active {
            display: flex;
            flex-direction: column;
        }

        .draping-header {
            height: 70px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
        }

        .draping-title {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .draping-controls {
            display: flex;
            gap: 0.5rem;
        }

        .draping-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s ease;
        }

        .draping-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .draping-content {
            flex: 1;
            display: flex;
        }

        .draping-video-area {
            flex: 2;
            position: relative;
            background: #000;
        }

        .draping-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1);
        }

        .virtual-fabric-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 10;
        }

        .virtual-fabric {
            position: absolute;
            border-radius: 15px;
            opacity: 0.8;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 2px solid var(--primary);
        }

        .draping-panel {
            flex: 1;
            background: rgba(0, 0, 0, 0.8);
            padding: 2rem;
            overflow-y: auto;
        }

        .panel-section {
            margin-bottom: 2rem;
        }

        .panel-section h4 {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: var(--primary-light);
        }

        .season-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .season-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 0.5rem;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .season-btn.active {
            background: var(--primary);
            border-color: var(--primary);
        }

        .color-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
        }

        .color-item {
            aspect-ratio: 1;
            border-radius: var(--radius);
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .color-item:hover,
        .color-item.selected {
            border-color: var(--primary);
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(233, 30, 99, 0.5);
        }

        .live-analysis {
            background: linear-gradient(135deg, rgba(233, 30, 99, 0.2), rgba(255, 255, 255, 0.05));
            border: 1px solid rgba(233, 30, 99, 0.4);
            border-radius: var(--radius);
            padding: 1.5rem;
            text-align: center;
        }

        .delta-display {
            margin-bottom: 1rem;
        }

        .delta-value {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
        }

        .delta-description {
            font-size: 1rem;
            font-weight: 500;
        }

        .delta-score {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-top: 1rem;
        }

        .score-gauge {
            flex: 1;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            overflow: hidden;
        }

        .score-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 3px;
            transition: width 0.6s ease;
        }

        .score-text {
            font-size: 0.9rem;
            font-weight: 600;
            min-width: 50px;
        }

        .recommendation-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.4rem 0.8rem;
            border-radius: var(--radius);
            font-size: 0.8rem;
            font-weight: 600;
            margin-top: 1rem;
        }

        .recommendation-badge.excellent {
            background: rgba(76, 175, 80, 0.2);
            color: #4caf50;
            border: 1px solid rgba(76, 175, 80, 0.5);
        }

        .recommendation-badge.good {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
            border: 1px solid rgba(255, 193, 7, 0.5);
        }

        .recommendation-badge.acceptable {
            background: rgba(255, 152, 0, 0.2);
            color: #ff9800;
            border: 1px solid rgba(255, 152, 0, 0.5);
        }

        .recommendation-badge.poor {
            background: rgba(244, 67, 54, 0.2);
            color: #f44336;
            border: 1px solid rgba(244, 67, 54, 0.5);
        }

        /* ê²°ê³¼ í‘œì‹œ */
        .results-container {
            display: none;
            background: white;
            border-radius: var(--radius-lg);
            padding: 2rem;
            margin-top: 2rem;
            border: 2px solid var(--primary-light);
            box-shadow: var(--shadow);
        }

        .results-container.active {
            display: block;
        }

        .results-header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--border-light);
        }

        .results-header h2 {
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text);
        }

        .season-badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1rem 2rem;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            box-shadow: var(--shadow);
        }

        .confidence-score {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .result-section {
            background: var(--bg-light);
            padding: 1.5rem;
            border-radius: var(--radius);
            border: 1px solid var(--border-light);
        }

        .result-section h3 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .detail-grid {
            display: grid;
            gap: 0.8rem;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border-light);
        }

        .detail-item:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .detail-value {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--primary-dark);
        }

        .color-palette {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .palette-color {
            aspect-ratio: 1;
            border-radius: var(--radius);
            border: 2px solid white;
            box-shadow: var(--shadow);
            position: relative;
            cursor: pointer;
        }

        .palette-color:hover::after {
            content: attr(title);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--text);
            color: white;
            padding: 0.3rem 0.5rem;
            border-radius: 4px;
            font-size: 0.7rem;
            white-space: nowrap;
            z-index: 10;
        }

        .recommendation-list {
            list-style: none;
        }

        .recommendation-item {
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border-light);
            font-size: 0.85rem;
            line-height: 1.4;
        }

        .recommendation-item:last-child {
            border-bottom: none;
        }

        .brand-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.4rem 0;
            font-size: 0.8rem;
        }

        .brand-name {
            font-weight: 600;
            color: var(--text);
        }

        .product-code {
            color: var(--text-light);
            font-family: monospace;
            font-size: 0.75rem;
        }

        .results-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border-light);
        }

        /* ê³ ê° ê´€ë¦¬ */
        .customer-management {
            display: none;
            background: white;
            border-radius: var(--radius-lg);
            padding: 2rem;
            margin-bottom: 2rem;
            border: 2px solid var(--primary-light);
            box-shadow: var(--shadow);
        }

        .customer-management.active {
            display: block;
        }

        .customer-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-label {
            font-size: 0.85rem;
            font-weight: 500;
            margin-bottom: 0.3rem;
            color: var(--text);
        }

        .form-input {
            padding: 0.6rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-size: 0.9rem;
            transition: border-color 0.2s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(233, 30, 99, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .customer-history {
            margin-top: 2rem;
        }

        .history-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }

        .history-table th,
        .history-table td {
            text-align: left;
            padding: 0.6rem;
            border-bottom: 1px solid var(--border-light);
        }

        .history-table th {
            background: var(--bg-light);
            font-weight: 600;
            color: var(--text);
        }

        /* í† ìŠ¤íŠ¸ ë©”ì‹œì§€ */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            pointer-events: none;
        }

        .toast {
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            margin-bottom: 0.5rem;
            padding: 1rem 1.5rem;
            pointer-events: auto;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            border-left: 4px solid var(--primary);
            max-width: 350px;
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            border-left-color: var(--success);
        }

        .toast.error {
            border-left-color: var(--error);
        }

        .toast.warning {
            border-left-color: var(--warning);
        }

        .toast.info {
            border-left-color: var(--info);
        }

        .toast-icon {
            font-size: 1.2rem;
        }

        .toast-content {
            flex: 1;
        }

        .toast-message {
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 0.2rem;
        }

        .toast-submessage {
            font-size: 0.75rem;
            color: var(--text-light);
        }

        .toast-close {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: var(--text-light);
            padding: 0.2rem;
        }

        .toast-close:hover {
            color: var(--text);
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 1024px) {
            .camera-section {
                grid-template-columns: 1fr;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 1rem;
            }
            
            .loading-logo h1 {
                font-size: 2rem;
            }
            
            .loading-progress-bar {
                width: 280px;
            }
            
            .header-top {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
            
            .header-controls {
                justify-content: center;
            }
            
            .mode-cards {
                grid-template-columns: 1fr;
            }
            
            .draping-content {
                flex-direction: column;
            }
            
            .draping-panel {
                height: 40vh;
                border-top: 1px solid var(--primary);
            }
            
            .results-actions {
                grid-template-columns: 1fr;
            }
        }

        /* ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤ */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .text-left {
            text-align: left;
        }

        .text-right {
            text-align: right;
        }

        .mb-0 {
            margin-bottom: 0 !important;
        }

        .mb-1 {
            margin-bottom: 0.5rem !important;
        }

        .mb-2 {
            margin-bottom: 1rem !important;
        }

        .mt-0 {
            margin-top: 0 !important;
        }

        .mt-1 {
            margin-top: 0.5rem !important;
        }

        .mt-2 {
            margin-top: 1rem !important;
        }
    </style>
</head>

<body>
    <!-- ë¡œë”© ìŠ¤í¬ë¦° -->
    <div class="loading-screen" id="loading-screen">
        <div class="loading-container">
            <div class="loading-logo">
                <h1>Personal Color AI Pro</h1>
                <p>í—¤ì–´ìƒµ ì „ìš© ì™„ì „í•œ í¼ìŠ¤ë„ì»¬ëŸ¬ ì§„ë‹¨ ì‹œìŠ¤í…œ</p>
            </div>
            
            <div class="loading-progress-bar">
                <div class="loading-progress" id="loading-progress"></div>
            </div>
            <div class="loading-message" id="loading-message">ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì¤‘...</div>
            
            <div class="loading-steps">
                <div class="loading-step" id="step-config">ì„¤ì • íŒŒì¼ ë¡œë“œ ì¤‘...</div>
                <div class="loading-step" id="step-tensorflow">TensorFlow.js ì´ˆê¸°í™” ì¤‘...</div>
                <div class="loading-step" id="step-deltae">Delta E 2000 ì—”ì§„ ë¡œë”© ì¤‘...</div>
                <div class="loading-step" id="step-skin">í”¼ë¶€í†¤ ë¶„ì„ ëª¨ë“ˆ ì¤€ë¹„ ì¤‘...</div>
                <div class="loading-step" id="step-face">ì–¼êµ´ ê°ì§€ ì‹œìŠ¤í…œ ë¡œë”© ì¤‘...</div>
                <div class="loading-step" id="step-database">ìƒ‰ìƒ ë°ì´í„°ë² ì´ìŠ¤ ë¡œë“œ ì¤‘...</div>
                <div class="loading-step" id="step-ui">ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ ì¤€ë¹„ ì¤‘...</div>
            </div>
        </div>
    </div>

    <!-- ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ -->
    <div class="main-app" id="main-app">
        <!-- í—¤ë” -->
        <header class="app-header">
            <div class="header-top">
                <div>
                    <h1 class="app-title">Personal Color AI Pro</h1>
                    <div class="app-subtitle">í—¤ì–´ìƒµ ì „ìš© ì™„ì „í•œ í¼ìŠ¤ë„ì»¬ëŸ¬ ì§„ë‹¨ ì‹œìŠ¤í…œ</div>
                </div>
                <div class="header-status">
                    <div class="status-item">AI ì—”ì§„: <span class="status-active" id="ai-status">ì¤€ë¹„ë¨</span></div>
                    <div class="status-item">Delta E 2000: <span class="status-active" id="deltae-status">í™œì„±</span></div>
                    <div class="status-item">ì²˜ë¦¬ëœ ê³ ê°: <span id="customer-count">0</span>ëª…</div>
                </div>
            </div>
            
            <div class="header-controls">
                <button class="header-btn" id="photo-analysis-btn">ì‚¬ì§„ ë¶„ì„</button>
                <button class="header-btn" id="draping-mode-btn">ë“œë˜ì´í•‘ ëª¨ë“œ</button>
                <button class="header-btn" id="customer-management-btn">ê³ ê° ê´€ë¦¬</button>
                <button class="header-btn" id="system-status-btn">ì‹œìŠ¤í…œ ìƒíƒœ</button>
                <button class="header-btn" id="export-data-btn">ë°ì´í„° ë‚´ë³´ë‚´ê¸°</button>
            </div>
        </header>

        <!-- ë©”ì¸ ì½˜í…ì¸  -->
        <main class="main-content">
            <!-- ëª¨ë“œ ì„ íƒ -->
            <section class="mode-selection" id="mode-selection">
                <h2>í¼ìŠ¤ë„ì»¬ëŸ¬ ì§„ë‹¨ ëª¨ë“œ ì„ íƒ</h2>
                <div class="mode-cards">
                    <div class="mode-card" data-mode="photo">
                        <div class="mode-icon">ğŸ“¸</div>
                        <h3>AI ì‚¬ì§„ ë¶„ì„</h3>
                        <p><strong>ì‚¬ì§„ìœ¼ë¡œ ì •í™•í•œ í”¼ë¶€í†¤ ë¶„ì„</strong><br>
                        ì‹¤ì œ ì–¼êµ´ ê°ì§€ + í”¼ë¶€ ì˜ì—­ ì¶”ì¶œ + Delta E ê³„ì‚°</p>
                        <div class="mode-accuracy">ì •í™•ë„ 94%</div>
                        <button class="mode-btn" onclick="switchMode('photo')">ì‚¬ì§„ ë¶„ì„ ì‹œì‘</button>
                    </div>
                    
                    <div class="mode-card" data-mode="draping">
                        <div class="mode-icon">ğŸ­</div>
                        <h3>ì‹¤ì‹œê°„ ê°€ìƒ ë“œë˜ì´í•‘</h3>
                        <p><strong>ì‹¤ì‹œê°„ìœ¼ë¡œ ìƒ‰ìƒ ì–´ìš¸ë¦¼ í™•ì¸</strong><br>
                        ë¼ì´ë¸Œ ì¹´ë©”ë¼ + ê°€ìƒ ì²œ + ì‹¤ì‹œê°„ Delta E ë¶„ì„</p>
                        <div class="mode-accuracy">ì •í™•ë„ 97%</div>
                        <button class="mode-btn" onclick="switchMode('draping')">ë“œë˜ì´í•‘ ì‹œì‘</button>
                    </div>
                    
                    <div class="mode-card" data-mode="hybrid">
                        <div class="mode-icon">ğŸš€</div>
                        <h3>í•˜ì´ë¸Œë¦¬ë“œ ì¢…í•© ë¶„ì„</h3>
                        <p><strong>ì‚¬ì§„ + ë“œë˜ì´í•‘ + ì „ë¬¸ê°€ ê²€ì¦</strong><br>
                        ëª¨ë“  ë°©ë²•ì„ ê²°í•©í•œ ìµœê³  ì •í™•ë„ì˜ ì§„ë‹¨</p>
                        <div class="mode-accuracy">ì •í™•ë„ 99%</div>
                        <button class="mode-btn" onclick="switchMode('hybrid')">ì¢…í•© ë¶„ì„ ì‹œì‘</button>
                    </div>
                </div>
            </section>

            <!-- AI ì‚¬ì§„ ë¶„ì„ ì„¹ì…˜ -->
            <section class="ai-analysis" id="ai-analysis">
                <div class="analysis-header">
                    <h3 class="analysis-title">AI ì‚¬ì§„ ë¶„ì„</h3>
                    <div class="analysis-mode-badge">ì‚¬ì§„ ëª¨ë“œ</div>
                </div>
                
                <div class="camera-section">
                    <div class="camera-container">
                        <video class="camera-preview" id="camera-preview" autoplay muted playsinline></video>
                        <canvas class="analysis-canvas" id="analysis-canvas"></canvas>
                        <div class="face-detection-overlay" id="face-detection-overlay">
                            <!-- ì–¼êµ´ ê°ì§€ ë°•ìŠ¤ë“¤ì´ ì—¬ê¸°ì— ìƒì„±ë¨ -->
                        </div>
                        <div class="camera-overlay" id="camera-overlay">
                            <div>
                                ğŸ“· ì–¼êµ´ì„ í™”ë©´ ì¤‘ì•™ì— ë§ì¶°ì£¼ì„¸ìš”<br>
                                <small>AIê°€ ìë™ìœ¼ë¡œ ì–¼êµ´ì„ ê°ì§€í•©ë‹ˆë‹¤</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="camera-controls">
                        <div class="controls-title">ë¶„ì„ ì œì–´</div>
                        
                        <div class="control-group">
                            <label class="control-label">ì¹´ë©”ë¼ ì œì–´</label>
                            <button class="primary-btn" id="start-camera-btn">ì¹´ë©”ë¼ ì‹œì‘</button>
                            <button class="secondary-btn" id="capture-photo-btn" disabled>ì‚¬ì§„ ì´¬ì˜ ë° ë¶„ì„</button>
                        </div>
                        
                        <div class="control-group">
                            <label class="control-label">íŒŒì¼ ì—…ë¡œë“œ</label>
                            <button class="secondary-btn" id="upload-file-btn">íŒŒì¼ ì„ íƒ</button>
                            <input type="file" class="file-input" id="file-input" accept="image/*">
                        </div>
                        
                        <div class="control-group">
                            <label class="control-label">ê¸°íƒ€</label>
                            <button class="secondary-btn" id="reset-analysis-btn">ì´ˆê¸°í™”</button>
                            <button class="secondary-btn" id="back-to-modes-btn">ëª¨ë“œ ì„ íƒìœ¼ë¡œ</button>
                        </div>
                    </div>
                </div>
                
                <!-- ë¶„ì„ ì§„í–‰ ìƒíƒœ -->
                <div class="analysis-progress" id="analysis-progress">
                    <div class="progress-title">AIê°€ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <div class="progress-step" id="progress-step">ì–¼êµ´ ê°ì§€ ì¤‘...</div>
                </div>
            </section>

            <!-- ê³ ê° ê´€ë¦¬ ì„¹ì…˜ -->
            <section class="customer-management" id="customer-management">
                <div class="analysis-header">
                    <h3 class="analysis-title">ê³ ê° ê´€ë¦¬</h3>
                    <div class="analysis-mode-badge">ê³ ê° ì •ë³´</div>
                </div>
                
                <form class="customer-form" id="customer-form">
                    <div class="form-group">
                        <label class="form-label">ê³ ê° ì´ë¦„ *</label>
                        <input type="text" class="form-input" id="customer-name" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ì—°ë½ì²˜</label>
                        <input type="tel" class="form-input" id="customer-phone">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ë‚˜ì´</label>
                        <input type="number" class="form-input" id="customer-age" min="1" max="120">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ì„±ë³„</label>
                        <select class="form-input" id="customer-gender">
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="female">ì—¬ì„±</option>
                            <option value="male">ë‚¨ì„±</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ë°©ë¬¸ ëª©ì </label>
                        <select class="form-input" id="visit-purpose">
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="hair-color">í—¤ì–´ ì—¼ìƒ‰</option>
                            <option value="consultation">í¼ìŠ¤ë„ ì»¬ëŸ¬ ìƒë‹´</option>
                            <option value="makeup">ë©”ì´í¬ì—… ìƒë‹´</option>
                            <option value="total-styling">í† íƒˆ ìŠ¤íƒ€ì¼ë§</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">íŠ¹ì´ì‚¬í•­</label>
                        <textarea class="form-input form-textarea" id="customer-notes" placeholder="ì•Œë ˆë¥´ê¸°, ì„ í˜¸ ìƒ‰ìƒ, ê¸°íƒ€ ìš”ì²­ì‚¬í•­ ë“±"></textarea>
                    </div>
                </form>
                
                <div class="results-actions">
                    <button class="primary-btn" id="save-customer-btn">ê³ ê° ì •ë³´ ì €ì¥</button>
                    <button class="secondary-btn" id="load-customer-btn">ê¸°ì¡´ ê³ ê° ë¶ˆëŸ¬ì˜¤ê¸°</button>
                    <button class="secondary-btn" id="clear-customer-btn">ì •ë³´ ì´ˆê¸°í™”</button>
                    <button class="secondary-btn" id="export-customer-btn">ê³ ê° ë°ì´í„° ë‚´ë³´ë‚´ê¸°</button>
                </div>
                
                <div class="customer-history">
                    <h4>ìµœê·¼ ì§„ë‹¨ ì´ë ¥</h4>
                    <table class="history-table">
                        <thead>
                            <tr>
                                <th>ë‚ ì§œ</th>
                                <th>ê³ ê°ëª…</th>
                                <th>ì§„ë‹¨ ê²°ê³¼</th>
                                <th>ë°©ë¬¸ ëª©ì </th>
                                <th>ì‘ì—…</th>
                            </tr>
                        </thead>
                        <tbody id="customer-history-body">
                            <!-- ê³ ê° ì´ë ¥ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- ê²°ê³¼ í‘œì‹œ ì„¹ì…˜ -->
            <section class="results-container" id="results-container">
                <div class="results-header">
                    <h2>í¼ìŠ¤ë„ì»¬ëŸ¬ ì§„ë‹¨ ê²°ê³¼</h2>
                    <div class="season-badge" id="season-badge">
                        <div id="season-name">ë¶„ì„ ì¤‘...</div>
                        <div class="confidence-score" id="confidence-score">ì‹ ë¢°ë„: --%</div>
                    </div>
                </div>
                
                <div class="results-grid">
                    <div class="result-section">
                        <h3>ğŸ“Š ë¶„ì„ ì •ë³´</h3>
                        <div class="detail-grid">
                            <div class="detail-item">
                                <span class="detail-label">ì–¸ë”í†¤</span>
                                <span class="detail-value" id="undertone-result">-</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">ëª…ë„</span>
                                <span class="detail-value" id="brightness-result">-</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">ì±„ë„</span>
                                <span class="detail-value" id="saturation-result">-</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Delta E ì ìˆ˜</span>
                                <span class="detail-value" id="delta-e-result">-</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">ë¶„ì„ ì‹œê°„</span>
                                <span class="detail-value" id="analysis-time">-</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">AI ì—”ì§„</span>
                                <span class="detail-value">TensorFlow.js + Delta E 2000</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="result-section">
                        <h3>ğŸ¨ ì¶”ì²œ ì»¬ëŸ¬ íŒ”ë ˆíŠ¸</h3>
                        <div class="color-palette" id="recommended-colors">
                            <!-- ì¶”ì²œ ìƒ‰ìƒë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                        </div>
                    </div>
                    
                    <div class="result-section">
                        <h3>ğŸ’„ ìŠ¤íƒ€ì¼ë§ ê°€ì´ë“œ</h3>
                        <ul class="recommendation-list" id="styling-recommendations">
                            <!-- ìŠ¤íƒ€ì¼ë§ ì¶”ì²œì‚¬í•­ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                        </ul>
                    </div>
                    
                    <div class="result-section">
                        <h3>ğŸ›ï¸ ë¸Œëœë“œë³„ ì œí’ˆ ì¶”ì²œ</h3>
                        <div class="detail-grid" id="brand-recommendations">
                            <!-- ë¸Œëœë“œ ì œí’ˆ ì¶”ì²œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                        </div>
                    </div>
                </div>
                
                <div class="results-actions">
                    <button class="primary-btn" id="generate-pdf-btn">PDF ë³´ê³ ì„œ ìƒì„±</button>
                    <button class="primary-btn" id="save-to-customer-btn">ê³ ê°ì—ê²Œ ì €ì¥</button>
                    <button class="secondary-btn" id="print-result-btn">ê²°ê³¼ ì¸ì‡„</button>
                    <button class="secondary-btn" id="share-result-btn">ê²°ê³¼ ê³µìœ </button>
                    <button class="secondary-btn" id="new-analysis-btn">ìƒˆ ë¶„ì„</button>
                </div>
            </section>
        </main>
    </div>

    <!-- ì‹¤ì‹œê°„ ë“œë˜ì´í•‘ ì „ì²´í™”ë©´ -->
    <div class="draping-fullscreen" id="draping-fullscreen">
        <div class="draping-header">
            <div class="draping-title">ì‹¤ì‹œê°„ ê°€ìƒ ë“œë˜ì´í•‘ (Delta E 2000)</div>
            <div class="draping-controls">
                <button class="draping-btn" id="capture-draping-btn">ìº¡ì²˜</button>
                <button class="draping-btn" id="reset-draping-btn">ë¦¬ì…‹</button>
                <button class="draping-btn" id="close-draping-btn">ë‹«ê¸°</button>
            </div>
        </div>
        
        <div class="draping-content">
            <div class="draping-video-area">
                <video class="draping-video" id="draping-video" autoplay muted playsinline></video>
                <div class="virtual-fabric-overlay" id="virtual-fabric-overlay">
                    <!-- ê°€ìƒ ì²œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                </div>
            </div>
            
            <div class="draping-panel">
                <div class="panel-section">
                    <h4>ê³„ì ˆ ì„ íƒ</h4>
                    <div class="season-selector">
                        <button class="season-btn active" data-season="spring">ë´„ (Spring)</button>
                        <button class="season-btn" data-season="summer">ì—¬ë¦„ (Summer)</button>
                        <button class="season-btn" data-season="autumn">ê°€ì„ (Autumn)</button>
                        <button class="season-btn" data-season="winter">ê²¨ìš¸ (Winter)</button>
                    </div>
                </div>
                
                <div class="panel-section">
                    <h4>ìƒ‰ìƒ ì„ íƒ</h4>
                    <div class="color-grid" id="draping-color-grid">
                        <!-- ìƒ‰ìƒë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                    </div>
                </div>
                
                <div class="panel-section">
                    <h4>ì‹¤ì‹œê°„ ë¶„ì„</h4>
                    <div class="live-analysis">
                        <div class="delta-display">
                            <div class="delta-value" id="live-delta-value">--.-</div>
                            <div class="delta-description" id="live-delta-description">ìƒ‰ìƒì„ ì„ íƒí•˜ì„¸ìš”</div>
                        </div>
                        <div class="delta-score">
                            <div class="score-gauge">
                                <div class="score-fill" id="live-score-fill" style="width: 0%;"></div>
                            </div>
                            <div class="score-text" id="live-score-text">0ì </div>
                        </div>
                        <div id="live-recommendation-badge"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- í† ìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆ -->
    <div class="toast-container" id="toast-container"></div>

    <script>
        // ì „ì—­ ì„¤ì • ë° ìƒíƒœ ê´€ë¦¬
        window.PersonalColorAI = {
            version: 'PROFESSIONAL-v2.0',
            isLoaded: false,
            currentMode: 'selection',
            startTime: Date.now(),
            
            // AI ì‹œìŠ¤í…œ
            ai: {
                deltaE: null,
                skinAnalyzer: null,
                faceDetector: null,
                colorSystem: null,
                tensorflow: null
            },
            
            // ë“œë˜ì´í•‘ ì‹œìŠ¤í…œ
            draping: {
                engine: null,
                stream: null,
                isActive: false,
                selectedColors: [],
                currentSkinTone: null
            },
            
            // í˜„ì¬ ì§„ë‹¨ ë° ê³ ê° ë°ì´í„°
            currentDiagnosis: null,
            currentCustomer: null,
            customerHistory: [],
            
            // ì„±ëŠ¥ í†µê³„
            performance: {
                totalAnalyses: 0,
                deltaECalculations: 0,
                processingTime: 0,
                customersServed: 0
            },
            
            // ìƒ‰ìƒ ë°ì´í„°ë² ì´ìŠ¤
            colorDatabase: {
                seasons: {
                    spring: {
                        name: 'ë´„ (Spring)',
                        colors: ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FECA57', '#FF9FF3', '#A8E6CF', '#FFD93D', '#6BCF7F', '#4D96FF', '#9B59B6', '#F8C471'],
                        characteristics: ['ë”°ëœ»í•œ', 'ë°ì€', 'ìƒë™ê° ìˆëŠ”', 'í™”ì‚¬í•œ'],
                        undertone: 'warm',
                        referenceL: 70,
                        referenceA: 10,
                        referenceB: 25
                    },
                    summer: {
                        name: 'ì—¬ë¦„ (Summer)',
                        colors: ['#A8E6CF', '#DCEDC8', '#C5E1A5', '#E1BEE7', '#B39DDB', '#90CAF9', '#81D4FA', '#80DEEA', '#80CBC4', '#FFCDD2', '#F8BBD9', '#E1BEE7'],
                        characteristics: ['ì°¨ê°€ìš´', 'ë¶€ë“œëŸ¬ìš´', 'ìš°ì•„í•œ', 'ì ˆì œëœ'],
                        undertone: 'cool',
                        referenceL: 65,
                        referenceA: -5,
                        referenceB: -8
                    },
                    autumn: {
                        name: 'ê°€ì„ (Autumn)',
                        colors: ['#D4AF37', '#CD853F', '#A0522D', '#8B4513', '#DAA520', '#B8860B', '#BC8F8F', '#F4A460', '#DEB887', '#D2B48C', '#BDB76B', '#9ACD32'],
                        characteristics: ['ë”°ëœ»í•œ', 'ê¹Šì€', 'í’ì„±í•œ', 'ì„±ìˆ™í•œ'],
                        undertone: 'warm',
                        referenceL: 50,
                        referenceA: 15,
                        referenceB: 30
                    },
                    winter: {
                        name: 'ê²¨ìš¸ (Winter)',
                        colors: ['#2C3E50', '#34495E', '#DC143C', '#4169E1', '#8A2BE2', '#191970', '#000080', '#8B0000', '#800080', '#4B0082', '#483D8B', '#2F4F4F'],
                        characteristics: ['ì°¨ê°€ìš´', 'ì„ ëª…í•œ', 'ê°•ë ¬í•œ', 'ê·¹ì ì¸'],
                        undertone: 'cool',
                        referenceL: 40,
                        referenceA: 2,
                        referenceB: -15
                    }
                },
                
                brands: {
                    hair: {
                        'Loreal': ['5.31', '6.23', '7.43', '8.31', '9.21'],
                        'Schwarzkopf': ['5-65', '6-46', '7-77', '8-00', '9-1'],
                        'Wella': ['5/31', '6/45', '7/75', '8/03', '9/16'],
                        'Keune': ['5.31', '6.35', '7.44', '8.07', '9.23']
                    },
                    makeup: {
                        'MAC': ['NC15', 'NC25', 'NC30', 'NW20', 'NW35'],
                        'Estee Lauder': ['1C1', '2C1', '3C1', '2W1', '3W1'],
                        'Fenty Beauty': ['150', '200', '250', '300', '350'],
                        'NARS': ['Siberia', 'Gobi', 'Barcelona', 'Cadiz', 'Syracuse']
                    }
                }
            }
        };

        // ì‹¤ì œ Delta E 2000 êµ¬í˜„ í´ë˜ìŠ¤
        class DeltaE2000Engine {
            constructor() {
                this.cache = new Map();
                this.cacheHits = 0;
                this.cacheMisses = 0;
                this.totalCalculations = 0;
                console.log('Delta E 2000 ì—”ì§„ ì´ˆê¸°í™”ë¨');
            }

            calculateDeltaE2000(lab1, lab2) {
                this.totalCalculations++;
                
                const cacheKey = this.generateCacheKey(lab1, lab2);
                if (this.cache.has(cacheKey)) {
                    this.cacheHits++;
                    return this.cache.get(cacheKey);
                }
                
                this.cacheMisses++;
                const result = this.computeDeltaE2000(lab1, lab2);
                this.cache.set(cacheKey, result);
                
                window.PersonalColorAI.performance.deltaECalculations++;
                
                return result;
            }

            computeDeltaE2000(lab1, lab2) {
                // CIE Delta E 2000 ì™„ì „ êµ¬í˜„
                const L1 = lab1.L || lab1.l, a1 = lab1.a, b1 = lab1.b;
                const L2 = lab2.L || lab2.l, a2 = lab2.a, b2 = lab2.b;

                // 1. Calculate C and h
                const C1 = Math.sqrt(a1 * a1 + b1 * b1);
                const C2 = Math.sqrt(a2 * a2 + b2 * b2);
                const C_bar = (C1 + C2) / 2;

                // 2. Calculate G
                const G = 0.5 * (1 - Math.sqrt(Math.pow(C_bar, 7) / (Math.pow(C_bar, 7) + Math.pow(25, 7))));

                // 3. Calculate a' and C'
                const a1_prime = (1 + G) * a1;
                const a2_prime = (1 + G) * a2;
                const C1_prime = Math.sqrt(a1_prime * a1_prime + b1 * b1);
                const C2_prime = Math.sqrt(a2_prime * a2_prime + b2 * b2);

                // 4. Calculate h'
                const h1_prime = this.calculateHuePrime(a1_prime, b1);
                const h2_prime = this.calculateHuePrime(a2_prime, b2);

                // 5. Calculate differences
                const deltaL_prime = L2 - L1;
                const deltaC_prime = C2
