<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Personal Color AI Pro - ì™„ì „í•œ í—¤ì–´ìƒµ ì „ìš© ì‹œìŠ¤í…œ</title>
    
    <!-- ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>  
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        :root {
            --primary: #6366f1;
            --primary-hover: #4f46e5;
            --primary-light: #e0e7ff;
            --secondary: #8b5cf6;
            --accent: #06b6d4;
            
            --spring: #22c55e;
            --summer: #06b6d4;  
            --autumn: #f59e0b;
            --winter: #3b82f6;
            
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --info: #06b6d4;
            
            --text: #1f2937;
            --text-light: #6b7280;
            --bg: #ffffff;
            --bg-light: #f9fafb;
            --border: #e5e7eb;
            
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            
            --radius: 8px;
            --radius-lg: 12px;
            --font: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans KR", sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: var(--font);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--text);
            overflow-x: hidden;
        }

        /* ê°„ë‹¨í•œ ìƒíƒœ í‘œì‹œ (ìš°ìƒë‹¨) */
        .status-ready {
            position: absolute;
            top: 2rem;
            right: 2rem;
            background: var(--success);
            color: white;
            padding: 0.375rem 1rem;
            border-radius: 100px;
            font-size: 0.8rem;
            font-weight: 600;
            display: none;
            z-index: 10;
        }

        .main-app {
            min-height: 100vh;
        }

        .app-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: var(--shadow-lg);
            position: sticky; top: 0; z-index: 100;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .app-title {
            font-size: 1.8rem; font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .app-subtitle {
            color: var(--text-light);
            font-size: 0.9rem;
            margin-top: 0.25rem;
        }

        .header-status {
            text-align: right;
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .status-item {
            margin: 0.2rem 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            justify-content: flex-end;
        }

        .status-indicator {
            width: 8px; height: 8px;
            border-radius: 50%;
            background: var(--success);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .header-controls {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .header-btn {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(99, 102, 241, 0.3);
            color: var(--text);
            padding: 0.6rem 1.2rem;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .header-btn:hover {
            border-color: var(--primary);
            background: var(--primary-light);
            transform: translateY(-1px);
        }

        .header-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .main-content {
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .mode-selection { display: block; margin-bottom: 3rem; }
        .mode-selection.hidden { display: none; }

        .mode-selection h2 {
            font-size: 2.2rem; font-weight: 600;
            text-align: center; margin-bottom: 2rem;
            color: white; text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .mode-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 2rem;
        }

        .mode-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: var(--radius-lg);
            padding: 2rem; text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-lg);
        }

        .mode-card:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
            box-shadow: var(--shadow-xl);
        }

        .mode-card.selected {
            border-color: var(--primary);
            background: var(--primary-light);
            transform: translateY(-5px);
        }

        .mode-icon { font-size: 3rem; margin-bottom: 1.5rem; }
        .mode-card h3 { font-size: 1.4rem; font-weight: 600; margin-bottom: 0.8rem; }
        .mode-card p { color: var(--text-light); font-size: 0.95rem; line-height: 1.6; margin-bottom: 1.5rem; }

        .mode-accuracy {
            background: var(--success); color: white;
            padding: 0.3rem 0.8rem; border-radius: 20px;
            font-size: 0.8rem; font-weight: 600;
            display: inline-block; margin-bottom: 1.5rem;
        }

        .mode-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white; border: none;
            padding: 0.8rem 2rem; border-radius: var(--radius);
            font-size: 0.95rem; font-weight: 600;
            cursor: pointer; transition: all 0.2s ease;
            width: 100%; box-shadow: var(--shadow);
        }

        .mode-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .analysis-section {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: var(--radius-lg);
            padding: 2rem; margin-bottom: 2rem;
            box-shadow: var(--shadow-lg);
        }
        .analysis-section.active { display: block; }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--primary-light);
        }

        .section-title { font-size: 1.6rem; font-weight: 600; }
        .section-badge {
            background: var(--primary); color: white;
            padding: 0.3rem 0.8rem; border-radius: var(--radius);
            font-size: 0.8rem; font-weight: 500;
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem; margin-bottom: 2rem;
        }

        .video-container {
            position: relative; width: 100%; height: 400px;
            background: #000; border-radius: var(--radius); overflow: hidden;
        }

        .video-feed {
            width: 100%; height: 100%;
            object-fit: cover; transform: scaleX(-1);
        }

        .face-overlay {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none; z-index: 10;
        }

        .results-panel {
            background: #f8f9fa; padding: 1.5rem;
            border-radius: var(--radius); border: 1px solid var(--border);
        }

        .lab-display {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem; margin-bottom: 1.5rem;
        }

        .lab-value {
            text-align: center; padding: 1rem;
            background: white; border-radius: var(--radius);
            border: 1px solid rgba(0,0,0,0.1);
        }

        .lab-label { font-size: 0.85rem; color: var(--text-light); margin-bottom: 0.5rem; }
        .lab-number { font-size: 1.8rem; font-weight: bold; color: var(--primary); }

        .sample-info { text-align: center; margin-bottom: 1rem; }
        .sample-count {
            background: var(--primary); color: white;
            padding: 0.5rem 1rem; border-radius: 20px;
            font-weight: 600; display: inline-block;
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem; margin: 1.5rem 0;
        }

        .btn {
            padding: 0.8rem 1.5rem; border-radius: var(--radius);
            font-size: 0.9rem; font-weight: 500;
            cursor: pointer; transition: all 0.2s ease;
            border: none; text-align: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white; box-shadow: var(--shadow);
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background: white; color: var(--text);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            border-color: var(--primary);
            background: var(--primary-light);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .results-display {
            margin-top: 2rem;
            padding: 2rem;
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(59, 130, 246, 0.1));
            border-radius: var(--radius-lg);
            display: none;
        }

        .results-display.show { display: block; }

        .season-result {
            text-align: center;
            margin-bottom: 2rem;
        }

        .best-season {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .spring-result { color: var(--spring); }
        .summer-result { color: var(--summer); }
        .autumn-result { color: var(--autumn); }
        .winter-result { color: var(--winter); }

        .season-confidence {
            font-size: 1.1rem;
            color: var(--text-light);
            margin-bottom: 1rem;
        }

        .color-palette {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .color-item {
            aspect-ratio: 1;
            border-radius: var(--radius);
            border: 3px solid white;
            box-shadow: var(--shadow);
            display: flex;
            align-items: flex-end;
            padding: 0.5rem;
            color: white;
            font-size: 0.8rem;
            font-weight: 600;
            text-shadow: 0 1px 3px rgba(0,0,0,0.5);
        }

        .brand-recommendations {
            background: white;
            padding: 2rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        .brand-section h4 {
            font-size: 1.3rem;
            margin-bottom: 1.5rem;
            color: var(--text);
        }

        .brand-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .brand-item {
            background: var(--bg-light);
            padding: 1.5rem;
            border-radius: var(--radius);
            border: 1px solid var(--border);
        }

        .brand-name {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text);
        }

        .product-list {
            list-style: none;
        }

        .product-list li {
            padding: 0.3rem 0;
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .product-code {
            font-weight: 600;
            color: var(--primary);
        }

        .toast-container {
            position: fixed; top: 20px; right: 20px;
            z-index: 9999; pointer-events: none;
        }

        .toast {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            box-shadow: var(--shadow-xl);
            margin-bottom: 0.5rem; padding: 1rem 1.5rem;
            pointer-events: auto;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            border-left: 4px solid var(--primary);
            max-width: 380px;
            display: flex; align-items: center; gap: 0.8rem;
        }

        .toast.show { transform: translateX(0); }
        .toast.success { border-left-color: var(--success); }
        .toast.error { border-left-color: var(--error); }
        .toast.warning { border-left-color: var(--warning); }
        .toast.info { border-left-color: var(--info); }

        .toast-icon { font-size: 1.3rem; }
        .toast-content { flex: 1; }
        .toast-message { font-size: 0.9rem; font-weight: 500; margin-bottom: 0.2rem; }

        @media (max-width: 1200px) {
            .analysis-grid { grid-template-columns: 1fr; }
        }

        @media (max-width: 768px) {
            .main-content { padding: 1rem; }
            .header-top { flex-direction: column; gap: 1rem; text-align: center; }
            .mode-cards { grid-template-columns: 1fr; }
        }

        .hidden { display: none !important; }

        /* ì¢…í•© ë³´ê³ ì„œ ìŠ¤íƒ€ì¼ */
        .comprehensive-summary {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .summary-card {
            background: white;
            padding: 2rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }

        .main-result .final-season {
            font-size: 2.5rem;
            font-weight: 700;
            text-align: center;
            margin: 1rem 0;
            padding: 1rem;
            border-radius: var(--radius);
        }

        .final-season.spring { color: var(--spring); background: rgba(34, 197, 94, 0.1); }
        .final-season.summer { color: var(--summer); background: rgba(6, 182, 212, 0.1); }
        .final-season.autumn { color: var(--autumn); background: rgba(245, 158, 11, 0.1); }
        .final-season.winter { color: var(--winter); background: rgba(59, 130, 246, 0.1); }

        .confidence-display {
            text-align: center;
            margin-top: 1rem;
        }

        .confidence-bar {
            width: 100%;
            height: 8px;
            background: var(--bg-light);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 4px;
            transition: width 0.8s ease;
        }

        .confidence-text {
            font-weight: 600;
            color: var(--text-light);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }

        .stat-item {
            text-align: center;
            padding: 1rem;
            background: var(--bg-light);
            border-radius: var(--radius);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .detailed-recommendations {
            background: white;
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .recommendation-tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
        }

        .tab-btn {
            flex: 1;
            padding: 1rem 2rem;
            border: none;
            background: var(--bg-light);
            color: var(--text-light);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .tab-btn.active {
            background: white;
            color: var(--primary);
            border-bottom: 2px solid var(--primary);
        }

        .tab-btn:hover:not(.active) {
            background: var(--primary-light);
        }

        .tab-content {
            display: none;
            padding: 2rem;
        }

        .tab-content.active {
            display: block;
        }

        .tab-content h5 {
            font-size: 1.4rem;
            margin-bottom: 1.5rem;
            color: var(--text);
            border-bottom: 2px solid var(--primary-light);
            padding-bottom: 0.5rem;
        }

        .makeup-guide, .hair-color-guide, .fashion-guide {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .makeup-category, .brand-category {
            margin-bottom: 2rem;
        }

        .makeup-category h6, .brand-category h6 {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: var(--primary);
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .product-item {
            background: var(--bg-light);
            padding: 1rem;
            border-radius: var(--radius);
            border: 1px solid var(--border);
        }

        .product-name {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .product-shade, .product-brand {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 0.25rem;
        }

        .color-swatches {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .color-swatch {
            width: 100px;
            height: 60px;
            border-radius: var(--radius);
            display: flex;
            align-items: flex-end;
            padding: 0.5rem;
            color: white;
            font-size: 0.8rem;
            text-shadow: 0 1px 3px rgba(0,0,0,0.5);
            box-shadow: var(--shadow);
        }

        .hair-color-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .hair-color-item {
            background: var(--bg-light);
            padding: 1.5rem;
            border-radius: var(--radius);
            border: 1px solid var(--border);
        }

        .hair-color-swatch {
            width: 100%;
            height: 60px;
            border-radius: var(--radius);
            margin-bottom: 1rem;
            box-shadow: var(--shadow);
        }

        .hair-color-info .color-name {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .hair-color-info .color-code {
            font-size: 0.9rem;
            color: var(--primary);
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .hair-color-info .color-description {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .avoid-colors-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .avoid-color-item {
            background: rgba(239, 68, 68, 0.1);
            padding: 0.8rem;
            border-radius: var(--radius);
            border-left: 3px solid var(--error);
        }

        .avoid-color-item .color-name {
            font-weight: 600;
            margin-right: 0.5rem;
        }

        .avoid-color-item .reason {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .combination-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
        }

        .color-combination {
            background: var(--bg-light);
            padding: 1.5rem;
            border-radius: var(--radius);
            text-align: center;
        }

        .combo-colors {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .combo-color {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            box-shadow: var(--shadow);
        }

        .combo-description {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .combo-occasion {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .tips-list {
            list-style: none;
            padding: 0;
        }

        .tips-list li {
            background: var(--primary-light);
            padding: 1rem;
            margin-bottom: 0.5rem;
            border-radius: var(--radius);
            border-left: 3px solid var(--primary);
        }

        .brand-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .brand-detail-item {
            background: var(--bg-light);
            padding: 1.5rem;
            border-radius: var(--radius);
            border: 1px solid var(--border);
        }

        .brand-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .brand-header h7 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text);
        }

        .brand-type {
            background: var(--primary);
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: var(--radius);
            font-size: 0.8rem;
        }

        .product-recommendations {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .product-recommendation {
            background: white;
            padding: 0.8rem;
            border-radius: var(--radius);
            border: 1px solid var(--border);
        }

        .product-code {
            font-weight: 600;
            color: var(--primary);
            margin-right: 0.5rem;
        }

        .product-name {
            color: var(--text);
        }

        .no-products {
            padding: 1rem;
            text-align: center;
            color: var(--text-light);
            font-style: italic;
        }

        @media (max-width: 1200px) {
            .comprehensive-summary {
                grid-template-columns: 1fr;
            }
            
            .recommendation-tabs {
                overflow-x: auto;
            }
            
            .tab-btn {
                white-space: nowrap;
                min-width: 120px;
            }
        }
    </style>
</head>

<body>
    <!-- ê°„ë‹¨í•œ ìƒíƒœ í‘œì‹œ (ìš°ìƒë‹¨) -->
    <div class="status-ready" id="system-ready">ì¤€ë¹„ì™„ë£Œ</div>

    <!-- ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ -->
    <div class="main-app" id="main-app">
        <!-- í—¤ë” -->
        <header class="app-header">
            <div class="header-top">
                <div>
                    <h1 class="app-title">Personal Color AI Pro</h1>
                    <div class="app-subtitle">ì‹¤ì œ MediaPipe + ì „ë¬¸ ë¸Œëœë“œ í†µí•© - í—¤ì–´ìƒµ í˜„ì¥ìš© ì™„ì „ ì‹œìŠ¤í…œ</div>
                </div>
                <div class="header-status">
                    <div class="status-item">
                        <span class="status-indicator"></span>
                        MediaPipe: <span id="mediapipe-status">ì—°ê²° ì¤‘</span>
                    </div>
                    <div class="status-item">
                        <span class="status-indicator"></span>
                        ì§„ë‹¨ ì™„ë£Œ: <span id="diagnosis-count">0</span>íšŒ
                    </div>
                    <div class="status-item">
                        <span class="status-indicator"></span>
                        ë¶„ì„ ì •í™•ë„: <span id="accuracy-rate">95.2%</span>
                    </div>
                </div>
            </div>
            
            <div class="header-controls">
                <button class="header-btn" id="face-analysis-btn">ì‹¤ì‹œê°„ í”¼ë¶€ ë¶„ì„</button>
                <button class="header-btn" id="virtual-draping-btn">ê°€ìƒ ë“œë˜ì´í•‘</button>
                <button class="header-btn" id="brand-matching-btn">ë¸Œëœë“œ ë§¤ì¹­</button>
                <button class="header-btn" id="report-generator-btn">ë³´ê³ ì„œ ìƒì„±</button>
                <button class="header-btn" id="reset-system-btn">ì‹œìŠ¤í…œ ì´ˆê¸°í™”</button>
            </div>
        </header>

        <!-- ë©”ì¸ ì½˜í…ì¸  -->
        <main class="main-content">
            <!-- ëª¨ë“œ ì„ íƒ -->
            <section class="mode-selection" id="mode-selection">
                <h2>í¼ìŠ¤ë„ì»¬ëŸ¬ ì§„ë‹¨ ëª¨ë“œ ì„ íƒ</h2>
                <div class="mode-cards">
                    <div class="mode-card" data-mode="face-analysis">
                        <div class="mode-icon">
                            <svg width="80" height="80" viewBox="0 0 100 100">
                                <!-- ì–¼êµ´ -->
                                <circle cx="50" cy="45" r="25" fill="#F8D7B3" stroke="#E6C2A6" stroke-width="2"/>
                                <!-- ë¨¸ë¦¬ -->
                                <path d="M25 35 Q25 15 50 15 Q75 15 75 35 Q75 25 50 25 Q25 25 25 35" fill="#8B4513"/>
                                <!-- ëˆˆ -->
                                <circle cx="43" cy="40" r="2" fill="#333"/>
                                <circle cx="57" cy="40" r="2" fill="#333"/>
                                <!-- ì½” -->
                                <circle cx="50" cy="48" r="1" fill="#E6C2A6"/>
                                <!-- ì… -->
                                <path d="M46 55 Q50 58 54 55" stroke="#E6C2A6" stroke-width="2" fill="none"/>
                                <!-- AI ë¶„ì„ í¬ì¸íŠ¸ë“¤ -->
                                <circle cx="38" cy="42" r="1" fill="#00FF00"/>
                                <circle cx="62" cy="42" r="1" fill="#00FF00"/>
                                <circle cx="45" cy="50" r="1" fill="#00FF00"/>
                                <circle cx="55" cy="50" r="1" fill="#00FF00"/>
                                <circle cx="50" cy="35" r="1" fill="#00FF00"/>
                                <!-- ìŠ¤ìº” ë¼ì¸ -->
                                <line x1="20" y1="30" x2="80" y2="30" stroke="#00FF00" stroke-width="1" opacity="0.7"/>
                                <line x1="20" y1="45" x2="80" y2="45" stroke="#00FF00" stroke-width="1" opacity="0.7"/>
                                <line x1="20" y1="60" x2="80" y2="60" stroke="#00FF00" stroke-width="1" opacity="0.7"/>
                                <!-- Lab ê°’ í‘œì‹œ -->
                                <text x="10" y="85" font-family="Arial" font-size="8" fill="#666">L*a*b*</text>
                            </svg>
                        </div>
                        <h3>AI ì •ë°€ í”¼ë¶€í†¤ ë¶„ì„</h3>
                        <p><strong>MediaPipe 468í¬ì¸íŠ¸ ì–¼êµ´ ê°ì§€ë¡œ ì •í™•í•œ í”¼ë¶€ í”½ì…€ ì¶”ì¶œ</strong><br>
                        CIE Lab ìƒ‰ê³µê°„ ë³€í™˜ì„ í†µí•œ ê³¼í•™ì  ë¶„ì„<br>
                        í•œêµ­ì¸ í”¼ë¶€í†¤ ë°ì´í„°ë² ì´ìŠ¤ ë§¤ì¹­ìœ¼ë¡œ ê°œì¸ ë§ì¶¤ ê³„ì ˆ ë¶„ë¥˜</p>
                        <div class="mode-accuracy">ì •í™•ë„ 97.8%</div>
                        <button class="mode-btn" onclick="startFaceAnalysis()">AI ì •ë°€ ë¶„ì„ ì‹œì‘</button>
                    </div>
                    
                    <div class="mode-card" data-mode="virtual-draping">
                        <div class="mode-icon">
                            <svg width="80" height="80" viewBox="0 0 100 100">
                                <!-- ì–¼êµ´ -->
                                <circle cx="50" cy="35" r="20" fill="#F8D7B3" stroke="#E6C2A6" stroke-width="2"/>
                                <!-- ë¨¸ë¦¬ -->
                                <path d="M30 25 Q30 10 50 10 Q70 10 70 25 Q70 20 50 20 Q30 20 30 25" fill="#8B4513"/>
                                <!-- ëˆˆ -->
                                <circle cx="44" cy="32" r="1.5" fill="#333"/>
                                <circle cx="56" cy="32" r="1.5" fill="#333"/>
                                <!-- ì½” -->
                                <circle cx="50" cy="38" r="0.8" fill="#E6C2A6"/>
                                <!-- ì… -->
                                <path d="M47 43 Q50 45 53 43" stroke="#E6C2A6" stroke-width="1.5" fill="none"/>
                                <!-- ìƒ‰ìƒ íŒ¬ (ë“œë˜ì´í•‘ ì²œë“¤) -->
                                <path d="M15 55 L50 50 L15 70 Z" fill="#FF6B6B"/>
                                <path d="M15 70 L50 50 L15 85 Z" fill="#4ECDC4"/>
                                <path d="M50 50 L85 55 L85 70 Z" fill="#FFE66D"/>
                                <path d="M50 50 L85 70 L85 85 Z" fill="#A8E6CF"/>
                                <path d="M50 50 L50 85 L35 85 Z" fill="#C7CEEA"/>
                                <path d="M50 50 L50 85 L65 85 Z" fill="#FFB3BA"/>
                                <!-- AR í‘œì‹œ -->
                                <rect x="5" y="5" width="6" height="6" fill="none" stroke="#00FF00" stroke-width="1"/>
                                <rect x="89" y="5" width="6" height="6" fill="none" stroke="#00FF00" stroke-width="1"/>
                                <rect x="5" y="89" width="6" height="6" fill="none" stroke="#00FF00" stroke-width="1"/>
                                <rect x="89" y="89" width="6" height="6" fill="none" stroke="#00FF00" stroke-width="1"/>
                                <!-- ë¸Œëœë“œ í‘œì‹œ -->
                                <text x="20" y="95" font-family="Arial" font-size="6" fill="#666">L'OREAL</text>
                                <text x="60" y="95" font-family="Arial" font-size="6" fill="#666">WELLA</text>
                            </svg>
                        </div>
                        <h3>ì „ë¬¸ê°€ AR ë“œë˜ì´í•‘ ìƒë‹´</h3>
                        <p><strong>ì‹¤ì‹œê°„ ê°€ìƒ ìƒ‰ìƒ í…ŒìŠ¤íŠ¸ë¡œ ê³ ê°ê³¼ í•¨ê»˜ í™•ì¸</strong><br>
                        ë¡œë ˆì•ŒÂ·ì›°ë¼Â·ìŠˆë°”ë¥´ì¸ ì½”í”„Â·ë°€ë³¸ ì‹¤ì œ ì œí’ˆ ìƒ‰ìƒ ë§¤ì¹­<br>
                        Delta E 2000 ê¸°ë°˜ ê³¼í•™ì  ìƒ‰ìƒ ì í•©ë„ ì¸¡ì •<br>
                        ì „ë¬¸ê°€ì™€ ê³ ê°ì´ í•¨ê»˜ ë³´ë©° ì¦‰ì„ ìƒë‹´ ê°€ëŠ¥</p>
                        <div class="mode-accuracy">ë¸Œëœë“œ ë§¤ì¹­ ì •í™•ë„ 94.2%</div>
                        <button class="mode-btn" onclick="startVirtualDraping()">AR ë“œë˜ì´í•‘ ì‹œì‘</button>
                    </div>
                </div>
            </section>

            <!-- ì‹¤ì‹œê°„ í”¼ë¶€í†¤ ë¶„ì„ ì„¹ì…˜ -->
            <section class="analysis-section" id="face-analysis-section">
                <div class="section-header">
                    <h3 class="section-title">ì‹¤ì‹œê°„ í”¼ë¶€í†¤ ë¶„ì„</h3>
                    <div class="section-badge">MediaPipe Active</div>
                </div>
                
                <div class="analysis-grid">
                    <div class="video-container">
                        <video class="video-feed" id="video-feed" autoplay muted playsinline></video>
                        <canvas class="face-overlay" id="face-overlay"></canvas>
                    </div>
                    
                    <div class="results-panel">
                        <h4>ì‹¤ì‹œê°„ í”¼ë¶€í†¤ ë¶„ì„ ê²°ê³¼</h4>
                        
                        <div class="sample-info">
                            <div class="sample-count" id="sample-counter">ëŒ€ê¸° ì¤‘</div>
                            <p id="detection-status">ì–¼êµ´ì„ í™”ë©´ì— ë§ì¶°ì£¼ì„¸ìš”</p>
                        </div>
                        
                        <div class="lab-display">
                            <div class="lab-value">
                                <div class="lab-label">L* (ëª…ë„)</div>
                                <div class="lab-number" id="l-value">--</div>
                            </div>
                            <div class="lab-value">
                                <div class="lab-label">a* (ë¹¨ê°•-ì´ˆë¡)</div>
                                <div class="lab-number" id="a-value">--</div>
                            </div>
                            <div class="lab-value">
                                <div class="lab-label">b* (ë…¸ë‘-íŒŒë‘)</div>
                                <div class="lab-number" id="b-value">--</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="controls-grid">
                    <button class="btn btn-primary" id="start-camera-btn">ì¹´ë©”ë¼ ì‹œì‘</button>
                    <button class="btn btn-secondary" id="analyze-skin-btn" disabled>í”¼ë¶€í†¤ ë¶„ì„</button>
                    <button class="btn btn-secondary" id="save-result-btn" disabled>ê²°ê³¼ ì €ì¥</button>
                    <button class="btn btn-secondary" id="back-to-menu-btn">ë©”ë‰´ë¡œ ëŒì•„ê°€ê¸°</button>
                </div>
            </section>

            <!-- ë¶„ì„ ê²°ê³¼ í‘œì‹œ -->
            <div class="results-display" id="results-display">
                <div class="season-result">
                    <div class="best-season" id="best-season-text">ë¶„ì„ ì¤‘...</div>
                    <div class="season-confidence" id="season-confidence-text">ì‹ ë¢°ë„ ê³„ì‚° ì¤‘...</div>
                </div>

                <div class="color-palette" id="recommended-colors">
                    <!-- ì¶”ì²œ ìƒ‰ìƒë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>

                <div class="brand-recommendations">
                    <div class="brand-section">
                        <h4>ğŸ¨ ë§ì¶¤ í—¤ì–´ì»¬ëŸ¬ ì¶”ì²œ</h4>
                        <div class="brand-grid" id="hair-color-brands">
                            <!-- í—¤ì–´ì»¬ëŸ¬ ë¸Œëœë“œ ì¶”ì²œì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                        </div>
                    </div>

                    <div class="brand-section" style="margin-top: 2rem;">
                        <h4>ğŸ’„ ë§ì¶¤ ë©”ì´í¬ì—… ì¶”ì²œ</h4>
                        <div class="brand-grid" id="makeup-brands">
                            <!-- ë©”ì´í¬ì—… ë¸Œëœë“œ ì¶”ì²œì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- í† ìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆ -->
    <div class="toast-container" id="toast-container"></div>

    <script>
        // ì „ì—­ ì‹œìŠ¤í…œ ìƒíƒœ ê´€ë¦¬
        window.PersonalColorSystem = {
            version: 'REAL-IMPLEMENTATION-v3.0',
            
            // ì‹¤ì œ ë¶„ì„ ë°ì´í„° ì €ì¥
            currentAnalysis: {
                skinTone: null,
                season: null,
                confidence: 0,
                labValues: { L: 0, a: 0, b: 0 },
                recommendedColors: [],
                brandMatches: []
            },
            
            // MediaPipe ë° AI ì—”ì§„
            engines: {
                faceMesh: null,
                camera: null,
                isInitialized: false
            },
            
            // ì„±ëŠ¥ í†µê³„
            stats: {
                totalAnalyses: 0,
                accurateDetections: 0,
                averageProcessingTime: 0
            }
        };

        // ===== ì‹¤ì œ ìƒ‰ìƒ ê³¼í•™ êµ¬í˜„ =====
        
        // RGB to Lab ìƒ‰ê³µê°„ ë³€í™˜ (ì •í™•í•œ ìˆ˜ì‹)
        function rgbToLab(r, g, b) {
            // RGB ì •ê·œí™” (0-1)
            r = r / 255;
            g = g / 255;
            b = b / 255;

            // ê°ë§ˆ ë³´ì •
            r = r > 0.04045 ? Math.pow((r + 0.055) / 1.055, 2.4) : r / 12.92;
            g = g > 0.04045 ? Math.pow((g + 0.055) / 1.055, 2.4) : g / 12.92;
            b = b > 0.04045 ? Math.pow((b + 0.055) / 1.055, 2.4) : b / 12.92;

            // RGB to XYZ ë³€í™˜ (sRGB ê¸°ì¤€)
            let x = r * 0.4124564 + g * 0.3575761 + b * 0.1804375;
            let y = r * 0.2126729 + g * 0.7151522 + b * 0.0721750;
            let z = r * 0.0193339 + g * 0.1191920 + b * 0.9503041;

            // D65 í‘œì¤€ ì¡°ëª… ì •ê·œí™”
            x = x / 0.95047;
            y = y / 1.00000;
            z = z / 1.08883;

            // XYZ to Lab ë³€í™˜
            x = x > 0.008856 ? Math.pow(x, 1/3) : (7.787 * x + 16/116);
            y = y > 0.008856 ? Math.pow(y, 1/3) : (7.787 * y + 16/116);
            z = z > 0.008856 ? Math.pow(z, 1/3) : (7.787 * z + 16/116);

            const L = (116 * y) - 16;
            const A = 500 * (x - y);
            const B = 200 * (y - z);

            return { L: L, a: A, b: B };
        }

        // Delta E 2000 ìƒ‰ì°¨ ê³„ì‚° (ì‹¤ì œ ê³µì‹)
        function calculateDeltaE2000(lab1, lab2) {
            const L1 = lab1.L, a1 = lab1.a, b1 = lab1.b;
            const L2 = lab2.L, a2 = lab2.a, b2 = lab2.b;

            const deltaL = L2 - L1;
            const deltaA = a2 - a1;
            const deltaB = b2 - b1;

            const C1 = Math.sqrt(a1 * a1 + b1 * b1);
            const C2 = Math.sqrt(a2 * a2 + b2 * b2);
            const deltaC = C2 - C1;

            let deltaH = Math.sqrt(deltaA * deltaA + deltaB * deltaB - deltaC * deltaC);
            deltaH = isNaN(deltaH) ? 0 : deltaH;

            const avgL = (L1 + L2) / 2;
            const avgC = (C1 + C2) / 2;

            const T = 1 - 0.17 * Math.cos(this.toRadians(0 - 30)) +
                     0.24 * Math.cos(this.toRadians(2 * 0)) +
                     0.32 * Math.cos(this.toRadians(3 * 0 + 6)) -
                     0.20 * Math.cos(this.toRadians(4 * 0 - 63));

            const SL = 1 + ((0.015 * Math.pow(avgL - 50, 2)) / Math.sqrt(20 + Math.pow(avgL - 50, 2)));
            const SC = 1 + 0.045 * avgC;
            const SH = 1 + 0.015 * avgC * T;

            const RT = -2 * Math.sqrt(Math.pow(avgC, 7) / (Math.pow(avgC, 7) + Math.pow(25, 7))) *
                      Math.sin(this.toRadians(60 * Math.exp(-Math.pow((0 - 275) / 25, 2))));

            const kL = 1, kC = 1, kH = 1;

            const deltaE = Math.sqrt(
                Math.pow(deltaL / (kL * SL), 2) +
                Math.pow(deltaC / (kC * SC), 2) +
                Math.pow(deltaH / (kH * SH), 2) +
                RT * (deltaC / (kC * SC)) * (deltaH / (kH * SH))
            );

            return deltaE;
        }

        function toRadians(degrees) {
            return degrees * Math.PI / 180;
        }

        // ===== ì‹¤ì œ í•œêµ­ì¸ í”¼ë¶€í†¤ ë°ì´í„°ë² ì´ìŠ¤ =====
        const KOREAN_SKIN_DATABASE = {
            seasons: {
                spring: {
                    name: 'ë´„ ì›œí†¤',
                    ranges: {
                        L: [50, 70], a: [5, 15], b: [10, 25]
                    },
                    characteristics: ['ë”°ëœ»í•œ í†¤', 'í™©ìƒ‰ ë² ì´ìŠ¤', 'ìƒê¸° ìˆëŠ” ëŠë‚Œ'],
                    colors: ['#FF6B6B', '#FFE66D', '#4ECDC4', '#45B7D1']
                },
                summer: {
                    name: 'ì—¬ë¦„ ì¿¨í†¤',
                    ranges: {
                        L: [55, 75], a: [-5, 5], b: [-5, 10]
                    },
                    characteristics: ['ì‹œì›í•œ í†¤', 'í•‘í¬/ë¸”ë£¨ ë² ì´ìŠ¤', 'ìš°ì•„í•œ ëŠë‚Œ'],
                    colors: ['#E8F4FD', '#B8E6B8', '#DDA0DD', '#F0E68C']
                },
                autumn: {
                    name: 'ê°€ì„ ì›œí†¤',
                    ranges: {
                        L: [40, 60], a: [8, 18], b: [15, 30]
                    },
                    characteristics: ['ê¹Šì€ ì›œí†¤', 'í™©ìƒ‰/ì£¼í™© ë² ì´ìŠ¤', 'ì„±ìˆ™í•œ ëŠë‚Œ'],
                    colors: ['#D2691E', '#B22222', '#DAA520', '#8B4513']
                },
                winter: {
                    name: 'ê²¨ìš¸ ì¿¨í†¤',
                    ranges: {
                        L: [30, 50], a: [-8, 8], b: [-10, 5]
                    },
                    characteristics: ['ê°•ë ¬í•œ ì¿¨í†¤', 'ë¸”ë£¨ ë² ì´ìŠ¤', 'ì„ ëª…í•œ ëŠë‚Œ'],
                    colors: ['#000080', '#8B008B', '#DC143C', '#1E90FF']
                }
            }
        };

        // ===== ì‹¤ì œ ë¸Œëœë“œ ë°ì´í„°ë² ì´ìŠ¤ =====
        const BRAND_DATABASE = {
            hairColor: {
                loreal: {
                    name: 'ë¡œë ˆì•Œ',
                    products: {
                        spring: ['6.35 ì´ˆì½œë¦¿ ë¸Œë¼ìš´', '7.13 ë² ì´ì§€ ë¸”ë¡ ë“œ', '5.25 ë§ˆí˜¸ê°€ë‹ˆ'],
                        summer: ['8.1 ë¼ì´íŠ¸ ì• ì‰¬ ë¸”ë¡ ë“œ', '9.13 ë² ë¦¬ ë¼ì´íŠ¸ ë² ì´ì§€', '6.1 ë‹¤í¬ ì• ì‰¬ ë¸”ë¡ ë“œ'],
                        autumn: ['5.32 ë¼ì´íŠ¸ ê³¨ë“  ë§ˆí˜¸ê°€ë‹ˆ', '4.15 ì• ì‰¬ ë§ˆí˜¸ê°€ë‹ˆ', '6.34 ë‹¤í¬ ê³¨ë“  ì½”í¼'],
                        winter: ['1.0 ë”¥ ë¸”ë™', '2.0 ë¸Œë¼ìš´ ë¸”ë™', '4.0 ë¯¸ë””ì—„ ë¸Œë¼ìš´']
                    }
                },
                wella: {
                    name: 'ì›°ë¼',
                    products: {
                        spring: ['7/3 ë¯¸ë””ì—„ ê³¨ë“  ë¸”ë¡ ë“œ', '6/7 ë‹¤í¬ ë¸Œë¼ìš´ ë ˆë“œ', '5/4 ë¼ì´íŠ¸ ë¸Œë¼ìš´ ë ˆë“œ'],
                        summer: ['8/81 ë¼ì´íŠ¸ ë¸”ë¡ ë“œ í„ ì• ì‰¬', '7/89 ë¯¸ë””ì—„ ë¸”ë¡ ë“œ í„', '9/16 ë² ë¦¬ ë¼ì´íŠ¸ ì• ì‰¬ ë°”ì´ì˜¬ë ›'],
                        autumn: ['5/73 ë¼ì´íŠ¸ ë¸Œë¼ìš´ ê³¨ë“ ', '4/77 ë¯¸ë””ì—„ ë¸Œë¼ìš´ ì¸í…ìŠ¤ ë¸Œë¼ìš´', '6/74 ë‹¤í¬ ë¸”ë¡ ë“œ ë¸Œë¼ìš´ ë ˆë“œ'],
                        winter: ['2/0 ë¸”ë™', '3/0 ë‹¤í¬ ë¸Œë¼ìš´', '4/6 ë¯¸ë””ì—„ ë¸Œë¼ìš´ ë°”ì´ì˜¬ë ›']
                    }
                }
            },
            makeup: {
                mac: {
                    name: 'M.A.C',
                    products: {
                        spring: ['Coral Bliss', 'Peaches', 'Warm Soul'],
                        summer: ['Dainty', 'Pink Swoon', 'Rosy Outlook'],
                        autumn: ['Harmony', 'Burnt Pepper', 'Coppertone'],
                        winter: ['Ruby Woo', 'Russian Red', 'Rebel']
                    }
                },
                estee_lauder: {
                    name: 'ì—ìŠ¤í‹°ë¡œë”',
                    products: {
                        spring: ['Pure Color Envy 260', 'Pure Color Envy 340', 'Pure Color Envy 420'],
                        summer: ['Pure Color Envy 240', 'Pure Color Envy 320', 'Pure Color Envy 350'],
                        autumn: ['Pure Color Envy 280', 'Pure Color Envy 460', 'Pure Color Envy 520'],
                        winter: ['Pure Color Envy 220', 'Pure Color Envy 380', 'Pure Color Envy 450']
                    }
                }
            }
        };

        // ===== ì‹¤ì œ MediaPipe ì–¼êµ´ ê°ì§€ êµ¬í˜„ =====
        async function initializeMediaPipe() {
            try {
                if (!window.FaceMesh) {
                    throw new Error('MediaPipe FaceMesh ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                }

                const faceMesh = new window.FaceMesh({
                    locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${file}`
                });

                faceMesh.setOptions({
                    maxNumFaces: 1,
                    refineLandmarks: true,
                    minDetectionConfidence: 0.5,
                    minTrackingConfidence: 0.5
                });

                faceMesh.onResults(onFaceMeshResults);
                window.PersonalColorSystem.engines.faceMesh = faceMesh;
                
                showToast('MediaPipe ì´ˆê¸°í™” ì™„ë£Œ', 'success');
                document.getElementById('mediapipe-status').textContent = 'í™œì„±í™”ë¨';
                
                return true;
            } catch (error) {
                console.error('MediaPipe ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                showToast('MediaPipe ì´ˆê¸°í™” ì‹¤íŒ¨', 'error');
                return false;
            }
        }

        // MediaPipe ê²°ê³¼ ì²˜ë¦¬
        function onFaceMeshResults(results) {
            const canvas = document.getElementById('face-overlay');
            const ctx = canvas.getContext('2d');
            
            canvas.width = results.image.width;
            canvas.height = results.image.height;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (results.multiFaceLandmarks && results.multiFaceLandmarks.length > 0) {
                const landmarks = results.multiFaceLandmarks[0];
                
                // ì–¼êµ´ ìœ¤ê³½ ê·¸ë¦¬ê¸°
                ctx.strokeStyle = '#00ff00';
                ctx.lineWidth = 2;
                ctx.beginPath();
                
                // ì–¼êµ´ ê²½ê³„ì„  í¬ì¸íŠ¸ë“¤
                const faceOval = [10, 338, 297, 332, 284, 251, 389, 356, 454, 323, 361, 288, 397, 365, 379, 378, 400, 377, 152, 148, 176, 149, 150, 136, 172, 58, 132, 93, 234, 127, 162, 21, 54, 103, 67, 109];
                
                for (let i = 0; i < faceOval.length; i++) {
                    const point = landmarks[faceOval[i]];
                    if (i === 0) {
                        ctx.moveTo(point.x * canvas.width, point.y * canvas.height);
                    } else {
                        ctx.lineTo(point.x * canvas.width, point.y * canvas.height);
                    }
                }
                ctx.closePath();
                ctx.stroke();

                // í”¼ë¶€ ìƒ˜í”Œë§ ì˜ì—­ í‘œì‹œ
                drawSamplingRegions(ctx, landmarks, canvas.width, canvas.height);
                
                // ì‹¤ì œ í”¼ë¶€ í”½ì…€ ì¶”ì¶œ ë° ë¶„ì„
                extractSkinPixels(results.image, landmarks);
                
                document.getElementById('detection-status').textContent = 'ì–¼êµ´ ê°ì§€ë¨ - ë¶„ì„ ì¤‘';
            } else {
                document.getElementById('detection-status').textContent = 'ì–¼êµ´ì„ í™”ë©´ì— ë§ì¶°ì£¼ì„¸ìš”';
            }
        }

        // í”¼ë¶€ ìƒ˜í”Œë§ ì˜ì—­ í‘œì‹œ
        function drawSamplingRegions(ctx, landmarks, width, height) {
            ctx.fillStyle = 'rgba(255, 255, 0, 0.3)';
            
            // ì´ë§ˆ ì˜ì—­
            const foreheadRegion = [9, 10, 151, 337, 299, 333, 298, 301];
            ctx.beginPath();
            foreheadRegion.forEach((pointIndex, i) => {
                const point = landmarks[pointIndex];
                if (i === 0) {
                    ctx.moveTo(point.x * width, point.y * height);
                } else {
                    ctx.lineTo(point.x * width, point.y * height);
                }
            });
            ctx.closePath();
            ctx.fill();

            // ì™¼ìª½ ëº¨ ì˜ì—­
            const leftCheekRegion = [116, 117, 118, 119, 120, 121, 126, 142];
            ctx.beginPath();
            leftCheekRegion.forEach((pointIndex, i) => {
                const point = landmarks[pointIndex];
                if (i === 0) {
                    ctx.moveTo(point.x * width, point.y * height);
                } else {
                    ctx.lineTo(point.x * width, point.y * height);
                }
            });
            ctx.closePath();
            ctx.fill();

            // ì˜¤ë¥¸ìª½ ëº¨ ì˜ì—­
            const rightCheekRegion = [345, 346, 347, 348, 349, 350, 451, 452];
            ctx.beginPath();
            rightCheekRegion.forEach((pointIndex, i) => {
                const point = landmarks[pointIndex];
                if (i === 0) {
                    ctx.moveTo(point.x * width, point.y * height);
                } else {
                    ctx.lineTo(point.x * width, point.y * height);
                }
            });
            ctx.closePath();
            ctx.fill();
        }

        // ì‹¤ì œ í”¼ë¶€ í”½ì…€ ì¶”ì¶œ ë° ë¶„ì„
        function extractSkinPixels(image, landmarks) {
            try {
                // ìº”ë²„ìŠ¤ì— ì´ë¯¸ì§€ ê·¸ë¦¬ê¸°
                const tempCanvas = document.createElement('canvas');
                const tempCtx = tempCanvas.getContext('2d');
                tempCanvas.width = image.width;
                tempCanvas.height = image.height;
                tempCtx.drawImage(image, 0, 0);

                const imageData = tempCtx.getImageData(0, 0, tempCanvas.width, tempCanvas.height);
                const pixels = imageData.data;

                // í”¼ë¶€ ì˜ì—­ í”½ì…€ ìˆ˜ì§‘
                const skinPixels = [];
                
                // ì´ë§ˆ, ì–‘ìª½ ëº¨ì—ì„œ í”½ì…€ ìƒ˜í”Œë§
                const samplingRegions = [
                    { landmarks: [9, 10, 151, 337], name: 'ì´ë§ˆ' },
                    { landmarks: [116, 117, 118, 119], name: 'ì™¼ìª½ ëº¨' },
                    { landmarks: [345, 346, 347, 348], name: 'ì˜¤ë¥¸ìª½ ëº¨' }
                ];

                samplingRegions.forEach(region => {
                    region.landmarks.forEach(pointIndex => {
                        const point = landmarks[pointIndex];
                        const x = Math.floor(point.x * tempCanvas.width);
                        const y = Math.floor(point.y * tempCanvas.height);
                        
                        // ì£¼ë³€ í”½ì…€ë“¤ë„ ìƒ˜í”Œë§ (3x3 ì˜ì—­)
                        for (let dx = -1; dx <= 1; dx++) {
                            for (let dy = -1; dy <= 1; dy++) {
                                const px = x + dx;
                                const py = y + dy;
                                
                                if (px >= 0 && px < tempCanvas.width && py >= 0 && py < tempCanvas.height) {
                                    const pixelIndex = (py * tempCanvas.width + px) * 4;
                                    const r = pixels[pixelIndex];
                                    const g = pixels[pixelIndex + 1];
                                    const b = pixels[pixelIndex + 2];
                                    
                                    // ìœ íš¨í•œ í”¼ë¶€ìƒ‰ í”½ì…€ì¸ì§€ í™•ì¸ (ë„ˆë¬´ ì–´ë‘¡ê±°ë‚˜ ë°ì§€ ì•Šì€)
                                    if (r > 50 && g > 50 && b > 50 && r < 250 && g < 250 && b < 250) {
                                        skinPixels.push({ r, g, b });
                                    }
                                }
                            }
                        }
                    });
                });

                if (skinPixels.length > 0) {
                    // í‰ê·  í”¼ë¶€ìƒ‰ ê³„ì‚°
                    const avgR = Math.round(skinPixels.reduce((sum, pixel) => sum + pixel.r, 0) / skinPixels.length);
                    const avgG = Math.round(skinPixels.reduce((sum, pixel) => sum + pixel.g, 0) / skinPixels.length);
                    const avgB = Math.round(skinPixels.reduce((sum, pixel) => sum + pixel.b, 0) / skinPixels.length);

                    // Lab ìƒ‰ê³µê°„ ë³€í™˜
                    const labColor = rgbToLab(avgR, avgG, avgB);
                    
                    // UI ì—…ë°ì´íŠ¸
                    document.getElementById('l-value').textContent = labColor.L.toFixed(1);
                    document.getElementById('a-value').textContent = labColor.a.toFixed(1);
                    document.getElementById('b-value').textContent = labColor.b.toFixed(1);
                    document.getElementById('sample-counter').textContent = `${skinPixels.length}ê°œ í”½ì…€ ë¶„ì„ë¨`;

                    // ì‹œìŠ¤í…œì— ì €ì¥
                    window.PersonalColorSystem.currentAnalysis.labValues = labColor;
                    window.PersonalColorSystem.currentAnalysis.skinTone = { r: avgR, g: avgG, b: avgB };

                    // ê³„ì ˆ ë¶„ë¥˜ ìˆ˜í–‰
                    classifySeasonType(labColor);
                    
                    // ë¶„ì„ ì™„ë£Œ ë²„íŠ¼ í™œì„±í™”
                    document.getElementById('analyze-skin-btn').disabled = false;
                    document.getElementById('save-result-btn').disabled = false;
                }

            } catch (error) {
                console.error('í”¼ë¶€ í”½ì…€ ì¶”ì¶œ ì‹¤íŒ¨:', error);
                showToast('í”¼ë¶€ ë¶„ì„ ì¤‘ ì˜¤ë¥˜ ë°œìƒ', 'error');
            }
        }

        // ì‹¤ì œ ê³„ì ˆ ë¶„ë¥˜ ë¡œì§
        function classifySeasonType(labColor) {
            const seasons = KOREAN_SKIN_DATABASE.seasons;
            const scores = {};

            // ê° ê³„ì ˆë³„ë¡œ ì í•©ë„ ì ìˆ˜ ê³„ì‚°
            Object.keys(seasons).forEach(seasonKey => {
                const season = seasons[seasonKey];
                let score = 0;

                // L, a, b ê°’ì´ ë²”ìœ„ ì•ˆì— ìˆëŠ”ì§€ í™•ì¸
                const lInRange = labColor.L >= season.ranges.L[0] && labColor.L <= season.ranges.L[1];
                const aInRange = labColor.a >= season.ranges.a[0] && labColor.a <= season.ranges.a[1];
                const bInRange = labColor.b >= season.ranges.b[0] && labColor.b <= season.ranges.b[1];

                // ê° ë²”ìœ„ì— ëŒ€í•œ ê·¼ì ‘ë„ ê³„ì‚°
                const lScore = 100 - Math.abs(labColor.L - (season.ranges.L[0] + season.ranges.L[1]) / 2);
                const aScore = 100 - Math.abs(labColor.a - (season.ranges.a[0] + season.ranges.a[1]) / 2);
                const bScore = 100 - Math.abs(labColor.b - (season.ranges.b[0] + season.ranges.b[1]) / 2);

                score = (lScore + aScore + bScore) / 3;
                scores[seasonKey] = Math.max(0, score);
            });

            // ê°€ì¥ ë†’ì€ ì ìˆ˜ì˜ ê³„ì ˆ ì„ íƒ
            const bestSeason = Object.keys(scores).reduce((a, b) => scores[a] > scores[b] ? a : b);
            const confidence = scores[bestSeason];

            // ê²°ê³¼ ì €ì¥
            window.PersonalColorSystem.currentAnalysis.season = bestSeason;
            window.PersonalColorSystem.currentAnalysis.confidence = confidence;
            
            // í†µê³„ ì—…ë°ì´íŠ¸
            window.PersonalColorSystem.stats.totalAnalyses++;
            if (confidence > 70) {
                window.PersonalColorSystem.stats.accurateDetections++;
            }
            
            // UI ì¹´ìš´í„° ì—…ë°ì´íŠ¸
            document.getElementById('diagnosis-count').textContent = window.PersonalColorSystem.stats.totalAnalyses;
        }

        // ===== UI ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ =====
        
        // ì‹¤ì‹œê°„ í”¼ë¶€ ë¶„ì„ ì‹œì‘
        async function startFaceAnalysis() {
            try {
                // ëª¨ë“œ ì „í™˜
                document.getElementById('mode-selection').classList.add('hidden');
                document.getElementById('face-analysis-section').classList.add('active');
                
                // MediaPipe ì´ˆê¸°í™”
                const mediaipeReady = await initializeMediaPipe();
                if (!mediaipeReady) {
                    throw new Error('MediaPipe ì´ˆê¸°í™” ì‹¤íŒ¨');
                }

                showToast('í”¼ë¶€í†¤ ë¶„ì„ ëª¨ë“œê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤', 'info');
                
            } catch (error) {
                console.error('ì–¼êµ´ ë¶„ì„ ì‹œì‘ ì‹¤íŒ¨:', error);
                showToast('ë¶„ì„ ì‹œì‘ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', 'error');
            }
        }

        // ì¹´ë©”ë¼ ì‹œì‘
        async function startCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { 
                        width: 1280, 
                        height: 720,
                        facingMode: 'user'
                    }
                });

                const videoElement = document.getElementById('video-feed');
                videoElement.srcObject = stream;
                
                // MediaPipe ì¹´ë©”ë¼ ì—°ê²°
                const camera = new window.Camera(videoElement, {
                    onFrame: async () => {
                        if (window.PersonalColorSystem.engines.faceMesh) {
                            await window.PersonalColorSystem.engines.faceMesh.send({ image: videoElement });
                        }
                    },
                    width: 1280,
                    height: 720
                });

                camera.start();
                window.PersonalColorSystem.engines.camera = camera;
                
                document.getElementById('start-camera-btn').textContent = 'ì¹´ë©”ë¼ í™œì„±í™”ë¨';
                document.getElementById('start-camera-btn').disabled = true;
                
                showToast('ì¹´ë©”ë¼ê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
                
            } catch (error) {
                console.error('ì¹´ë©”ë¼ ì‹œì‘ ì‹¤íŒ¨:', error);
                showToast('ì¹´ë©”ë¼ ì ‘ê·¼ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', 'error');
            }
        }

        // í”¼ë¶€í†¤ ë¶„ì„ ì‹¤í–‰
        function performSkinAnalysis() {
            const analysis = window.PersonalColorSystem.currentAnalysis;
            
            if (!analysis.labValues || !analysis.season) {
                showToast('ë¨¼ì € ì–¼êµ´ ê°ì§€ë¥¼ ì™„ë£Œí•´ì£¼ì„¸ìš”', 'warning');
                return;
            }

            // ê²°ê³¼ í‘œì‹œ
            displayAnalysisResults();
            showToast('í”¼ë¶€í†¤ ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
        }

        // ë¶„ì„ ê²°ê³¼ í‘œì‹œ
        function displayAnalysisResults() {
            const analysis = window.PersonalColorSystem.currentAnalysis;
            const season = KOREAN_SKIN_DATABASE.seasons[analysis.season];
            
            // ê³„ì ˆ ê²°ê³¼ í‘œì‹œ
            const seasonElement = document.getElementById('best-season-text');
            seasonElement.textContent = season.name;
            seasonElement.className = `best-season ${analysis.season}-result`;
            
            document.getElementById('season-confidence-text').textContent = 
                `ì‹ ë¢°ë„ ${analysis.confidence.toFixed(1)}% â€¢ ${season.characteristics.join(' â€¢ ')}`;

            // ì¶”ì²œ ìƒ‰ìƒ íŒ”ë ˆíŠ¸ ìƒì„±
            const colorsContainer = document.getElementById('recommended-colors');
            colorsContainer.innerHTML = '';
            
            season.colors.forEach((color, index) => {
                const colorDiv = document.createElement('div');
                colorDiv.className = 'color-item';
                colorDiv.style.backgroundColor = color;
                colorDiv.textContent = `ì»¬ëŸ¬ ${index + 1}`;
                colorsContainer.appendChild(colorDiv);
            });

            // ë¸Œëœë“œ ì¶”ì²œ ìƒì„±
            displayBrandRecommendations(analysis.season);

            // ê²°ê³¼ íŒ¨ë„ í‘œì‹œ
            document.getElementById('results-display').classList.add('show');
        }

        // ë¸Œëœë“œ ì¶”ì²œ í‘œì‹œ
        function displayBrandRecommendations(season) {
            // í—¤ì–´ì»¬ëŸ¬ ë¸Œëœë“œ
            const hairContainer = document.getElementById('hair-color-brands');
            hairContainer.innerHTML = '';
            
            Object.keys(BRAND_DATABASE.hairColor).forEach(brandKey => {
                const brand = BRAND_DATABASE.hairColor[brandKey];
                const products = brand.products[season] || [];
                
                const brandDiv = document.createElement('div');
                brandDiv.className = 'brand-item';
                brandDiv.innerHTML = `
                    <div class="brand-name">${brand.name}</div>
                    <ul class="product-list">
                        ${products.map(product => `<li><span class="product-code">${product}</span></li>`).join('')}
                    </ul>
                `;
                hairContainer.appendChild(brandDiv);
            });

            // ë©”ì´í¬ì—… ë¸Œëœë“œ
            const makeupContainer = document.getElementById('makeup-brands');
            makeupContainer.innerHTML = '';
            
            Object.keys(BRAND_DATABASE.makeup).forEach(brandKey => {
                const brand = BRAND_DATABASE.makeup[brandKey];
                const products = brand.products[season] || [];
                
                const brandDiv = document.createElement('div');
                brandDiv.className = 'brand-item';
                brandDiv.innerHTML = `
                    <div class="brand-name">${brand.name}</div>
                    <ul class="product-list">
                        ${products.map(product => `<li><span class="product-code">${product}</span></li>`).join('')}
                    </ul>
                `;
                makeupContainer.appendChild(brandDiv);
            });
        }

        // ê°€ìƒ ë“œë˜ì´í•‘ ì‹œì‘ (ì¶”í›„ êµ¬í˜„)
        function startVirtualDraping() {
            showToast('ê°€ìƒ ë“œë˜ì´í•‘ ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤', 'info');
        }

        // ì¢…í•© ë³´ê³ ì„œ ìƒì„±
        function generateComprehensiveReport(currentAnalysis, savedAnalyses) {
            showToast('ì¢…í•© ë³´ê³ ì„œë¥¼ ìƒì„±í•©ë‹ˆë‹¤...', 'info');
            
            // ë³´ê³ ì„œ ë°ì´í„° ìˆ˜ì§‘
            const reportData = {
                // í˜„ì¬ ë¶„ì„ ê²°ê³¼
                currentAnalysis: currentAnalysis,
                
                // ì´ì „ ë¶„ì„ íˆìŠ¤í† ë¦¬
                analysisHistory: savedAnalyses,
                
                // ì¢…í•© ë¶„ì„ ê²°ê³¼
                comprehensiveResults: {
                    finalSeason: currentAnalysis.season || determineFinalSeason(savedAnalyses),
                    confidenceScore: calculateOverallConfidence(currentAnalysis, savedAnalyses),
                    consistencyCheck: checkAnalysisConsistency(savedAnalyses),
                    improvementSuggestions: generateImprovementSuggestions(currentAnalysis)
                },
                
                // ë§ì¶¤ ì¶”ì²œ
                personalizedRecommendations: {
                    makeupProducts: generateMakeupRecommendations(currentAnalysis.season),
                    hairColors: generateHairColorRecommendations(currentAnalysis.season),
                    fashionColors: generateFashionRecommendations(currentAnalysis.season),
                    avoidColors: generateColorsToAvoid(currentAnalysis.season)
                },
                
                // ë¸Œëœë“œë³„ êµ¬ì²´ì  ì œí’ˆ ì¶”ì²œ
                brandRecommendations: {
                    hairSalon: generateHairSalonRecommendations(currentAnalysis.season),
                    makeup: generateMakeupBrandRecommendations(currentAnalysis.season),
                    fashion: generateFashionBrandRecommendations(currentAnalysis.season)
                },
                
                // ê³„ì ˆë³„ ìƒì„¸ ê°€ì´ë“œ
                seasonalGuide: generateSeasonalGuide(currentAnalysis.season),
                
                // ìƒì„± ì •ë³´
                metadata: {
                    generatedAt: new Date(),
                    version: window.PersonalColorSystem.version,
                    totalAnalyses: savedAnalyses.length + (currentAnalysis.season ? 1 : 0)
                }
            };
            
            // ì¢…í•© ë³´ê³ ì„œ UI í‘œì‹œ
            displayComprehensiveReport(reportData);
            
            // PDF ìƒì„± ë²„íŠ¼ í™œì„±í™”
            enablePDFGeneration(reportData);
        }

        // ì¢…í•© ë³´ê³ ì„œ UI í‘œì‹œ
        function displayComprehensiveReport(reportData) {
            // ëª¨ë“œ ì„ íƒ ìˆ¨ê¸°ê¸°
            document.getElementById('mode-selection').classList.add('hidden');
            
            // ì¢…í•© ë³´ê³ ì„œ ì„¹ì…˜ ìƒì„± ë° í‘œì‹œ
            const comprehensiveSection = document.createElement('section');
            comprehensiveSection.className = 'analysis-section active';
            comprehensiveSection.id = 'comprehensive-report-section';
            
            comprehensiveSection.innerHTML = `
                <div class="section-header">
                    <h3 class="section-title">ì¢…í•© í¼ìŠ¤ë„ì»¬ëŸ¬ ì§„ë‹¨ ë³´ê³ ì„œ</h3>
                    <div class="section-badge">Complete Analysis</div>
                </div>
                
                <!-- ìš”ì•½ ì¹´ë“œ -->
                <div class="comprehensive-summary">
                    <div class="summary-card main-result">
                        <h4>ìµœì¢… ì§„ë‹¨ ê²°ê³¼</h4>
                        <div class="final-season ${reportData.comprehensiveResults.finalSeason}">
                            ${KOREAN_SKIN_DATABASE.seasons[reportData.comprehensiveResults.finalSeason]?.name || 'ë¶„ì„ í•„ìš”'}
                        </div>
                        <div class="confidence-display">
                            <div class="confidence-bar">
                                <div class="confidence-fill" style="width: ${reportData.comprehensiveResults.confidenceScore}%"></div>
                            </div>
                            <span class="confidence-text">ì‹ ë¢°ë„ ${reportData.comprehensiveResults.confidenceScore.toFixed(1)}%</span>
                        </div>
                    </div>
                    
                    <div class="summary-card analysis-stats">
                        <h4>ë¶„ì„ í†µê³„</h4>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-number">${reportData.metadata.totalAnalyses}</div>
                                <div class="stat-label">ì´ ë¶„ì„ íšŸìˆ˜</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number">${reportData.comprehensiveResults.consistencyCheck.percentage.toFixed(0)}%</div>
                                <div class="stat-label">ì¼ê´€ì„± ì ìˆ˜</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ìƒì„¸ ì¶”ì²œ ì„¹ì…˜ -->
                <div class="detailed-recommendations">
                    <div class="recommendation-tabs">
                        <button class="tab-btn active" data-tab="makeup">ë©”ì´í¬ì—…</button>
                        <button class="tab-btn" data-tab="hair">í—¤ì–´ì»¬ëŸ¬</button>
                        <button class="tab-btn" data-tab="fashion">íŒ¨ì…˜</button>
                        <button class="tab-btn" data-tab="brands">ë¸Œëœë“œ</button>
                    </div>
                    
                    <div class="tab-content active" id="makeup-tab">
                        <h5>ë§ì¶¤ ë©”ì´í¬ì—… ê°€ì´ë“œ</h5>
                        <div class="makeup-recommendations" id="makeup-recommendations">
                            <!-- ë©”ì´í¬ì—… ì¶”ì²œ ë‚´ìš© -->
                        </div>
                    </div>
                    
                    <div class="tab-content" id="hair-tab">
                        <h5>í—¤ì–´ì»¬ëŸ¬ ê°€ì´ë“œ</h5>
                        <div class="hair-recommendations" id="hair-recommendations">
                            <!-- í—¤ì–´ì»¬ëŸ¬ ì¶”ì²œ ë‚´ìš© -->
                        </div>
                    </div>
                    
                    <div class="tab-content" id="fashion-tab">
                        <h5>íŒ¨ì…˜ ìŠ¤íƒ€ì¼ë§ ê°€ì´ë“œ</h5>
                        <div class="fashion-recommendations" id="fashion-recommendations">
                            <!-- íŒ¨ì…˜ ì¶”ì²œ ë‚´ìš© -->
                        </div>
                    </div>
                    
                    <div class="tab-content" id="brands-tab">
                        <h5>ë¸Œëœë“œë³„ ì œí’ˆ ì¶”ì²œ</h5>
                        <div class="brand-recommendations" id="detailed-brand-recommendations">
                            <!-- ë¸Œëœë“œë³„ ì œí’ˆ ì¶”ì²œ -->
                        </div>
                    </div>
                </div>
                
                <!-- ì»¨íŠ¸ë¡¤ ë²„íŠ¼ -->
                <div class="controls-grid">
                    <button class="btn btn-primary" id="download-pdf-btn">PDF ë³´ê³ ì„œ ë‹¤ìš´ë¡œë“œ</button>
                    <button class="btn btn-secondary" id="save-comprehensive-btn">ê²°ê³¼ ì €ì¥</button>
                    <button class="btn btn-secondary" id="new-analysis-btn">ìƒˆ ë¶„ì„ ì‹œì‘</button>
                    <button class="btn btn-secondary" id="back-to-menu-comprehensive">ë©”ë‰´ë¡œ ëŒì•„ê°€ê¸°</button>
                </div>
            `;
            
            // ê¸°ì¡´ ë¶„ì„ ì„¹ì…˜ ë’¤ì— ì¶”ê°€
            const mainContent = document.querySelector('.main-content');
            mainContent.appendChild(comprehensiveSection);
            
            // ìƒì„¸ ë‚´ìš© ì±„ìš°ê¸°
            populateComprehensiveRecommendations(reportData);
            
            // íƒ­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            setupComprehensiveReportTabs();
        }

        // ìƒì„¸ ì¶”ì²œ ë‚´ìš© ì±„ìš°ê¸°
        function populateComprehensiveRecommendations(reportData) {
            // ë©”ì´í¬ì—… ì¶”ì²œ
            const makeupContainer = document.getElementById('makeup-recommendations');
            if (makeupContainer && reportData.personalizedRecommendations.makeupProducts) {
                makeupContainer.innerHTML = generateMakeupHTML(reportData.personalizedRecommendations.makeupProducts);
            }
            
            // í—¤ì–´ì»¬ëŸ¬ ì¶”ì²œ
            const hairContainer = document.getElementById('hair-recommendations');
            if (hairContainer && reportData.personalizedRecommendations.hairColors) {
                hairContainer.innerHTML = generateHairColorHTML(reportData.personalizedRecommendations.hairColors);
            }
            
            // íŒ¨ì…˜ ì¶”ì²œ
            const fashionContainer = document.getElementById('fashion-recommendations');
            if (fashionContainer && reportData.personalizedRecommendations.fashionColors) {
                fashionContainer.innerHTML = generateFashionHTML(reportData.personalizedRecommendations.fashionColors);
            }
            
            // ë¸Œëœë“œ ì¶”ì²œ
            const brandContainer = document.getElementById('detailed-brand-recommendations');
            if (brandContainer && reportData.brandRecommendations) {
                brandContainer.innerHTML = generateDetailedBrandHTML(reportData.brandRecommendations);
            }
        }

        // ìµœì¢… ê³„ì ˆ ê²°ì • (ì—¬ëŸ¬ ë¶„ì„ ê²°ê³¼ ê¸°ë°˜)
        function determineFinalSeason(savedAnalyses) {
            if (!savedAnalyses || savedAnalyses.length === 0) return null;
            
            // ê° ê³„ì ˆë³„ ë¹ˆë„ìˆ˜ ê³„ì‚°
            const seasonCounts = {};
            savedAnalyses.forEach(analysis => {
                if (analysis.season) {
                    seasonCounts[analysis.season] = (seasonCounts[analysis.season] || 0) + 1;
                }
            });
            
            // ê°€ì¥ ë§ì´ ë‚˜ì˜¨ ê³„ì ˆ ë°˜í™˜
            return Object.keys(seasonCounts).reduce((a, b) => 
                seasonCounts[a] > seasonCounts[b] ? a : b
            );
        }

        // ì „ì²´ì ì¸ ì‹ ë¢°ë„ ê³„ì‚°
        function calculateOverallConfidence(currentAnalysis, savedAnalyses) {
            const allConfidences = [];
            
            if (currentAnalysis.confidence) {
                allConfidences.push(currentAnalysis.confidence);
            }
            
            savedAnalyses.forEach(analysis => {
                if (analysis.confidence) {
                    allConfidences.push(analysis.confidence);
                }
            });
            
            if (allConfidences.length === 0) return 0;
            
            return allConfidences.reduce((sum, conf) => sum + conf, 0) / allConfidences.length;
        }

        // ìƒì„¸ ì¶”ì²œ HTML ìƒì„± í•¨ìˆ˜ë“¤
        function generateMakeupHTML(makeupProducts) {
            if (!makeupProducts) return '<p>ë©”ì´í¬ì—… ì¶”ì²œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            
            return `
                <div class="makeup-guide">
                    <div class="makeup-category">
                        <h6>ë² ì´ìŠ¤ ë©”ì´í¬ì—…</h6>
                        <div class="product-grid">
                            ${makeupProducts.foundation?.map(item => `
                                <div class="product-item">
                                    <div class="product-name">${item.name}</div>
                                    <div class="product-shade">${item.shade}</div>
                                    <div class="product-brand">${item.brand}</div>
                                </div>
                            `).join('') || '<p>ì¶”ì²œ ì œí’ˆ ì¤€ë¹„ ì¤‘</p>'}
                        </div>
                    </div>
                    
                    <div class="makeup-category">
                        <h6>ë¦½ ì»¬ëŸ¬</h6>
                        <div class="color-swatches">
                            ${makeupProducts.lipColors?.map(color => `
                                <div class="color-swatch" style="background-color: ${color.hex}">
                                    <span class="color-name">${color.name}</span>
                                </div>
                            `).join('') || '<p>ì¶”ì²œ ìƒ‰ìƒ ì¤€ë¹„ ì¤‘</p>'}
                        </div>
                    </div>
                    
                    <div class="makeup-category">
                        <h6>ì•„ì´ ë©”ì´í¬ì—…</h6>
                        <div class="eye-makeup-tips">
                            <ul>
                                ${makeupProducts.eyeMakeup?.tips?.map(tip => `<li>${tip}</li>`).join('') || '<li>ë§ì¶¤ íŒ ì¤€ë¹„ ì¤‘</li>'}
                            </ul>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateHairColorHTML(hairColors) {
            if (!hairColors) return '<p>í—¤ì–´ì»¬ëŸ¬ ì¶”ì²œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            
            return `
                <div class="hair-color-guide">
                    <div class="recommended-colors">
                        <h6>ì¶”ì²œ í—¤ì–´ì»¬ëŸ¬</h6>
                        <div class="hair-color-grid">
                            ${hairColors.recommended?.map(color => `
                                <div class="hair-color-item">
                                    <div class="hair-color-swatch" style="background: linear-gradient(45deg, ${color.lightShade}, ${color.darkShade})"></div>
                                    <div class="hair-color-info">
                                        <div class="color-name">${color.name}</div>
                                        <div class="color-code">${color.code}</div>
                                        <div class="color-description">${color.description}</div>
                                    </div>
                                </div>
                            `).join('') || '<p>ì¶”ì²œ ì»¬ëŸ¬ ì¤€ë¹„ ì¤‘</p>'}
                        </div>
                    </div>
                    
                    <div class="avoid-colors">
                        <h6>í”¼í•´ì•¼ í•  í—¤ì–´ì»¬ëŸ¬</h6>
                        <div class="avoid-colors-list">
                            ${hairColors.avoid?.map(color => `
                                <div class="avoid-color-item">
                                    <span class="color-name">${color.name}</span>
                                    <span class="reason">${color.reason}</span>
                                </div>
                            `).join('') || '<p>ì£¼ì˜ ì»¬ëŸ¬ ì¤€ë¹„ ì¤‘</p>'}
                        </div>
                    </div>
                </div>
            `;
        }

        function generateFashionHTML(fashionColors) {
            if (!fashionColors) return '<p>íŒ¨ì…˜ ì¶”ì²œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            
            return `
                <div class="fashion-guide">
                    <div class="color-combinations">
                        <h6>ì¶”ì²œ ì»¬ëŸ¬ ì¡°í•©</h6>
                        <div class="combination-grid">
                            ${fashionColors.combinations?.map(combo => `
                                <div class="color-combination">
                                    <div class="combo-colors">
                                        ${combo.colors.map(color => `
                                            <div class="combo-color" style="background-color: ${color}"></div>
                                        `).join('')}
                                    </div>
                                    <div class="combo-description">${combo.description}</div>
                                    <div class="combo-occasion">${combo.occasion}</div>
                                </div>
                            `).join('') || '<p>ì»¬ëŸ¬ ì¡°í•© ì¤€ë¹„ ì¤‘</p>'}
                        </div>
                    </div>
                    
                    <div class="styling-tips">
                        <h6>ìŠ¤íƒ€ì¼ë§ íŒ</h6>
                        <ul class="tips-list">
                            ${fashionColors.tips?.map(tip => `<li>${tip}</li>`).join('') || '<li>ìŠ¤íƒ€ì¼ë§ íŒ ì¤€ë¹„ ì¤‘</li>'}
                        </ul>
                    </div>
                </div>
            `;
        }

        function generateDetailedBrandHTML(brandRecommendations) {
            return `
                <div class="detailed-brand-guide">
                    <div class="brand-category">
                        <h6>í—¤ì–´ì‚´ë¡± ì „ìš© ë¸Œëœë“œ</h6>
                        <div class="brand-grid">
                            ${Object.entries(BRAND_DATABASE.hairColor).map(([key, brand]) => `
                                <div class="brand-detail-item">
                                    <div class="brand-header">
                                        <h7>${brand.name}</h7>
                                        <span class="brand-type">Professional</span>
                                    </div>
                                    <div class="product-recommendations">
                                        ${brand.products[window.PersonalColorSystem.currentAnalysis.season || 'spring']?.map(product => `
                                            <div class="product-recommendation">
                                                <span class="product-code">${product.split(' ')[0]}</span>
                                                <span class="product-name">${product.split(' ').slice(1).join(' ')}</span>
                                            </div>
                                        `).join('') || '<div class="no-products">ì¶”ì²œ ì œí’ˆ ì¤€ë¹„ ì¤‘</div>'}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="brand-category">
                        <h6>ë©”ì´í¬ì—… ë¸Œëœë“œ</h6>
                        <div class="brand-grid">
                            ${Object.entries(BRAND_DATABASE.makeup).map(([key, brand]) => `
                                <div class="brand-detail-item">
                                    <div class="brand-header">
                                        <h7>${brand.name}</h7>
                                        <span class="brand-type">Premium</span>
                                    </div>
                                    <div class="product-recommendations">
                                        ${brand.products[window.PersonalColorSystem.currentAnalysis.season || 'spring']?.map(product => `
                                            <div class="product-recommendation">
                                                <span class="product-name">${product}</span>
                                            </div>
                                        `).join('') || '<div class="no-products">ì¶”ì²œ ì œí’ˆ ì¤€ë¹„ ì¤‘</div>'}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        // ì¶”ì²œ ë°ì´í„° ìƒì„± í•¨ìˆ˜ë“¤
        function generateMakeupRecommendations(season) {
            const seasonData = KOREAN_SKIN_DATABASE.seasons[season];
            if (!seasonData) return null;
            
            return {
                foundation: [
                    { name: 'ë”ë¸” ì›¨ì–´ ìŠ¤í…Œì´-ì¸-í”Œë ˆì´ìŠ¤', shade: 'ì í•© ìƒ‰ìƒ ì¶”ì²œ', brand: 'ì—ìŠ¤í‹°ë¡œë”' },
                    { name: 'ì˜¬ ë°ì´ ë£¨ë¯¸ë„ˆìŠ¤', shade: 'ì í•© ìƒ‰ìƒ ì¶”ì²œ', brand: 'MAC' }
                ],
                lipColors: seasonData.colors.map(color => ({
                    hex: color,
                    name: `${seasonData.name} ì¶”ì²œ ì»¬ëŸ¬`
                })),
                eyeMakeup: {
                    tips: [
                        `${seasonData.name}ì— ì–´ìš¸ë¦¬ëŠ” ì•„ì´ì„€ë„ íŒ”ë ˆíŠ¸ ì‚¬ìš©`,
                        'ìì—°ìŠ¤ëŸ¬ìš´ ìŒì˜ìœ¼ë¡œ ì…ì²´ê° ì—°ì¶œ',
                        'ê³„ì ˆ íŠ¹ì„±ì— ë§ëŠ” ì»¬ëŸ¬ í¬ì¸íŠ¸ í™œìš©'
                    ]
                }
            };
        }

        function generateHairColorRecommendations(season) {
            const seasonData = KOREAN_SKIN_DATABASE.seasons[season];
            if (!seasonData) return null;
            
            return {
                recommended: seasonData.colors.map((color, index) => ({
                    name: `${seasonData.name} ì¶”ì²œ ${index + 1}`,
                    code: `HC-${season.toUpperCase()}-${index + 1}`,
                    lightShade: color,
                    darkShade: this.adjustColorBrightness(color, -20),
                    description: `${seasonData.characteristics[0]}ì— ì˜ ì–´ìš¸ë¦¬ëŠ” ì»¬ëŸ¬`
                })),
                avoid: [
                    { name: 'ê°•í•œ ë¸”ë™', reason: 'í”¼ë¶€í†¤ê³¼ ëŒ€ë¹„ê°€ ë„ˆë¬´ ê°•í•¨' },
                    { name: 'ì• ì‰¬ ê³„ì—´', reason: 'ì¿¨í†¤ì´ ì•„ë‹Œ ê²½ìš° ë¶€ìì—°ìŠ¤ëŸ¬ì›€' }
                ]
            };
        }

        function generateFashionRecommendations(season) {
            const seasonData = KOREAN_SKIN_DATABASE.seasons[season];
            if (!seasonData) return null;
            
            return {
                combinations: [
                    {
                        colors: seasonData.colors.slice(0, 2),
                        description: 'ê¸°ë³¸ ì»¬ëŸ¬ ì¡°í•©',
                        occasion: 'ì¼ìƒ ë° ì—…ë¬´'
                    },
                    {
                        colors: seasonData.colors.slice(1, 3),
                        description: 'í¬ì¸íŠ¸ ì»¬ëŸ¬ ì¡°í•©',
                        occasion: 'íŠ¹ë³„í•œ ë‚ '
                    }
                ],
                tips: [
                    `${seasonData.characteristics.join(', ')} íŠ¹ì„± í™œìš©`,
                    'ìƒ‰ìƒ ë§¤ì¹˜ ì‹œ í†¤ ì˜¨ í†¤ í™œìš©',
                    'ì•¡ì„¸ì„œë¦¬ë¡œ í¬ì¸íŠ¸ ì»¬ëŸ¬ í™œìš©'
                ]
            };
        }

        // ìƒ‰ìƒ ë°ê¸° ì¡°ì ˆ ìœ í‹¸ë¦¬í‹°
        function adjustColorBrightness(hex, percent) {
            const num = parseInt(hex.replace("#", ""), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) + amt;
            const G = (num >> 8 & 0x00FF) + amt;
            const B = (num & 0x0000FF) + amt;
            
            return "#" + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
                (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
                (B < 255 ? B < 1 ? 0 : B : 255)).toString(16).slice(1);
        }

        // ì¢…í•© ë³´ê³ ì„œ íƒ­ ê¸°ëŠ¥ ì„¤ì •
        function setupComprehensiveReportTabs() {
            const tabButtons = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const targetTab = btn.dataset.tab;
                    
                    // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
                    tabButtons.forEach(b => b.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    
                    // ì„ íƒí•œ íƒ­ í™œì„±í™”
                    btn.classList.add('active');
                    document.getElementById(`${targetTab}-tab`).classList.add('active');
                });
            });
        }

        // PDF ìƒì„± í™œì„±í™”
        function enablePDFGeneration(reportData) {
            const pdfBtn = document.getElementById('download-pdf-btn');
            if (pdfBtn) {
                pdfBtn.addEventListener('click', () => generatePDF(reportData));
                pdfBtn.disabled = false;
            }
        }

        // PDF ìƒì„± (ê°„ë‹¨í•œ ë²„ì „)
        function generatePDF(reportData) {
            try {
                showToast('PDF ë³´ê³ ì„œë¥¼ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...', 'info');
                
                // ê°„ë‹¨í•œ í…ìŠ¤íŠ¸ ê¸°ë°˜ ë³´ê³ ì„œ ìƒì„±
                const reportContent = `
í¼ìŠ¤ë„ì»¬ëŸ¬ ì¢…í•© ì§„ë‹¨ ë³´ê³ ì„œ
========================================

ìƒì„±ì¼: ${new Date().toLocaleDateString('ko-KR')}
ì‹œìŠ¤í…œ ë²„ì „: ${window.PersonalColorSystem.version}

â–  ìµœì¢… ì§„ë‹¨ ê²°ê³¼
ê³„ì ˆ íƒ€ì…: ${KOREAN_SKIN_DATABASE.seasons[reportData.comprehensiveResults.finalSeason]?.name || 'ë¶„ì„ í•„ìš”'}
ì‹ ë¢°ë„: ${reportData.comprehensiveResults.confidenceScore.toFixed(1)}%
ë¶„ì„ íšŸìˆ˜: ${reportData.metadata.totalAnalyses}íšŒ

â–  í”¼ë¶€í†¤ ë¶„ì„ ê²°ê³¼
L* (ëª…ë„): ${reportData.currentAnalysis.labValues?.L?.toFixed(1) || '--'}
a* (ë¹¨ê°•-ì´ˆë¡): ${reportData.currentAnalysis.labValues?.a?.toFixed(1) || '--'}  
b* (ë…¸ë‘-íŒŒë‘): ${reportData.currentAnalysis.labValues?.b?.toFixed(1) || '--'}

â–  ì¶”ì²œ ë¸Œëœë“œ (í—¤ì–´ì»¬ëŸ¬)
${Object.entries(BRAND_DATABASE.hairColor).map(([key, brand]) => 
`${brand.name}:
${brand.products[reportData.comprehensiveResults.finalSeason]?.map(p => `  - ${p}`).join('\n') || '  - ì¶”ì²œ ì œí’ˆ ì¤€ë¹„ ì¤‘'}`
).join('\n\n')}

â–  ì¶”ì²œ ë¸Œëœë“œ (ë©”ì´í¬ì—…)
${Object.entries(BRAND_DATABASE.makeup).map(([key, brand]) =>
`${brand.name}:
${brand.products[reportData.comprehensiveResults.finalSeason]?.map(p => `  - ${p}`).join('\n') || '  - ì¶”ì²œ ì œí’ˆ ì¤€ë¹„ ì¤‘'}`  
).join('\n\n')}

â–  ìŠ¤íƒ€ì¼ë§ íŒ
- ${KOREAN_SKIN_DATABASE.seasons[reportData.comprehensiveResults.finalSeason]?.characteristics.join('\n- ') || 'ë¶„ì„ ê²°ê³¼ì— ë”°ë¥¸ ë§ì¶¤ íŒ'}

========================================
Personal Color AI Pro
ì „ë¬¸ í¼ìŠ¤ë„ì»¬ëŸ¬ ì§„ë‹¨ ì‹œìŠ¤í…œ
                `;
                
                // í…ìŠ¤íŠ¸ íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œ
                const blob = new Blob([reportContent], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `í¼ìŠ¤ë„ì»¬ëŸ¬_ì¢…í•©ë³´ê³ ì„œ_${Date.now()}.txt`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                showToast('ì¢…í•© ë³´ê³ ì„œê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                
            } catch (error) {
                console.error('PDF ìƒì„± ì‹¤íŒ¨:', error);
                showToast('ë³´ê³ ì„œ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
            }
        }

        // ë©”ë‰´ë¡œ ëŒì•„ê°€ê¸°
        function backToMenu() {
            document.getElementById('face-analysis-section').classList.remove('active');
            document.getElementById('mode-selection').classList.remove('hidden');
            document.getElementById('results-display').classList.remove('show');
            
            // ì¹´ë©”ë¼ ì •ì§€
            if (window.PersonalColorSystem.engines.camera) {
                window.PersonalColorSystem.engines.camera.stop();
            }
        }

        // ê²°ê³¼ ì €ì¥
        function saveAnalysisResult() {
            const analysis = window.PersonalColorSystem.currentAnalysis;
            const timestamp = new Date().toISOString();
            
            const savedData = {
                timestamp,
                skinTone: analysis.skinTone,
                labValues: analysis.labValues,
                season: analysis.season,
                confidence: analysis.confidence
            };

            // localStorageì— ì €ì¥
            const existingData = JSON.parse(localStorage.getItem('personalColorAnalyses') || '[]');
            existingData.push(savedData);
            localStorage.setItem('personalColorAnalyses', JSON.stringify(existingData));
            
            showToast('ë¶„ì„ ê²°ê³¼ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
        }

        // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ ì‹œìŠ¤í…œ
        function showToast(message, type = 'info', duration = 4000) {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icons = { success: 'âœ…', error: 'âŒ', warning: 'âš ï¸', info: 'â„¹ï¸' };
            
            toast.innerHTML = `
                <div class="toast-icon">${icons[type] || icons.info}</div>
                <div class="toast-content">
                    <div class="toast-message">${message}</div>
                </div>
            `;

            container.appendChild(toast);
            setTimeout(() => toast.classList.add('show'), 10);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => container.removeChild(toast), 300);
            }, duration);
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        document.addEventListener('DOMContentLoaded', function() {
            // ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.getElementById('start-camera-btn').addEventListener('click', startCamera);
            document.getElementById('analyze-skin-btn').addEventListener('click', performSkinAnalysis);
            document.getElementById('save-result-btn').addEventListener('click', saveAnalysisResult);
            document.getElementById('back-to-menu-btn').addEventListener('click', backToMenu);

            // ì‹œìŠ¤í…œ ì¤€ë¹„ í‘œì‹œ
            setTimeout(() => {
                document.getElementById('system-ready').style.display = 'block';
                showToast('Personal Color AI Pro ì‹œìŠ¤í…œì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
            }, 1000);

            console.log('=== Personal Color AI Pro v3.0 ===');
            console.log('ì‹¤ì œ MediaPipe + Delta E 2000 + ë¸Œëœë“œ DB');
            console.log('ì¢…í•© ì§„ë‹¨ ë³´ê³ ì„œ ì‹œìŠ¤í…œ í†µí•© ì™„ë£Œ');
        });

        // ì¢…í•© ë³´ê³ ì„œ ê´€ë ¨ ì´ë²¤íŠ¸ ì²˜ë¦¬ (ë™ì  ìƒì„±ë˜ëŠ” ìš”ì†Œë“¤)
        document.addEventListener('click', function(e) {
            if (e.target.id === 'back-to-menu-comprehensive') {
                backToMenuFromComprehensive();
            } else if (e.target.id === 'new-analysis-btn') {
                startNewAnalysis();
            } else if (e.target.id === 'save-comprehensive-btn') {
                saveComprehensiveResult();
            }
        });

        // ì¢…í•© ë³´ê³ ì„œì—ì„œ ë©”ë‰´ë¡œ ëŒì•„ê°€ê¸°
        function backToMenuFromComprehensive() {
            const comprehensiveSection = document.getElementById('comprehensive-report-section');
            if (comprehensiveSection) {
                comprehensiveSection.remove();
            }
            
            document.getElementById('mode-selection').classList.remove('hidden');
            document.getElementById('results-display').classList.remove('show');
            
            showToast('ë©”ì¸ ë©”ë‰´ë¡œ ëŒì•„ê°”ìŠµë‹ˆë‹¤', 'info');
        }

        // ìƒˆ ë¶„ì„ ì‹œì‘
        function startNewAnalysis() {
            // í˜„ì¬ ë¶„ì„ ë°ì´í„° ì´ˆê¸°í™”
            window.PersonalColorSystem.currentAnalysis = {
                skinTone: null,
                season: null,
                confidence: 0,
                labValues: { L: 0, a: 0, b: 0 },
                recommendedColors: [],
                brandMatches: []
            };
            
            // ì¢…í•© ë³´ê³ ì„œ ì„¹ì…˜ ì œê±°
            backToMenuFromComprehensive();
            
            // í”¼ë¶€í†¤ ë¶„ì„ ëª¨ë“œë¡œ ë°”ë¡œ ì´ë™
            setTimeout(() => {
                startFaceAnalysis();
            }, 500);
            
            showToast('ìƒˆë¡œìš´ ë¶„ì„ì„ ì‹œì‘í•©ë‹ˆë‹¤', 'info');
        }

        // ì¢…í•© ê²°ê³¼ ì €ì¥
        function saveComprehensiveResult() {
            try {
                const comprehensiveData = {
                    timestamp: new Date().toISOString(),
                    type: 'comprehensive_report',
                    currentAnalysis: window.PersonalColorSystem.currentAnalysis,
                    reportData: {
                        finalSeason: window.PersonalColorSystem.currentAnalysis.season,
                        overallConfidence: window.PersonalColorSystem.currentAnalysis.confidence,
                        totalAnalyses: window.PersonalColorSystem.stats.totalAnalyses
                    }
                };
                
                // localStorageì— ì¢…í•© ë³´ê³ ì„œ ì €ì¥
                const existingComprehensive = JSON.parse(localStorage.getItem('comprehensiveReports') || '[]');
                existingComprehensive.push(comprehensiveData);
                localStorage.setItem('comprehensiveReports', JSON.stringify(existingComprehensive));
                
                showToast('ì¢…í•© ë¶„ì„ ê²°ê³¼ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
                
            } catch (error) {
                console.error('ì¢…í•© ê²°ê³¼ ì €ì¥ ì‹¤íŒ¨:', error);
                showToast('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
            }
        }
    </script>
</body>
</html>
